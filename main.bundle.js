/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{var t,e,n,r,i={13:(t,e,n)=>{"use strict";n.d(e,{Zb:()=>C,io:()=>O});var r=n(356);function i(){document.querySelectorAll(".option").forEach((function(t){t.setAttribute("draggable","false"),t.style.cursor="not-allowed"}))}var s=n(212);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.forceEnableNext,n=void 0===e?(0,r.sV)():e,s=t.forceDisableAskAI,o=void 0!==s&&s,a=document.querySelectorAll(".box"),c=Array.from(a).every((function(t){return t.children.length>0})),u=document.querySelectorAll(".option"),l=document.getElementById("option-container"),h=Array.from(u).every((function(t){return l.contains(t)})),d=(0,r.FJ)().lastSubmission.score;!function(t){var e=t.submit,n=t.reset,r=t.next,i=t.askAI;document.getElementById("submit-btn").disabled=!e,document.getElementById("reset-btn").disabled=!n,document.getElementById("next-btn").disabled=!r;var s=document.getElementById("askAI-btn");i?(s.classList.remove("disabled-visual"),s.dataset.locked="false"):(s.classList.add("disabled-visual"),s.dataset.locked="true")}({submit:c&&(0,r.ag)()>0&&100!==d,reset:!h&&(0,r.ag)()>0&&100!==d,next:(0,r.pc)()?100===d:n,askAI:!o&&c&&(0,r.tG)()>0&&(0,r.vy)()}),0===(0,r.ag)()?i():document.querySelectorAll(".option").forEach((function(t){t.setAttribute("draggable","true"),t.style.cursor="move"}))}function a(){document.getElementById("correct-trials").textContent=(0,r.FJ)().correctTrialCount,document.getElementById("totalPassMessage").style.display="block",((0,r.Zn)()||(0,r.pc)())&&(document.getElementById("totalPassMessage").style.display="none")}function c(){document.getElementById("askAIMessage").style.display=(0,r.vy)()?"block":"none",console.log("curPhase",(0,r.mX)(),"isAllowedAskAITrials",(0,r.vy)()),document.getElementById("askAI-count").textContent=(0,r.Ly)(),((0,r.Zn)()||(0,r.pc)())&&(document.getElementById("askAIMessage").style.display="none")}function u(){document.getElementById("submission-result-content").style.display="none"}var l=n(347),h=n(730);function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function f(t){var e=t.options,n=t.style||[];(0,r.Zn)()?document.getElementById("trialID").textContent="ATTENTION CHECK Trial":document.getElementById("trialID").textContent="Trial "+((0,r.pc)()?(0,r.XM)():(0,r.bv)());var i=document.getElementById("box-container");i.innerHTML="",h.NV.innerHTML="",h._A.innerHTML="";var s,a=e.map((function(t){var e=document.createElement("div");return e.className="option",e.style.position="absolute",e.style.visibility="hidden",e.textContent=t,document.body.appendChild(e),e})),c=Math.max.apply(Math,function(t){if(Array.isArray(t))return d(t)}(s=a.map((function(t){return t.getBoundingClientRect().height})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(s)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());a.forEach((function(t){return t.remove()})),e.forEach((function(t,r){var s=document.createElement("div");s.className="label",s.textContent=r+1,h._A.appendChild(s);var o=document.createElement("div");o.className="option",o.id=t,o.textContent=t,p(o,n[r]||"blank"),o.style.height="".concat(c,"px"),h.NV.appendChild(o);var a=document.createElement("div");a.className="box-group";var u=document.createElement("div");if(u.className="box",u.style.height=(0,l.hX)(c,1),a.appendChild(u),0===r||r===e.length-1){var d=document.createElement("div");d.className="side-label-under",d.id=0===r?"front-label-under":"end-label-under",d.textContent=0===r?"front":"end",a.appendChild(d)}i.appendChild(a)}));var f=document.getElementById("solution-container");if(f.innerHTML="",(0,r.vy)()){var m=t.answer,g=t.sortedStyle||[];m.forEach((function(t,e){var n=document.createElement("div");n.className="solution",n.id="solution-".concat(t),n.textContent=t,p(n,g[e]||"blank"),n.style.height="".concat(c,"px"),f.appendChild(n)}))}document.querySelectorAll(".option").forEach((function(t){t.addEventListener("dragstart",(function(t){t.dataTransfer.setData("text",t.target.id)}))})),function(){var t=document.getElementById("box-container");t.replaceWith(t.cloneNode(!0));var e=document.getElementById("box-container");e.addEventListener("dragover",(function(t){(t.target.classList.contains("box")||t.target.closest(".box"))&&t.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault();var e,n=(e=t.target).classList.contains("box")?e:e.closest(".box");if(n){var i=t.dataTransfer.getData("text"),s=document.getElementById(i),a=s.parentElement;if(n!==a){var c=n.firstElementChild;c&&a.appendChild(c),n.appendChild(s),(0,r.BY)(),o(),u()}}}))}()}function p(t,e){var n={blank:"lightblue","dotted circles":"repeating-radial-gradient(circle, lightblue, lightblue 5px, white 5px, white 10px)","horizontal lines":"repeating-linear-gradient(to bottom, lightblue, lightblue 5px, white 5px, white 10px)","vertical lines":"repeating-linear-gradient(to right, lightblue, lightblue 5px, white 5px, white 10px)","diagonal stripes":"repeating-linear-gradient(45deg, lightblue, lightblue 5px, white 5px, white 10px)","horizontal stripes":"\n    repeating-linear-gradient(to right, transparent 0 8px, lightblue 8px 16px),\n    repeating-linear-gradient(to bottom, transparent 0 8px, lightblue 8px 16px)\n  "};t.style.background=n[e]||n.blank}var m=n(371),g={timers:{phase1:{seconds:10,interval:null},phase2:{seconds:1200,interval:null},phase3:{seconds:10,interval:null},trial:{seconds:0,interval:null},submission:{seconds:0,interval:null}}};function y(t){var e=g.timers[t];if(e&&!e.interval){var n=Date.now();e.interval=setInterval((function(){var i=Date.now(),s=Math.floor((i-n)/1e3);if(s>=1)if(n=i,[r.qR.PHASE1,r.qR.PHASE2,r.qR.PHASE3].includes(t)){if(e.seconds-=s,e.seconds<=0)return e.seconds=0,clearInterval(e.interval),e.interval=null,(0,r.Th)(!0),void([r.qR.PHASE1,r.qR.PHASE3].includes((0,r.mX)())&&(0,r.uO)()<(0,r.V9)()&&(0,m.gI)());t==r.qR.PHASE2&&e.seconds<=600&&!(0,r.K6)()&&(0,r.XI)();var o=String(Math.floor(e.seconds/60)).padStart(2,"0"),a=String(e.seconds%60).padStart(2,"0");document.getElementById("timer").textContent="".concat(o,":").concat(a)}else"visible"===document.visibilityState&&(e.seconds+=s)}),500)}}function v(t){var e=g.timers[t];null!=e&&e.interval&&(clearInterval(e.interval),e.interval=null)}function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;v(t),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=g.timers[t];n&&(n.seconds=e)}(t,e),y(t)}function _(t){var e,n;return null!==(e=null===(n=g.timers[t])||void 0===n?void 0:n.seconds)&&void 0!==e?e:0}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function E(){E=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var s=e&&e.prototype instanceof y?e:y,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var _={};u(_,o,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,o)&&(_=T);var S=w.prototype=y.prototype=Object.create(_);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,o,a){var c=h(t[i],t,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==b(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(e,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(b(e)+" is not iterable")}return v.prototype=w,i(S,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,c,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(l(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),u(S,c,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function I(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function S(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function C(){document.getElementById("submit-btn").addEventListener("click",k),document.getElementById("reset-btn").addEventListener("click",x),document.getElementById("next-btn").addEventListener("click",O),document.getElementById("askAI-btn").addEventListener("click",P)}function k(){if(!((0,r.ag)()<=0)){var t=_("submission"),e=(0,l.QC)(),n=(0,l.UP)(e,(0,r.fi)().answer);!function(t,e,n,i){(0,r.BY)(),(0,r.nu)(n),(0,r.gf)(e,n),function(){var t=(0,r.FJ)();document.getElementById("submission-result-content").style.display="block",document.getElementById("correct-choice").textContent=t.lastSubmission.correctChoice,document.getElementById("score").textContent="".concat(t.lastSubmission.score),a();var e=document.getElementById("additionalMessage");e.style.display="none",(0,r.Zn)()?100!==t.lastSubmission.score?(e.style.display="block",e.textContent="You have failed this attention check.",e.style.color="red"):s.KJ.is_passed_attention_check=!0:(0,r.pc)()&&(e.style.display="block",100!==t.lastSubmission.score?(e.textContent="You did not score 100.",e.style.color="red"):(e.textContent="You passed this trial! ",e.style.color="green"))}(),A(),o({forceEnableNext:!0});var c=JSON.parse(JSON.stringify((0,r.FJ)())),u=_("trial");(0,r.cM)(),w("submission"),F(c,t,i,u,!0),(0,r.pc)()&&(100!==n&&0==(0,r.ag)()&&((0,m.Cc)(),clearAllTimers()),100===n&&(0,r.XM)()===(0,r.xO)()&&((0,r.z$)(),(0,r.Jb)(),(0,m.Re)(),s.KJ.is_passed_comprehension=!0))}(e,n.correctChoice,n.score,t)}}function A(){var t=document.getElementById("submission-count");t&&(t.textContent=(0,r.ag)())}function x(){document.querySelectorAll(".box").forEach((function(t){return t.innerHTML=""})),f((0,r.fi)()),(0,r.BY)(),o()}function O(){return N.apply(this,arguments)}function N(){var t;return t=E().mark((function t(){var e,n,o;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===s.KJ.experiments.length&&D(),(0,r.pc)()||"none"!==h.Jg.style.display?(0,r.pc)()&&(h.Jg.style.display="none"):(h.Jg.style.display="block",y(r.qR.PHASE1)),!((0,r.XM)()>0)){t.next=17;break}if(e=JSON.parse(JSON.stringify((0,r.FJ)())),_("submission"),n=_("trial"),(0,r.R2)(),w("trial"),w("submission"),F(e,[],0,n,!1),!(0,r.d4)()){t.next=15;break}return t.next=13,new Promise((function(t){(0,r.mX)()===r.qR.PHASE1?(0,m.ZS)((function(){(0,r.b8)(r.qR.PHASE2),(0,r.Jn)(),(0,r.Th)(!1),document.getElementById("timer").textContent="20:00",y(r.qR.PHASE2),O(),t()})):(0,r.mX)()===r.qR.PHASE2?(0,m.Sz)((function(){(0,r.b8)(r.qR.PHASE3),(0,r.Jn)(),(0,r.Th)(!1),document.getElementById("timer").textContent="08:00",y(r.qR.PHASE3),O(),t()})):(0,r.mX)()===r.qR.PHASE3?(document.getElementById("submit-btn").disabled=!0,document.getElementById("reset-btn").disabled=!0,document.getElementById("next-btn").disabled=!0,i(),(0,m.M0)(),v("submission"),v("trial"),(0,s.Kc)().is_finished=!0,s.KJ.is_passed_all_experiments=s.KJ.is_passed_attention_check,F(JSON.parse(JSON.stringify((0,r.FJ)())),[],0,_("trial"),!1),t()):t()}));case 13:if((0,r.mX)()!=r.qR.PHASE3){t.next=15;break}return t.abrupt("return");case 15:t.next=19;break;case 17:w("trial"),w("submission");case 19:if((0,r.VK)()&&(a=(0,r.mX)(),void 0,(c=g.timers[a])&&!c.interval&&y(a)),o=[],(0,r.nR)()&&v((0,r.mX)()),(0,r.NV)((0,r.Zn)()||(0,r.pc)())){t.next=24;break}return t.abrupt("return");case 24:console.log("--Trail idx ".concat((0,r.XM)(),"--Question idx ").concat((0,r.bv)(),"--Question id ").concat((0,r.fi)().question_id,"--")),L((0,r.fi)()),o=(0,r.fi)().answer,M((0,r.fi)().question_id,o);case 29:case"end":return t.stop()}var a,c}),t)})),N=function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){S(s,r,i,o,a,"next",t)}function a(t){S(s,r,i,o,a,"throw",t)}o(void 0)}))},N.apply(this,arguments)}function R(t,e){var n=document.getElementById("ai-chat"),r=document.createElement("div");r.classList.add("chat-bubble"),r.classList.add(t.toLowerCase());var i=document.createElement("div");i.className="avatar",i.textContent="AI"===t?"ðŸ¤–":"ðŸ˜ƒ";var s=document.createElement("div");s.className="message",s.innerHTML="".concat(e),r.appendChild(i),r.appendChild(s),n.appendChild(r),n.scrollTop=n.scrollHeight}function P(){var t,e;if("true"===document.getElementById("askAI-btn").dataset.locked){var n=(0,r.tG)()<=0?"Youâ€™ve reached the hint limit for this trial.":"Please place all objects first.";return(0,r.vy)()||(n="AI help is not available for this trial."),t=n,(e=document.getElementById("askAITooltip")).textContent=t,e.style.display="block",e.style.opacity="1",void setTimeout((function(){e.style.opacity="0",setTimeout((function(){e.style.display="none"}),300)}),1e3)}var i=(0,r.AH)(),s=function(t){var e=(0,r.fi)().answer,n=e.length;if(1===t){var i=I(Array(n).keys()).filter((function(t){return!(0,r.cf)().has(t)})),s=i[Math.floor(Math.random()*i.length)];return(0,r.fO)(s),[{name:e[s],pos:s+1}]}var o=I(Array(n).keys()).sort((function(){return.5-Math.random()})).slice(0,t);return o.forEach((function(t){return(0,r.fO)(t)})),o.map((function(t){return{name:e[t],pos:t+1}}))}(i);(0,r.IJ)(),o({forceDisableAskAI:!0}),R("User","Randomly revealed ".concat(i," ")+(1===i?"object's location":"objects' locations")),setTimeout((function(){document.querySelectorAll("[id^='solution-']").forEach((function(t){t.style.visibility="hidden"})),h.UT.style.visibility="visible",s.forEach((function(t){var e=document.getElementById("solution-".concat(t.name));e&&(e.style.visibility="visible")})),R("AI",s.map((function(t){return"<strong>".concat(t.name,"</strong> is at <strong>").concat(t.pos,"</strong>.")})).join("<br/>")),o()}),500),c();var a=JSON.parse(JSON.stringify((0,r.FJ)()));_("submission"),F(a,[],0,_("trial"),!1)}function L(t){var e,n,i,s,d,p,m,g,y,v;e=t.instruction,i=(0,r.mj)(),n=(0,r.Zn)()?'<p>\n      This is the attention check trial.</p>\n      <p>The timer is paused for this trial.</p>\n      <p>You have <span id="submission-count" style="color:brown;">'.concat(i,"</span> submission(s) remaining for this trial.</p>\n      <p>You need to score 100 to pass this trial.</p>\n      <p>If you fail the attention check, you will not get the bonus payment regardless of your overall performance.</p>"):(0,r.pc)()?'<p>This is a comprehension check trial.</p>\n      <p>You have <span id="submission-count" style="color:brown;">'.concat(i,"</span> submission(s) remaining for this trial.</p>\n      <p>You need to score 100 to pass this trial.</p>\n      <p>If you fail this trial twice, the experiment ends automatically.</p>"):"<p>".concat(e,'</p>\n      <p>You have <span id="submission-count" style="color:brown;">').concat(i,"</span> submission(s) remaining for this trial.</p>\n      <p>Maximize your score with minimal time.</p>"),document.getElementById("instruction-text").innerHTML=n,function(){if(c(),(0,r.vy)()){h._H.style.display="flex",document.getElementById("askAI-btn").textContent="Reveal ".concat((0,r.AH)()," ")+(1===(0,r.AH)()?"object's location":"objects' locations");var t=document.getElementById("ai-chat");t.innerHTML="";var e=document.createElement("div");e.classList.add("chat-bubble","ai");var n=document.createElement("div");n.className="avatar",n.textContent="ðŸ¤–";var i=document.createElement("div");i.className="message",i.innerHTML="<strong>AI:</strong> How can I help?",e.appendChild(n),e.appendChild(i),t.appendChild(e)}else h._H.style.display="none"}(),f(t),s=t.statements,d=t.answer,p=document.querySelector("#statement-box ul"),m=s.map((function(t){var e=t;return d.forEach((function(t){var n=new RegExp("\\b".concat((0,l.Nt)(t),"\\b"),"gi");e=e.replace(n,(function(t){return"<strong>".concat(t,"</strong>")}))})),"<li>".concat(e,"</li>")})),p.innerHTML=m.join(""),g=t.front_end,y=document.getElementById("front-label-under"),v=document.getElementById("end-label-under"),Array.isArray(g)&&2===g.length?(y&&(y.textContent=g[0]),v&&(v.textContent=g[1])):(y&&(y.textContent="front"),v&&(v.textContent="end")),a(),u(),(0,r.D8)(),(0,r.b4)(),(0,r.rf)(),(0,r.Ys)(),A(),o()}function D(){var t=(0,s.Cr)();s.KJ.experiments.push(t)}function M(t,e){0===s.KJ.experiments.length&&D();var n,i=(0,r.pc)(),o=(0,r.Zn)(),a=s.KJ.experiments[0];if(n=i?(0,r.XM)():o?"attention check":(0,r.bv)(),!i||!a.comprehension_trials.some((function(t){return t.trial_id===n}))){var c=(0,s.lp)(n,t,e,i,o);i?a.comprehension_trials.push(c):a.trials.push(c)}}function F(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=(0,s.Kc)(),u=(0,s.Ln)((0,r.pc)());u&&(a&&e.length>0&&0!=i&&(0,s.Cq)(u,e,t,i),(0,s.G4)(u,t,o,a),(0,s.hT)(c,t,(0,r.pc)()),Promise.resolve().then(n.bind(n,412)).then((function(t){t.saveSingleTrial(c,u)})))}},39:(t,e,n)=>{"use strict";n.d(e,{d:()=>g});var r=n(356),i=n(212),s=n(347),o=n(412),a=n(371);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(){u=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var s=e&&e.prototype instanceof w?e:w,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function w(){}function _(){}function b(){}var E={};h(E,o,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,o)&&(E=T);var S=b.prototype=w.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,o,a){var u=f(t[i],t,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==c(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,a)}))}a(u.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=p;return function(s,o){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?y:m,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=f(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(c(e)+" is not iterable")}return _.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:_,configurable:!0}),_.displayName=h(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),h(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(d(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),h(S,l,"Generator"),h(S,o,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return(e=function(t){var e=function(t){if("object"!=c(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function p(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function g(){fetch("feedback.html").then((function(t){return t.text()})).then((function(t){var e=document.getElementById("feedbackContainer");e.innerHTML=t,e.style.display="block";var n=document.getElementById("aiFeedback"),i=document.getElementById("aiFreeResponse"),s=document.getElementById("submitFeedback"),o=document.querySelectorAll("input[type='radio']"),a=document.getElementById("thankYouMessage");if(!(0,r.ej)()){n.style.display="block",i.style.display="flex";var c=document.getElementById("aiHelpfulnessSlider"),u=document.getElementById("sliderValue");c&&c.addEventListener("input",(function(){u.textContent=c.value}))}function l(){var t=(r.dr.AI_HELP===r.Q$.NO_AI?["1-1","1-2","1-3","1-4","1-5","1-6"]:p(new Set(p(o).map((function(t){return t.name}))))).every((function(t){return document.querySelector('input[name="'.concat(t,'"]:checked'))}));s.disabled=!t}o.forEach((function(t){t.addEventListener("change",l)})),["1","2","3"].forEach((function(t){var e=document.getElementById("freeResponse".concat(t)),n=document.getElementById("charCount".concat(t));e.addEventListener("input",(function(){n.textContent="".concat(e.value.length," / 500")}))})),s&&(s.disabled=!0,s.addEventListener("click",(function(){return function(t,e){return y.apply(this,arguments)}(s,a)})))}))}function y(){var t;return t=u().mark((function t(e,n){var c,l,d,f,p,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=(0,s.Fv)(),l=document.getElementById("aiHelpfulnessSlider"),d=null==l?void 0:l.value,f={},["1","2","3"].forEach((function(t){var e=document.getElementById("freeResponse".concat(t));f["freeResponse".concat(t)]=(null==e?void 0:e.value.trim())||""})),p=h(h({choices:{}},f),{},{aiHelpfulness:d?Number(d):null,submittedAt:c}),i.KJ.end_time=c,document.querySelectorAll("input[type='radio']:checked").forEach((function(t){p.choices[t.name]=t.value})),t.next=11,(0,o.saveFeedbackData)(p);case 11:e.disabled=!0,m="",i.KJ.is_passed_attention_check?(0,r.ws)()>=(0,r.X1)()?(m="Thank you for participating in the game! \nYour bonus payment will be distributed shortly.\nNow you will be redirected back to Prolific.",s.oL):(m="Thank you for participating in the game!\nNow you will be redirected back to Prolific.",s.o5):(m="Thank you for participating in the game.\nNow you will be redirected back to Prolific.",(0,a.p$)(),s.be),n.textContent=m,n.style.display="block";case 17:case"end":return t.stop()}}),t)})),y=function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){f(s,r,i,o,a,"next",t)}function a(t){f(s,r,i,o,a,"throw",t)}o(void 0)}))},y.apply(this,arguments)}},120:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{q:()=>p});var i=n(730),s=n(913),o=n(347),a=n(212),c=n(987),u=t([s]);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(){h=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var s=e&&e.prototype instanceof w?e:w,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function w(){}function _(){}function b(){}var E={};u(E,o,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,o)&&(E=T);var S=b.prototype=w.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,o,a){var c=f(t[i],t,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==l(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=p;return function(s,o){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?y:m,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=f(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(l(e)+" is not iterable")}return _.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:_,configurable:!0}),_.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(d(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),u(S,c,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function d(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){d(s,r,i,o,a,"next",t)}function a(t){d(s,r,i,o,a,"throw",t)}o(void 0)}))}}function p(){fetch("consent.html").then((function(t){return t.text()})).then((function(t){i.gV.innerHTML=t;var e=document.getElementById("confirmParticipation"),r=document.getElementById("proceedButton");e.addEventListener("change",(function(){r.disabled=!this.checked})),r.addEventListener("click",f(h().mark((function t(){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.z)();case 2:if(!t.sent){t.next=5;break}return t.abrupt("return");case 5:i.gV.style.display="none",a.KJ.is_consent=!0,a.KJ.create_time=(0,o.Fv)(),Promise.resolve().then(n.bind(n,412)).then((function(t){t.saveOrUpdateUser((0,o.Fv)())})),(0,s.D)();case 10:case"end":return t.stop()}}),t)}))))}))}s=(u.then?(await u)():u)[0],r()}catch(m){r(m)}}))},212:(t,e,n)=>{"use strict";n.d(e,{Cq:()=>d,Cr:()=>o,G4:()=>l,KJ:()=>s,Kc:()=>a,Ln:()=>h,hT:()=>u,lp:()=>c});var r=n(356),i=n(347),s={prolific_pid:"",firebase_uid:"",create_time:new Date,end_time:new Date,is_consent:!1,is_passed_comprehension:!1,is_passed_attention_check:!1,is_passed_all_experiments:!1,experiments:[],num_objects:(0,r.L2)(),exp_group:r.y2[(0,r.qB)()]};function o(){return{experiment_id:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,create_time:(0,i.Fv)(),end_time:(0,i.Fv)(),is_passed_attention_check:!1,is_finished:!1,num_trials:0,total_correct_trials:0,total_ask_ai_count:0,trials:[],comprehension_trials:[]}}function a(){return 0===s.experiments.length?null:s.experiments[0]}function c(t,e,n,r,s){return{trial_id:t,question_id:e,create_time:(0,i.Fv)(),end_time:(0,i.Fv)(),is_comprehension_check:r,is_attention_check:s,score:0,correct_num:0,ai_choice:[],best_choice:[{choices:n,score:100}],user_choice:[],ask_ai_count:0,total_steps:0,total_submissions:0,cur_total_correct_trials:0,cur_total_ask_ai_count:0,total_time:0}}function u(t,e,n){n||(t.num_trials=t.trials.length,t.is_passed_attention_check=s.is_passed_attention_check,t.total_correct_trials=e.correctTrialCount,t.total_ask_ai_count=e.totalAskAICount)}function l(t,e,n,r){t.end_time=(0,i.Fv)(),r&&(t.score=e.lastSubmission.score,t.correct_num=e.lastSubmission.correctChoice,t.total_submissions=e.submissionCount,t.total_steps=e.totalSteps),t.ask_ai_count=e.curTrialAskAICount,t.cur_total_correct_trials=e.correctTrialCount,t.cur_total_ask_ai_count=e.totalAskAICount,t.total_time=n}function h(t){var e=a();if(!e)return null;if(t){if(e.comprehension_trials.length>0)return null==e?void 0:e.comprehension_trials[(0,r.XM)()-1]}else if(e.trials.length>0)return null==e?void 0:e.trials[(0,r.XM)()-1];return null}function d(t,e,n,r){var i=function(t,e,n){return{choices:t,correct_num:e.lastSubmission.correctChoice,score:e.lastSubmission.score,steps:e.lastSubmission.steps,time_spent:n,ask_ai_count:e.lastSubmission.askAICount}}(e,n,r);t.user_choice.push(i)}},347:(t,e,n)=>{"use strict";function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(){return Array.from(document.querySelectorAll(".box")).map((function(t){return t.children.length?t.children[0].id:null}))}function o(t,e){for(var n=0,r=e.length,i=0,s=0;s<r;s++){var o=t.indexOf(e[s]);-1!==o&&(i+=(r-Math.abs(o-s))/r,o===s&&n++)}var a=i/r*100;return{correctChoice:n,score:Number(a%1==0?a.toFixed(0):a.toFixed(1))}}function a(){return new Date}function c(){var t,e,n,i={},s=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=r(t))){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==e.return||e.return()}finally{if(a)throw s}}}}(new URLSearchParams(window.location.search).entries());try{for(s.s();!(t=s.n()).done;){var o=(e=t.value,n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],c=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(e,n)||r(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];i[a]=c}}catch(t){s.e(t)}finally{s.f()}return i}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e="",n=new Uint8Array(t);window.crypto.getRandomValues(n);for(var r=0;r<t;r++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[n[r]%62];return"test_"+e}function l(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function h(t,e){var n=parseFloat(getComputedStyle(document.documentElement).fontSize);return"".concat(t+e*n,"px")}function d(){setTimeout((function(){window.location.replace("https://app.prolific.com/submissions/complete?cc=CIO8X08U ")}),3e3)}function f(){setTimeout((function(){window.location.replace("https://app.prolific.com/submissions/complete?cc=CNBCIADS")}),3e3)}function p(){setTimeout((function(){window.location.replace("https://app.prolific.com/submissions/complete?cc=C1AUM5II")}),3e3)}function m(t){for(var e=function(t){if(Array.isArray(t))return i(t)}(a=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||r(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=e.length-1;n>0;n--){var s=Math.floor(Math.random()*(n+1)),o=[e[s],e[n]];e[n]=o[0],e[s]=o[1]}var a;return e}n.d(e,{Fv:()=>a,Nt:()=>l,QC:()=>s,R3:()=>m,UP:()=>o,Uv:()=>c,be:()=>p,cv:()=>u,hX:()=>h,o5:()=>d,oL:()=>f})},356:(t,e,n)=>{"use strict";n.d(e,{Q$:()=>v,y2:()=>w,qR:()=>g,NV:()=>L,K6:()=>ht,d4:()=>R,nu:()=>et,XI:()=>lt,qB:()=>B,AH:()=>q,X1:()=>ut,xO:()=>mt,mX:()=>T,fi:()=>D,bv:()=>F,XM:()=>M,uO:()=>N,V9:()=>A,L2:()=>E,FJ:()=>at,cf:()=>W,xp:()=>I,mj:()=>Y,ws:()=>ct,Ly:()=>Q,dr:()=>_,sV:()=>tt,IJ:()=>G,R2:()=>x,BY:()=>nt,vy:()=>z,Zn:()=>ft,pc:()=>yt,ej:()=>V,RI:()=>y,fO:()=>J,tG:()=>$,ag:()=>X,b4:()=>K,Jn:()=>O,cM:()=>st,rf:()=>Z,z$:()=>U,Ys:()=>it,D8:()=>rt,ut:()=>j,aE:()=>H,b8:()=>S,jI:()=>b,Th:()=>k,cp:()=>P,VK:()=>pt,Jb:()=>vt,nR:()=>dt,B5:()=>gt,gf:()=>ot});var r=n(730),i={question_id:-3,answer:["A","B","C","D","E"],options:["A","B","C","D","E"],statements:["C is at position 3","A is at position 1","D is at position 4","B is at position 2","E is at position 5"],front_end:["front","end"]},s={question_id:-3,answer:["A","B","C","D","E","F"],options:["A","B","C","D","E","F"],statements:["C is at position 3","A is at position 1","D is at position 4","B is at position 2","E is at position 5","F is at position 6"],front_end:["front","end"]},o=[{question_id:-1,answer:["B","A","C"],options:["A","B","C"],statements:["A is between C and B","C is not next to B","B is the first"],front_end:["front","end"]},{question_id:-2,answer:["C","B","A"],options:["A","B","C"],statements:["C is at position 1","B is behind C","C is exactly 2 spots ahead of A"],front_end:["front","end"]}];function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(t,e,n){return(e=function(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=2,l=2,h=1,d=5,f=!0,p={5:6,6:6},m={5:34,6:19},g={PHASE1:"phase1",PHASE2:"phase2",PHASE3:"phase3"},y={PHASE_QUESTIONS:{phase1:[],phase2:[],phase3:[],extra:[]},phaseIndexMap:{phase1:-1,phase2:-1,phase3:-1,extra:-1}},v={NO_AI:0,LOW_COST_AI:1,HIGH_COST_AI:2,AI_QUESTION_A:3,AI_QUESTION_B:4},w=c(c(c(c(c({},v.NO_AI,"no_ai"),v.LOW_COST_AI,"low_cost_ai"),v.HIGH_COST_AI,"high_cost_ai"),v.AI_QUESTION_A,"ai_question_a"),v.AI_QUESTION_B,"ai_question_b"),_={objectCount:5,curTrialIndex:0,curQuestionIndex:0,questions:[],curPhase:g.PHASE1,phaseTimerEnded:!1,currentPhaseTrialCount:0,performance:{lastSubmission:{correctChoice:0,score:0,steps:0,askAICount:0},curTrialAskAICount:0,submissionCount:0,totalSteps:0,correctTrialCount:0,totalAskAICount:0},remainingSubmissions:u,AI_HELP:v.NO_AI,NUM_REVEAL_OBJECTS:1,remainingAskAICount:d,revealedIndicesThisTrial:new Set,attentionCheckPending:!1,attentionCheckShown:!1,isAttentionCheckVisible:!1,comprehensionCheckShown:!1};function b(t){_.objectCount=t}function E(){return _.objectCount}function I(){var t,e=E();return null!==(t=m[e])&&void 0!==t?t:20}function T(){return _.curPhase}function S(t){_.curPhase=t}function C(){return _.phaseTimerEnded}function k(t){_.phaseTimerEnded=t}function A(){return h}function x(){_.currentPhaseTrialCount++}function O(){_.currentPhaseTrialCount=0}function N(){return _.currentPhaseTrialCount}function R(){return[g.PHASE1,g.PHASE3].includes(T())?C()&&N()>=A():C()}function P(t){_.questions=t}function L(t){if(_.curTrialIndex++,t)return!0;var e=T();if(y.phaseIndexMap[e]<y.PHASE_QUESTIONS[e].length-1)y.phaseIndexMap[e]++;else if(y.phaseIndexMap[e]=y.PHASE_QUESTIONS[e].length,y.phaseIndexMap.extra++,y.phaseIndexMap.extra>=y.PHASE_QUESTIONS.extra.length)return alert("All trials completed!"),!1;return!0}function D(){if(ft())return 5===E()?i:s;if(yt())return o[M()-1];var t=T(),e=y.phaseIndexMap[t];if(e<y.PHASE_QUESTIONS[t].length)return y.PHASE_QUESTIONS[t][e];var n=y.phaseIndexMap.extra;return y.PHASE_QUESTIONS.extra[n]}function M(){return _.curTrialIndex}function F(){var t=y.phaseIndexMap,e=y.PHASE_QUESTIONS,n=0;for(var r in t){var i,s=t[r],o=(null===(i=e[r])||void 0===i?void 0:i.length)||0;-1!==s&&(n+=s<o?s+1:o)}return n}function U(){_.curTrialIndex=0}function V(){return _.AI_HELP===v.NO_AI}function j(t){_.AI_HELP=t}function B(){return _.AI_HELP}function H(t){_.NUM_REVEAL_OBJECTS=t}function q(){return _.NUM_REVEAL_OBJECTS}function z(){return!V()&&!yt()&&!ft()&&T()===g.PHASE2}function $(){return _.remainingAskAICount}function K(){_.remainingAskAICount=d,_.revealedIndicesThisTrial.clear(),r.UT.style.visibility="hidden"}function G(){!f&&_.remainingAskAICount>0&&_.remainingAskAICount--,_.performance.lastSubmission.askAICount++,_.performance.curTrialAskAICount++,_.performance.totalAskAICount++}function W(){return _.revealedIndicesThisTrial}function J(t){_.revealedIndicesThisTrial.add(t),_.revealedIndicesThisTrial.size>=E()&&_.revealedIndicesThisTrial.clear()}function Q(){return _.performance.totalAskAICount}function Y(){return _.attentionCheckShown&&_.isAttentionCheckVisible?1:u}function X(){return _.remainingSubmissions}function Z(){_.remainingSubmissions=Y()}function tt(){return _.remainingSubmissions!==Y()}function et(t){_.remainingSubmissions>0&&_.remainingSubmissions--,100==t&&(_.remainingSubmissions=0)}function nt(){_.performance.totalSteps++,_.performance.lastSubmission.steps++}function rt(){_.performance.totalSteps=0}function it(){st(),_.performance.curTrialAskAICount=0,_.performance.submissionCount=0}function st(){_.performance.lastSubmission.correctChoice=0,_.performance.lastSubmission.score=0,_.performance.lastSubmission.steps=0,_.performance.lastSubmission.askAICount=0}function ot(t,e){_.performance.lastSubmission.correctChoice=t,_.performance.lastSubmission.score=e,_.performance.submissionCount++,100!==e||ft()||yt()||_.performance.correctTrialCount++}function at(){return _.performance}function ct(){return _.performance.correctTrialCount}function ut(){var t=E();return p[t]}function lt(){_.attentionCheckPending=!0}function ht(){return _.attentionCheckShown}function dt(){return!(!_.attentionCheckPending||_.comprehensionCheckShown||_.attentionCheckShown||(_.attentionCheckPending=!1,_.attentionCheckShown=!0,_.isAttentionCheckVisible=!0,0))}function ft(){return _.isAttentionCheckVisible}function pt(){return!(!_.attentionCheckShown||!_.isAttentionCheckVisible||(_.isAttentionCheckVisible=!1,0))}function mt(){return l}function gt(){return!_.comprehensionCheckShown&&(_.comprehensionCheckShown=!0,!0)}function yt(){return _.comprehensionCheckShown}function vt(){return!!_.comprehensionCheckShown&&(_.comprehensionCheckShown=!1,!0)}},371:(t,e,n)=>{"use strict";n.d(e,{Bl:()=>d,Cc:()=>f,KE:()=>m,M0:()=>_,Re:()=>g,Sz:()=>w,ZS:()=>v,aT:()=>u,gI:()=>y,p$:()=>p});var r=n(730),i=n(39),s=n(356);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var s=e&&e.prototype instanceof w?e:w,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function w(){}function _(){}function b(){}var E={};h(E,c,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,c)&&(E=T);var S=b.prototype=w.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,a,c){var u=f(t[i],t,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==o(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=p;return function(s,o){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?y:m,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=f(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(o(e)+" is not iterable")}return _.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:_,configurable:!0}),_.displayName=h(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),h(k.prototype,u,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(d(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),h(S,l,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function c(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function u(){return l.apply(this,arguments)}function l(){var t;return t=a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("modal.html");case 2:return e=t.sent,t.next=5,e.text();case 5:n=t.sent,r.jT.innerHTML=n,document.getElementById("closeModal").addEventListener("click",(function(){document.getElementById("modalOverlay").style.display="none"}));case 8:case"end":return t.stop()}}),t)})),l=function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){c(s,r,i,o,a,"next",t)}function a(t){c(s,r,i,o,a,"throw",t)}o(void 0)}))},l.apply(this,arguments)}function h(t){t.context;var e=t.html,n=t.buttonText,i=void 0===n?"OK":n,s=t.onClose,o=void 0===s?null:s,a=t.confirmButtons,c=void 0!==a&&a,u=t.onConfirm,l=void 0===u?null:u,h=t.onCancel,d=void 0===h?null:h;r.jT.style.display="block",document.getElementById("modalInfo").innerHTML=e;var f=document.getElementById("modalOverlay");f.style.display="flex";var p=document.getElementById("modalButtonWrapper");if(p.innerHTML="",c){var m=document.createElement("button");m.textContent="Confirm",m.addEventListener("click",(function(){f.style.display="none","function"==typeof l&&l()}));var g=document.createElement("button");g.textContent="Cancel",g.style.marginLeft="10px",g.addEventListener("click",(function(){f.style.display="none","function"==typeof d&&d()})),p.appendChild(m),p.appendChild(g)}else{var y=document.createElement("button");y.textContent=i,y.addEventListener("click",(function(){f.style.display="none","function"==typeof o&&o()})),p.appendChild(y)}}function d(){var t=(0,s.xO)();h({context:"comprehension",html:"<p>\n      Now, you will play ".concat(t," comprehension check trials. Please carefully read the\n      instructions and make your choices.\n    </p>")})}function f(){h({context:"fail-comprehension",html:"<p>\n      You did not pass this comprehension check trial after two attempts, \n      so the study has ended, and <strong>no compensation will be provided.</strong><br/><br/>\n      Please <strong>return</strong> your submission by closing this study and clicking â€˜Stop Without Completingâ€™ on Prolific.\n    </p>"})}function p(){h({context:"fail-attention-all",html:"<p>\n      Unfortunately, you did not pass the attention check trial. Now the game is over, \n      and you will be redirected back to Prolific.\n    </p>"})}function m(){h({context:"multiple-attempts",html:"<p>\n      You have already participated in this study. Participation is limited to one time only.<br/><br/>\n      Please <strong>return</strong> your submission by closing this study and clicking â€˜Stop Without Completingâ€™ on Prolific.\n    </p>"}),(0,r.eb)()}function g(){h({context:"start-main-game",html:"<p>\n      Youâ€™ve passed the comprehension check.<br/><br/> \n      You may now begin the main study <strong>Phase 1</strong> by clicking <strong>NEXT TRIAL</strong>.\n    </p>"})}function y(){h({context:"need-more-trials",html:"<p>\n      The timer for this phase has ended.<br/>\n      However, to proceed to the next phase, you must complete at least <strong>".concat((0,s.V9)()," trials</strong>.<br/><br/>\n      Please continue until you reach the minimum requirement.\n    </p>")})}function v(t){h({context:"enter-phase2",html:"<p>\n      Now you will move to <strong>Phase 2</strong>.<br/>\n      You will have <strong>20 minutes</strong> for this phase.\n    </p>",onClose:t})}function w(t){h({context:"enter-phase3",html:"<p>\n      You're entering <strong>Phase 3</strong>.<br/>\n      This final stage lasts around 8 minute with <em>no AI help</em>.<br/>\n      Do your best!\n    </p>",onClose:t})}function _(){h({context:"end-time",html:"<p>\n      Time's up! Thank you for your effort.<br/>\n      Please take a moment to complete a brief survey.\n    </p>",onClose:function(){gameContainer.style.display="none",(0,i.d)()}})}n(13)},412:(t,e,n)=>{"use strict";n.r(e),n.d(e,{checkIfUserExists:()=>cf,firebaseUserId:()=>nf,saveFeedbackData:()=>pf,saveOrUpdateUser:()=>of,saveSingleTrial:()=>rf});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=r(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return i.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},u=t=>{var e,n;return null===(n=null===(e=c())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},l=()=>{var t;return null===(t=c())||void 0===t?void 0:t.config},h=t=>{var e;return null===(e=c())||void 0===e?void 0:e[`_${t}`]};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function f(t){return t.endsWith(".cloudworkstations.dev")}async function p(t){return(await fetch(t,{credentials:"include"})).ok}const m={};let g=!1;function y(t,e){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||m[t]===e||m[t]||g)return;function n(t){return`__firebase__banner__${t}`}m[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(m))m[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function s(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),s=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,o);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{g=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,c),e.append(u,s,a,n),document.body.appendChild(e)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function w(){return!function(){var t;const e=null===(t=c())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class _ extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(E,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new _(r,o,n)}}const E=/\{\$([^}]+)}/g;function I(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(T(n)&&T(s)){if(!I(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function T(t){return null!==t&&"object"==typeof t}function S(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function C(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,r]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(r)}})),e}function k(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class A{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let r;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=x),void 0===r.error&&(r.error=x),void 0===r.complete&&(r.complete=x);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}})),this.observers.push(r),i}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function x(){}function O(t){return t&&t._delegate?t._delegate:t}class N{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const R="[DEFAULT]";class P{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new d;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:R})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=R){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=R){return this.instances.has(t)}getOptions(t=R){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===R?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=R){return this.component?this.component.multipleInstances?t:R:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new P(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const D=[];var M;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(M||(M={}));const F={debug:M.DEBUG,verbose:M.VERBOSE,info:M.INFO,warn:M.WARN,error:M.ERROR,silent:M.SILENT},U=M.INFO,V={[M.DEBUG]:"log",[M.VERBOSE]:"log",[M.INFO]:"info",[M.WARN]:"warn",[M.ERROR]:"error"},j=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=V[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class B{constructor(t){this.name=t,this._logLevel=U,this._logHandler=j,this._userLogHandler=null,D.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in M))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?F[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,M.DEBUG,...t),this._logHandler(this,M.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,M.VERBOSE,...t),this._logHandler(this,M.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,M.INFO,...t),this._logHandler(this,M.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,M.WARN,...t),this._logHandler(this,M.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,M.ERROR,...t),this._logHandler(this,M.ERROR,...t)}}let H,q;const z=new WeakMap,$=new WeakMap,K=new WeakMap,G=new WeakMap,W=new WeakMap;let J={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return $.get(t);if("objectStoreNames"===e)return t.objectStoreNames||K.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Y(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Q(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(X(this),t),Y(z.get(this))}:function(...t){return Y(e.apply(X(this),t))}:function(t,...n){const r=e.call(X(this),t,...n);return K.set(r,t.sort?t.sort():[t]),Y(r)}:(t instanceof IDBTransaction&&function(t){if($.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));$.set(t,e)}(t),n=t,(H||(H=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,J):t);var e,n}function Y(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(Y(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&z.set(e,t)})).catch((()=>{})),W.set(e,t),e}(t);if(G.has(t))return G.get(t);const e=Q(t);return e!==t&&(G.set(t,e),W.set(e,t)),e}const X=t=>W.get(t),Z=["get","getKey","getAll","getAllKeys","count"],tt=["put","add","delete","clear"],et=new Map;function nt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(et.get(e))return et.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=tt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Z.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return et.set(e,s),s}var rt;rt=J,J={...rt,get:(t,e,n)=>nt(t,e)||rt.get(t,e,n),has:(t,e)=>!!nt(t,e)||rt.has(t,e)};class it{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const st="@firebase/app",ot="0.13.0",at=new B("@firebase/app"),ct="@firebase/app-compat",ut="@firebase/analytics-compat",lt="@firebase/analytics",ht="@firebase/app-check-compat",dt="@firebase/app-check",ft="@firebase/auth",pt="@firebase/auth-compat",mt="@firebase/database",gt="@firebase/data-connect",yt="@firebase/database-compat",vt="@firebase/functions",wt="@firebase/functions-compat",_t="@firebase/installations",bt="@firebase/installations-compat",Et="@firebase/messaging",It="@firebase/messaging-compat",Tt="@firebase/performance",St="@firebase/performance-compat",Ct="@firebase/remote-config",kt="@firebase/remote-config-compat",At="@firebase/storage",xt="@firebase/storage-compat",Ot="@firebase/firestore",Nt="@firebase/ai",Rt="@firebase/firestore-compat",Pt="firebase",Lt="[DEFAULT]",Dt={[st]:"fire-core",[ct]:"fire-core-compat",[lt]:"fire-analytics",[ut]:"fire-analytics-compat",[dt]:"fire-app-check",[ht]:"fire-app-check-compat",[ft]:"fire-auth",[pt]:"fire-auth-compat",[mt]:"fire-rtdb",[gt]:"fire-data-connect",[yt]:"fire-rtdb-compat",[vt]:"fire-fn",[wt]:"fire-fn-compat",[_t]:"fire-iid",[bt]:"fire-iid-compat",[Et]:"fire-fcm",[It]:"fire-fcm-compat",[Tt]:"fire-perf",[St]:"fire-perf-compat",[Ct]:"fire-rc",[kt]:"fire-rc-compat",[At]:"fire-gcs",[xt]:"fire-gcs-compat",[Ot]:"fire-fst",[Rt]:"fire-fst-compat",[Nt]:"fire-vertex","fire-js":"fire-js",[Pt]:"fire-js-all"},Mt=new Map,Ft=new Map,Ut=new Map;function Vt(t,e){try{t.container.addComponent(e)}catch(n){at.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function jt(t){const e=t.name;if(Ut.has(e))return at.debug(`There were multiple attempts to register component ${e}.`),!1;Ut.set(e,t);for(const e of Mt.values())Vt(e,t);for(const e of Ft.values())Vt(e,t);return!0}function Bt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ht(t){return null!=t&&void 0!==t.settings}const qt=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class zt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new N("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw qt.create("app-deleted",{appName:this._name})}}const $t="11.8.0";function Kt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Lt,automaticDataCollectionEnabled:!0},e),i=r.name;if("string"!=typeof i||!i)throw qt.create("bad-app-name",{appName:String(i)});if(n||(n=l()),!n)throw qt.create("no-options");const s=Mt.get(i);if(s){if(I(n,s.options)&&I(r,s.config))return s;throw qt.create("duplicate-app",{appName:i})}const o=new L(i);for(const t of Ut.values())o.addComponent(t);const a=new zt(n,r,o);return Mt.set(i,a),a}function Gt(t=Lt){const e=Mt.get(t);if(!e&&t===Lt&&l())return Kt();if(!e)throw qt.create("no-app",{appName:t});return e}function Wt(t,e,n){var r;let i=null!==(r=Dt[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void at.warn(t.join(" "))}jt(new N(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const Jt="firebase-heartbeat-store";let Qt=null;function Yt(){return Qt||(Qt=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Y(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(Y(o.result),t.oldVersion,t.newVersion,Y(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Jt)}catch(t){console.warn(t)}}}).catch((t=>{throw qt.create("idb-open",{originalErrorMessage:t.message})}))),Qt}async function Xt(t,e){try{const n=(await Yt()).transaction(Jt,"readwrite"),r=n.objectStore(Jt);await r.put(e,Zt(t)),await n.done}catch(t){if(t instanceof _)at.warn(t.message);else{const e=qt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});at.warn(e.message)}}}function Zt(t){return`${t.name}!${t.options.appId}`}class te{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ne(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ee();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){at.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=ee(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),re(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),re(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=o(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return at.warn(t),""}}}function ee(){return(new Date).toISOString().substring(0,10)}class ne{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Yt()).transaction(Jt),n=await e.objectStore(Jt).get(Zt(t));return await e.done,n}catch(t){if(t instanceof _)at.warn(t.message);else{const e=qt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});at.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function re(t){return o(JSON.stringify({version:2,heartbeats:t})).length}jt(new N("platform-logger",(t=>new it(t)),"PRIVATE")),jt(new N("heartbeat",(t=>new te(t)),"PRIVATE")),Wt(st,ot,""),Wt(st,ot,"esm2017"),Wt("fire-js",""),Wt("firebase","11.8.1","app");var ie,se,oe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ae={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var i={};function s(t){return-128<=t&&128>t?function(t){var e=i;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function l(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function m(t,e){this.g=t,this.h=e}function g(t,e){if(l(e))throw Error("division by zero");if(l(t))return new m(a,a);if(h(t))return e=g(d(t),e),new m(d(e.g),d(e.h));if(h(e))return e=g(t,d(e)),new m(d(e.g),e.h);if(30<t.g.length){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=s.add(r);0>=u.l(t)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return e=f(t,i.j(e)),new m(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(e);h(u)||0<u.l(t);)u=(s=o(n-=r)).j(e);l(s)&&(s=c),i=i.add(s),t=f(t,u)}return new m(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],o=0;o<i;o++)s[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(h(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(h(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var i=g(n,e).g,s=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(l(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var o=i+(65535&this.i(s))+(65535&t.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(0>this.l(u)&&0>t.l(u))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),m=t.i(s)>>>16,g=65535&t.i(s);n[2*i+2*s]+=f*g,p(n,2*i+2*s),n[2*i+2*s+1]+=c*g,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*m,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*m,p(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new r(n,0)},t.A=function(t){return g(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,se=ae.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<e.length;s+=8){var c=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},ie=ae.Integer=r}).apply(void 0!==oe?oe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ce,ue,le,he,de,fe,pe,me,ge="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ye={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ge&&ge];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t,e){return e}))}}));var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(s(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function m(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function g(t){return g[" "](t),t}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<_.length;e++)n=_[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function E(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function I(t){i.setTimeout((()=>{throw t}),0)}function T(){var t=x;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var S=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new C),(t=>t.reset()));class C{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let k,A=!1,x=new class{constructor(){this.h=this.g=null}add(t,e){const n=S.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const t=i.Promise.resolve(void 0);k=()=>{t.then(N)}};var N=()=>{for(var t;t=T();){try{t.h.call(t.g)}catch(t){I(t)}var e=S;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}A=!1};function R(){this.s=this.s,this.C=this.C}function P(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function D(t,e){if(P.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{g(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:M[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&D.aa.h.call(this)}}h(D,P);var M={2:"touch",3:"pen",4:"mouse"};D.prototype.h=function(){D.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function j(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function B(t){this.src=t,this.g={},this.h=0}function H(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(j(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function q(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}B.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=q(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new V(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),$={};function K(t,e,n,r,i){if(r&&r.once)return W(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)K(t,e[s],n,r,i);return null}return n=et(n),t&&t[F]?t.K(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!1,r,i)}function G(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(t);if(c||(t[z]=c=new B(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=X;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)L||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function W(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)W(t,e[s],n,r,i);return null}return n=et(n),t&&t[F]?t.L(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!0,r,i)}function J(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)J(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[F]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=q(s=t.g[e],n,r,i))&&(j(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=q(e,n,r,i)),(n=-1<t?e[t]:null)&&Q(n))}function Q(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[F])H(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(H(n,t),0==n.h&&(n.src=null,e[z]=null)):j(t)}}}function Y(t){return t in $?$[t]:$[t]="on"+t}function X(t,e){if(t.da)t=!0;else{e=new D(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&Q(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof B?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){R.call(this),this.i=new B(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new P(e,t);else if(e instanceof P)e.target=e.target||t;else{var i=e;b(e=new P(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=it(o,r,!0,e)&&i}if(i=it(o=e.g=t,r,!0,e)&&i,i=it(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=it(o=e.g=n[s],r,!1,e)&&i}function it(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&H(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function st(t,e,n){if("function"==typeof t)n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=st((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(nt,R),nt.prototype[F]=!0,nt.prototype.removeEventListener=function(t,e,n,r){J(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)j(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends R{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){R.call(this),this.h=t,this.g={}}h(ct,R);var ut=[];function lt(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Q(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),lt(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ht=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function pt(){}function mt(t){return t.h||(t.h=t.i())}function gt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){P.call(this,"d")}function wt(){P.call(this,"c")}h(vt,P),h(wt,P);var _t={},bt=null;function Et(){return bt=bt||new nt}function It(t){P.call(this,_t.La,t)}function Tt(t){const e=Et();rt(e,new It(e))}function St(t,e){P.call(this,_t.STAT_EVENT,t),this.stat=e}function Ct(t){const e=Et();rt(e,new St(e,t))}function kt(t,e){P.call(this,_t.Ma,t),this.size=e}function At(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function xt(){this.g=!0}function Ot(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ht(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}_t.La="serverreachability",h(It,P),_t.STAT_EVENT="statevent",h(St,P),_t.Ma="timingevent",h(kt,P),xt.prototype.xa=function(){this.g=!1},xt.prototype.info=function(){};var Nt,Rt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Lt(){}function Dt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Mt}function Mt(){this.i=null,this.g="",this.h=!1}h(Lt,pt),Lt.prototype.g=function(){return new XMLHttpRequest},Lt.prototype.i=function(){return{}},Nt=new Lt;var Ft={},Ut={};function Vt(t,e,n){t.L=1,t.v=be(oe(e)),t.m=n,t.P=!0,jt(t,null)}function jt(t,e){t.F=Date.now(),qt(t),t.A=oe(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),De(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Mt,t.g=In(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(u(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ut[0]=i.toString()),i=ut);for(var s=0;s<i.length;s++){var o=K(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Tt(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function Bt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function Ht(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ut:(n=Number(e.substring(n,r)),isNaN(n)?Ft:(r+=1)+n>e.length?Ut:(e=e.slice(r,r+n),t.C=r+n,e))}function qt(t){t.S=Date.now()+t.I,zt(t,t.I)}function zt(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=At(u(t.ba,t),e)}function $t(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function Kt(t){0==t.j.G||t.J||vn(t.j,t)}function Gt(t){$t(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,lt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function Wt(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||Zt(n.h,t)))if(!t.K&&Zt(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),an(n)}pn(n),Ct(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=At(u(n.Za,n),6e3));if(1>=Xt(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else _n(n,11)}else if((t.K||n.g==t)&&yn(n),!p(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const e=u[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(te(s,s.h),s.h=null))}if(r.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,_e(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=En(r,r.J?r.ia:null,r.W),o.K){ee(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&($t(a),qt(a)),r.g=o}else fn(r);0<n.i.length&&un(n)}else"stop"!=u[0]&&"close"!=u[0]||_n(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?_n(n,7):on(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Tt()}catch(t){}}Dt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==en(t)?e.j():this.Y(t)},Dt.prototype.Y=function(t){try{if(t==this.g)t:{const d=en(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==e||Tt(),$t(this);var n=this.g.Z();this.X=n;e:if(Bt(this)){var r=nn(this.g);t="";var s=r.length,o=4==en(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Gt(this),Kt(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break e}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ct(12),Gt(this),Kt(this);break t}Ot(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wt(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=Ht(this,a),t==Ut){4==d&&(this.s=4,Ct(14),n=!1),Ot(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ft){this.s=4,Ct(15),Ot(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ot(this.i,this.l,t,null),Wt(this,t)}if(Bt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ct(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(h),h.M=!0,Ct(11))}}else Ot(this.i,this.l,a,"[Invalid Chunked Response]"),Gt(this),Kt(this)}else Ot(this.i,this.l,a,null),Wt(this,a);4==d&&Gt(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,qt(this)))}else(function(t){const e={};t=(t.g&&2<=en(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=E(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ct(12)):(this.s=0,Ct(13)),Gt(this),Kt(this)}}}catch(t){}},Dt.prototype.cancel=function(){this.J=!0,Gt(this)},Dt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(Tt(),Ct(17)),Gt(this),this.s=2,Kt(this)):zt(this,this.S-t)};var Jt=class{constructor(t,e){this.g=t,this.map=e}};function Qt(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Yt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Xt(t){return t.h?1:t.g?t.g.size:0}function Zt(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function te(t,e){t.g?t.g.add(e):t.h=e}function ee(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ne(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function re(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(s(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}Qt.prototype.cancel=function(){if(this.i=ne(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ie=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function se(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof se){this.h=t.h,ae(this,t.j),this.o=t.o,this.g=t.g,ve(this,t.s),this.l=t.l;var e=t.i,n=new Ne;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),we(this,n),this.m=t.m}else t&&(e=String(t).match(ie))?(this.h=!1,ae(this,e[1]||"",!0),this.o=Ee(e[2]||""),this.g=Ee(e[3]||"",!0),ve(this,e[4]),this.l=Ee(e[5]||"",!0),we(this,e[6]||"",!0),this.m=Ee(e[7]||"")):(this.h=!1,this.i=new Ne(null,this.h))}function oe(t){return new se(t)}function ae(t,e,n){t.j=n?Ee(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ve(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function we(t,e,n){e instanceof Ne?(t.i=e,function(t,e){e&&!t.j&&(Re(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Pe(this,e),De(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ie(e,xe)),t.i=new Ne(e,t.h))}function _e(t,e,n){t.i.set(e,n)}function be(t){return _e(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ee(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ie(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Te),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Te(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}se.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ie(e,Ce,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Ie(e,Ce,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ie(n,"/"==n.charAt(0)?Ae:ke,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Ie(n,Oe)),t.join("")};var Se,Ce=/[#\/\?@]/g,ke=/[#\?:]/g,Ae=/[#\?]/g,xe=/[#\?@]/g,Oe=/#/g;function Ne(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Re(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Pe(t,e){Re(t),e=Me(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Le(t,e){return Re(t),e=Me(t,e),t.g.has(e)}function De(t,e,n){Pe(t,e),0<n.length&&(t.i=null,t.g.set(Me(t,e),d(n)),t.h+=n.length)}function Me(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Fe(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function Ue(){this.g=new ft}function Ve(t,e,n){const r=n||"";try{re(t,(function(t,n){let i=t;o(t)&&(i=ht(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function je(t){this.l=t.Ub||null,this.j=t.eb||!1}function Be(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function He(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function qe(t){t.readyState=4,t.l=null,t.j=null,t.v=null,ze(t)}function ze(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function $e(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ke(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=$e(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):_e(t,e,n))}function Ge(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Ne.prototype).add=function(t,e){Re(this),this.i=null,t=Me(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Re(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Re(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Re(this);let e=[];if("string"==typeof t)Le(this,t)&&(e=e.concat(this.g.get(Me(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Re(this),this.i=null,Le(this,t=Me(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},h(je,pt),je.prototype.g=function(){return new Be(this.l,this.j)},je.prototype.i=(Se={},function(){return Se}),h(Be,nt),(t=Be.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,ze(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qe(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ze(this)),this.g&&(this.readyState=3,ze(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;He(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?qe(this):ze(this),3==this.readyState&&He(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,qe(this))},t.Qa=function(t){this.g&&(this.response=t,qe(this))},t.ga=function(){this.g&&qe(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Be.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h(Ge,nt);var We=/^https?$/i,Je=["POST","PUT"];function Qe(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Ye(t),Ze(t)}function Ye(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function Xe(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=en(t)||2!=t.Z()))if(t.u&&4==en(t))st(t.Ea,0,t);else if(rt(t,"readystatechange"),4==en(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(ie)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!We.test(o?o.toLowerCase():"")}n=s}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<en(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Ye(t)}}finally{Ze(t)}}}function Ze(t,e){if(t.g){tn(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function tn(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function en(t){return t.g?t.g.readyState:0}function nn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sn(t){this.Aa=0,this.i=[],this.j=new xt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new Qt(t&&t.concurrentRequestLimit),this.Da=new Ue,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(t){if(cn(t),3==t.G){var e=t.U++,n=oe(t.I);if(_e(n,"SID",t.K),_e(n,"RID",e),_e(n,"TYPE","terminate"),hn(t,n),(e=new Dt(t,t.j,e)).L=2,e.v=be(oe(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=In(e.j,null),e.g.ea(e.v)),e.F=Date.now(),qt(e)}bn(t)}function an(t){t.g&&(mn(t),t.g.cancel(),t.g=null)}function cn(t){an(t),t.u&&(i.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function un(t){if(!Yt(t.h)&&!t.s){t.s=!0;var e=t.Ga;k||O(),A||(k(),A=!0),x.add(e,t),t.B=0}}function ln(t,e){var n;n=e?e.l:t.U++;const r=oe(t.I);_e(r,"SID",t.K),_e(r,"RID",n),_e(r,"AID",t.T),hn(t,r),t.m&&t.o&&Ke(r,t.m,t.o),n=new Dt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),te(t.h,n),Vt(n,r,e)}function hn(t,e){t.H&&v(t.H,(function(t,n){_e(e,n,t)})),t.l&&re({},(function(t,n){_e(e,n,t)}))}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?u(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{Ve(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;k||O(),A||(k(),A=!0),x.add(e,t),t.v=0}}function pn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=At(u(t.Fa,t),wn(t,t.v)),t.v++,0))}function mn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function gn(t){t.g=new Dt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=oe(t.qa);_e(e,"RID","rpc"),_e(e,"SID",t.K),_e(e,"AID",t.T),_e(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&_e(e,"TO",t.ja),_e(e,"TYPE","xmlhttp"),hn(t,e),t.m&&t.o&&Ke(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=be(oe(e)),n.m=null,n.P=!0,jt(n,t)}function yn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),mn(t),t.g=null;var r=2}else{if(!Zt(t.h,e))return;n=e.D,ee(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;rt(r=Et(),new kt(r,n)),un(t)}else fn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(Xt(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=At(u(t.Ga,t,e),wn(t,t.B)),t.B++,0)))}(t,e)||2==r&&pn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:_n(t,5);break;case 4:_n(t,10);break;case 3:_n(t,6);break;default:_n(t,2)}}function wn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function _n(t,e){if(t.j.info("Error code "+e),2==e){var n=u(t.fb,t),r=t.Xa;const e=!r;r=new se(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ae(r,"https"),be(r),e?function(t,e){const n=new xt;if(i.Image){const r=new Image;r.onload=l(Fe,n,"TestLoadImage: loaded",!0,e,r),r.onerror=l(Fe,n,"TestLoadImage: error",!1,e,r),r.onabort=l(Fe,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=l(Fe,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new xt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Fe(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Fe(0,0,!0,e):Fe(0,0,!1,e)})).catch((()=>{clearTimeout(r),Fe(0,0,!1,e)}))}(r.toString(),n)}else Ct(2);t.G=0,t.l&&t.l.sa(e),bn(t),cn(t)}function bn(t){if(t.G=0,t.ka=[],t.l){const e=ne(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function En(t,e,n){var r=n instanceof se?oe(n):new se(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ve(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new se(null);r&&ae(o,r),e&&(o.g=e),s&&ve(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&_e(r,n,e),_e(r,"VER",t.la),hn(t,r),r}function In(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Ge(new je({eb:n})):new Ge(t.pa)).Ha(t.J),e}function Tn(){}function Sn(){}function Cn(t,e){nt.call(this),this.g=new sn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new xn(this)}function kn(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function An(){wt.call(this),this.status=1}function xn(t){this.g=t}(t=Ge.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Nt.g(),this.v=this.o?mt(this.o):mt(Nt),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Qe(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Je,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Qe(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),Ze(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ze(this,!0)),Ge.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Xe(this):this.bb())},t.bb=function(){Xe(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<en(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=sn.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){Ct(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=En(this,null,this.W),un(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Dt(this,this.j,t);let s=this.o;if(this.S&&(s?(s=w(s),b(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,i,e),_e(n=oe(this.I),"RID",t),_e(n,"CVER",22),this.D&&_e(n,"X-HTTP-Session-Id",this.D),hn(this,n),s&&(this.O?e="headers="+encodeURIComponent(String($e(s)))+"&"+e:this.m&&Ke(n,this.m,s)),te(this.h,i),this.Ua&&_e(n,"TYPE","init"),this.P?(_e(n,"$req",e),_e(n,"SID","null"),i.T=!0,Vt(i,n,null)):Vt(i,n,e),this.G=2}}else 3==this.G&&(t?ln(this,t):0==this.i.length||Yt(this.h)||ln(this))},t.Fa=function(){if(this.u=null,gn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=At(u(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ct(10),an(this),gn(this))},t.Za=function(){null!=this.C&&(this.C=null,an(this),pn(this),Ct(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),Ct(2)):(this.j.info("Failed to ping google.com"),Ct(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Tn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Sn.prototype.g=function(t,e){return new Cn(t,e)},h(Cn,nt),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){on(this.g)},Cn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=ht(t),t=n);e.i.push(new Jt(e.Ya++,t)),3==e.G&&un(e)},Cn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,Cn.aa.N.call(this)},h(kn,vt),h(An,wt),h(xn,Tn),xn.prototype.ua=function(){rt(this.g,"a")},xn.prototype.ta=function(t){rt(this.g,new kn(t))},xn.prototype.sa=function(t){rt(this.g,new An)},xn.prototype.ra=function(){rt(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,me=ye.createWebChannelTransport=function(){return new Sn},pe=ye.getStatEventTarget=function(){return Et()},fe=ye.Event=_t,de=ye.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rt.NO_ERROR=0,Rt.TIMEOUT=8,Rt.HTTP_ERROR=6,he=ye.ErrorCode=Rt,Pt.COMPLETE="complete",le=ye.EventType=Pt,gt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,ue=ye.WebChannel=gt,ye.FetchXmlHttpFactory=je,Ge.prototype.listenOnce=Ge.prototype.L,Ge.prototype.getLastError=Ge.prototype.Ka,Ge.prototype.getLastErrorCode=Ge.prototype.Ba,Ge.prototype.getStatus=Ge.prototype.Z,Ge.prototype.getResponseJson=Ge.prototype.Oa,Ge.prototype.getResponseText=Ge.prototype.oa,Ge.prototype.send=Ge.prototype.ea,Ge.prototype.setWithCredentials=Ge.prototype.Ha,ce=ye.XhrIo=Ge}).apply(void 0!==ge?ge:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ve="@firebase/firestore",we="4.7.16";class _e{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}_e.UNAUTHENTICATED=new _e(null),_e.GOOGLE_CREDENTIALS=new _e("google-credentials-uid"),_e.FIRST_PARTY=new _e("first-party-uid"),_e.MOCK_USER=new _e("mock-user");let be="11.8.1";const Ee=new B("@firebase/firestore");function Ie(){return Ee.logLevel}function Te(t,...e){if(Ee.logLevel<=M.DEBUG){const n=e.map(ke);Ee.debug(`Firestore (${be}): ${t}`,...n)}}function Se(t,...e){if(Ee.logLevel<=M.ERROR){const n=e.map(ke);Ee.error(`Firestore (${be}): ${t}`,...n)}}function Ce(t,...e){if(Ee.logLevel<=M.WARN){const n=e.map(ke);Ee.warn(`Firestore (${be}): ${t}`,...n)}}function ke(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ae(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,xe(t,r,n)}function xe(t,e,n){let r=`FIRESTORE (${be}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw Se(r),new Error(r)}function Oe(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||xe(e,i,r)}function Ne(t,e){return t}const Re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pe extends _{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Le{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class De{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Me{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(_e.UNAUTHENTICATED)))}shutdown(){}}class Fe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ue{constructor(t){this.t=t,this.currentUser=_e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Oe(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Le;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Le,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Te("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Te("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Le)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Te("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Oe("string"==typeof e.accessToken,31837,{l:e}),new De(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Oe(null===t||"string"==typeof t,2055,{h:t}),new _e(t)}}class Ve{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_e.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class je{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Ve(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(_e.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Be{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class He{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ht(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Oe(void 0===this.o,3512);const n=t=>{null!=t.error&&Te("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,Te("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Te("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):Te("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Be(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Oe("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Be(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function qe(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}function ze(){return new TextEncoder}class $e{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=qe(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ke(t,e){return t<e?-1:t>e?1:0}function Ge(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return Ke(r,i);{const s=ze(),o=Je(s.encode(We(t,n)),s.encode(We(e,n)));return 0!==o?o:Ke(r,i)}}n+=r>65535?2:1}return Ke(t.length,e.length)}function We(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function Je(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return Ke(t[n],e[n]);return Ke(t.length,e.length)}function Qe(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}const Ye=-62135596800,Xe=1e6;class Ze{static now(){return Ze.fromMillis(Date.now())}static fromDate(t){return Ze.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Xe);return new Ze(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Pe(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Pe(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Ye)throw new Pe(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Pe(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Xe}_compareTo(t){return this.seconds===t.seconds?Ke(this.nanoseconds,t.nanoseconds):Ke(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-Ye;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class tn{static fromTimestamp(t){return new tn(t)}static min(){return new tn(new Ze(0,0))}static max(){return new tn(new Ze(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const en="__name__";class nn{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ae(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&Ae(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===nn.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof nn?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=nn.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return Ke(t.length,e.length)}static compareSegments(t,e){const n=nn.isNumericId(t),r=nn.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?nn.extractNumericId(t).compare(nn.extractNumericId(e)):Ge(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ie.fromString(t.substring(4,t.length-2))}}class rn extends nn{construct(t,e,n){return new rn(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Pe(Re.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new rn(e)}static emptyPath(){return new rn([])}}const sn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class on extends nn{construct(t,e,n){return new on(t,e,n)}static isValidIdentifier(t){return sn.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),on.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===en}static keyField(){return new on([en])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Pe(Re.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Pe(Re.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Pe(Re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Pe(Re.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new on(e)}static emptyPath(){return new on([])}}class an{constructor(t){this.path=t}static fromPath(t){return new an(rn.fromString(t))}static fromName(t){return new an(rn.fromString(t).popFirst(5))}static empty(){return new an(rn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===rn.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return rn.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new an(new rn(t.slice()))}}function cn(t){return new un(t.readTime,t.key,-1)}class un{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new un(tn.min(),an.empty(),-1)}static max(){return new un(tn.max(),an.empty(),-1)}}function ln(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=an.comparator(t.documentKey,e.documentKey),0!==n?n:Ke(t.largestBatchId,e.largestBatchId))}class hn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function dn(t){if(t.code!==Re.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Te("LocalStore","Unexpectedly lost primary lease")}class fn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new fn(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof fn?e:fn.resolve(e)}catch(t){return fn.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):fn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):fn.reject(e)}static resolve(t){return new fn(((e,n)=>{e(t)}))}static reject(t){return new fn(((e,n)=>{n(t)}))}static waitFor(t){return new fn(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=fn.resolve(!1);for(const n of t)e=e.next((t=>t?fn.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new fn(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new fn(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function pn(t){return"IndexedDbTransactionError"===t.name}class mn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ue(t),this.ce=t=>e.writeSequenceNumber(t))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ce&&this.ce(t),t}}mn.le=-1;function gn(t){return null==t}function yn(t){return 0===t&&1/t==-1/0}function vn(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function wn(t){return t+""}const _n="owner",bn="mutationQueues",En="mutations",In="documentMutations",Tn="remoteDocumentGlobal",Sn="targets",Cn="targetDocuments",kn="targetGlobal",An="collectionParents",xn="clientMetadata",On="bundles",Nn="namedQueries";function Rn(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pn(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ln(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Dn{constructor(t,e){this.comparator=t,this.root=e||Fn.EMPTY}insert(t,e){return new Dn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Fn.BLACK,null,null))}remove(t){return new Dn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Fn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Mn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Mn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Mn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Mn(this.root,t,this.comparator,!0)}}class Mn{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Fn{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Fn.RED,this.left=null!=r?r:Fn.EMPTY,this.right=null!=i?i:Fn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new Fn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Fn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Fn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ae(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Ae(27949);return t+(this.isRed()?0:1)}}Fn.EMPTY=null,Fn.RED=!0,Fn.BLACK=!1,Fn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ae(57766)}get value(){throw Ae(16141)}get color(){throw Ae(16727)}get left(){throw Ae(29726)}get right(){throw Ae(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new Fn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Un{constructor(t){this.comparator=t,this.data=new Dn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Vn(this.data.getIterator())}getIteratorFrom(t){return new Vn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Un))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Un(this.comparator);return e.data=t,e}}class Vn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class jn{constructor(t){this.fields=t,t.sort(on.comparator)}static empty(){return new jn([])}unionWith(t){let e=new Un(on.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new jn(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Qe(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Bn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Hn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Bn("Invalid base64 string: "+t):t}}(t);return new Hn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Hn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ke(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Hn.EMPTY_BYTE_STRING=new Hn("");const qn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zn(t){if(Oe(!!t,39018),"string"==typeof t){let e=0;const n=qn.exec(t);if(Oe(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$n(t.seconds),nanos:$n(t.nanos)}}function $n(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Kn(t){return"string"==typeof t?Hn.fromBase64String(t):Hn.fromUint8Array(t)}const Gn="server_timestamp",Wn="__type__",Jn="__previous_value__",Qn="__local_write_time__";function Yn(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[Wn])||void 0===n?void 0:n.stringValue)===Gn}function Xn(t){const e=t.mapValue.fields[Jn];return Yn(e)?Xn(e):e}function Zn(t){const e=zn(t.mapValue.fields[Qn].timestampValue);return new Ze(e.seconds,e.nanos)}class tr{constructor(t,e,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const er="(default)";class nr{constructor(t,e){this.projectId=t,this.database=e||er}static empty(){return new nr("","")}get isDefaultDatabase(){return this.database===er}isEqual(t){return t instanceof nr&&t.projectId===this.projectId&&t.database===this.database}}const rr="__type__",ir="__max__",sr={fields:{__type__:{stringValue:ir}}},or="__vector__",ar="value";function cr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Yn(t)?4:Tr(t)?9007199254740991:Er(t)?10:11:Ae(28295,{value:t})}function ur(t,e){if(t===e)return!0;const n=cr(t);if(n!==cr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Zn(t).isEqual(Zn(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=zn(t.timestampValue),r=zn(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Kn(t.bytesValue).isEqual(Kn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return $n(t.geoPointValue.latitude)===$n(e.geoPointValue.latitude)&&$n(t.geoPointValue.longitude)===$n(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return $n(t.integerValue)===$n(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=$n(t.doubleValue),r=$n(e.doubleValue);return n===r?yn(n)===yn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Qe(t.arrayValue.values||[],e.arrayValue.values||[],ur);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Rn(n)!==Rn(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!ur(n[t],r[t])))return!1;return!0}(t,e);default:return Ae(52216,{left:t})}}function lr(t,e){return void 0!==(t.values||[]).find((t=>ur(t,e)))}function hr(t,e){if(t===e)return 0;const n=cr(t),r=cr(e);if(n!==r)return Ke(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ke(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=$n(t.integerValue||t.doubleValue),r=$n(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return dr(t.timestampValue,e.timestampValue);case 4:return dr(Zn(t),Zn(e));case 5:return Ge(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Kn(t),r=Kn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ke(n[t],r[t]);if(0!==e)return e}return Ke(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ke($n(t.latitude),$n(e.latitude));return 0!==n?n:Ke($n(t.longitude),$n(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return fr(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,i,s;const o=t.fields||{},a=e.fields||{},c=null===(n=o[ar])||void 0===n?void 0:n.arrayValue,u=null===(r=a[ar])||void 0===r?void 0:r.arrayValue,l=Ke((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:fr(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===sr&&e===sr)return 0;if(t===sr)return 1;if(e===sr)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Ge(r[t],s[t]);if(0!==e)return e;const o=hr(n[r[t]],i[s[t]]);if(0!==o)return o}return Ke(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Ae(23264,{Pe:n})}}function dr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ke(t,e);const n=zn(t),r=zn(e),i=Ke(n.seconds,r.seconds);return 0!==i?i:Ke(n.nanos,r.nanos)}function fr(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=hr(n[t],r[t]);if(e)return e}return Ke(n.length,r.length)}function pr(t){return mr(t)}function mr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=zn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Kn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return an.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=mr(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${mr(t.fields[i])}`;return n+"}"}(t.mapValue):Ae(61005,{value:t})}function gr(t){switch(cr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Xn(t);return e?16+gr(e):16;case 5:return 2*t.stringValue.length;case 6:return Kn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+gr(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return Pn(t.fields,((t,n)=>{e+=t.length+gr(n)})),e}(t.mapValue);default:throw Ae(13486,{value:t})}}function yr(t){return!!t&&"integerValue"in t}function vr(t){return!!t&&"arrayValue"in t}function wr(t){return!!t&&"nullValue"in t}function _r(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function br(t){return!!t&&"mapValue"in t}function Er(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[rr])||void 0===n?void 0:n.stringValue)===or}function Ir(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Pn(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ir(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ir(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Tr(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ir}class Sr{constructor(t){this.value=t}static empty(){return new Sr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!br(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ir(e)}setAll(t){let e=on.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ir(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());br(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ur(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];br(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Pn(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Sr(Ir(this.value))}}function Cr(t){const e=[];return Pn(t.fields,((t,n)=>{const r=new on([t]);if(br(n)){const t=Cr(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new jn(e)}class kr{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new kr(t,0,tn.min(),tn.min(),tn.min(),Sr.empty(),0)}static newFoundDocument(t,e,n,r){return new kr(t,1,e,tn.min(),n,r,0)}static newNoDocument(t,e){return new kr(t,2,e,tn.min(),tn.min(),Sr.empty(),0)}static newUnknownDocument(t,e){return new kr(t,3,e,tn.min(),tn.min(),Sr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(tn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Sr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Sr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof kr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new kr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ar{constructor(t,e){this.position=t,this.inclusive=e}}function xr(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?an.comparator(an.fromName(o.referenceValue),n.key):hr(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Or(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ur(t.position[n],e.position[n]))return!1;return!0}class Nr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Rr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Pr{}class Lr extends Pr{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Br(t,e,n):"array-contains"===e?new $r(t,n):"in"===e?new Kr(t,n):"not-in"===e?new Gr(t,n):"array-contains-any"===e?new Wr(t,n):new Lr(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Hr(t,n):new qr(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(hr(e,this.value)):null!==e&&cr(this.value)===cr(e)&&this.matchesComparison(hr(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Dr extends Pr{constructor(t,e){super(),this.filters=t,this.op=e,this.Te=null}static create(t,e){return new Dr(t,e)}matches(t){return Mr(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function Mr(t){return"and"===t.op}function Fr(t){return function(t){for(const e of t.filters)if(e instanceof Dr)return!1;return!0}(t)&&Mr(t)}function Ur(t){if(t instanceof Lr)return t.field.canonicalString()+t.op.toString()+pr(t.value);if(Fr(t))return t.filters.map((t=>Ur(t))).join(",");{const e=t.filters.map((t=>Ur(t))).join(",");return`${t.op}(${e})`}}function Vr(t,e){return t instanceof Lr?function(t,e){return e instanceof Lr&&t.op===e.op&&t.field.isEqual(e.field)&&ur(t.value,e.value)}(t,e):t instanceof Dr?function(t,e){return e instanceof Dr&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Vr(n,e.filters[r])),!0)}(t,e):void Ae(19439)}function jr(t){return t instanceof Lr?function(t){return`${t.field.canonicalString()} ${t.op} ${pr(t.value)}`}(t):t instanceof Dr?function(t){return t.op.toString()+" {"+t.getFilters().map(jr).join(" ,")+"}"}(t):"Filter"}class Br extends Lr{constructor(t,e,n){super(t,e,n),this.key=an.fromName(n.referenceValue)}matches(t){const e=an.comparator(t.key,this.key);return this.matchesComparison(e)}}class Hr extends Lr{constructor(t,e){super(t,"in",e),this.keys=zr(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class qr extends Lr{constructor(t,e){super(t,"not-in",e),this.keys=zr(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function zr(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>an.fromName(t.referenceValue)))}class $r extends Lr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return vr(e)&&lr(e.arrayValue,this.value)}}class Kr extends Lr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&lr(this.value.arrayValue,e)}}class Gr extends Lr{constructor(t,e){super(t,"not-in",e)}matches(t){if(lr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!lr(this.value.arrayValue,e)}}class Wr extends Lr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!vr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>lr(this.value.arrayValue,t)))}}class Jr{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function Qr(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Jr(t,e,n,r,i,s,o)}function Yr(t){const e=Ne(t);if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Ur(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),gn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>pr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>pr(t))).join(",")),e.Ie=t}return e.Ie}function Xr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Rr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Vr(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Or(t.startAt,e.startAt)&&Or(t.endAt,e.endAt)}function Zr(t){return an.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class ti{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function ei(t){return new ti(t)}function ni(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function ri(t){const e=Ne(t);if(null===e.Ee){e.Ee=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ee.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Un(on.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ee.push(new Nr(r,n))})),t.has(on.keyField().canonicalString())||e.Ee.push(new Nr(on.keyField(),n))}return e.Ee}function ii(t){const e=Ne(t);return e.de||(e.de=function(t,e){if("F"===t.limitType)return Qr(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Nr(t.field,e)}));const n=t.endAt?new Ar(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ar(t.startAt.position,t.startAt.inclusive):null;return Qr(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,ri(t))),e.de}function si(t,e,n){return new ti(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function oi(t,e){return Xr(ii(t),ii(e))&&t.limitType===e.limitType}function ai(t){return`${Yr(ii(t))}|lt:${t.limitType}`}function ci(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>jr(t))).join(", ")}]`),gn(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>pr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>pr(t))).join(",")),`Target(${e})`}(ii(t))}; limitType=${t.limitType})`}function ui(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):an.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of ri(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=xr(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,ri(t),e)||t.endAt&&!function(t,e,n){const r=xr(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,ri(t),e))}(t,e)}function li(t){return(e,n)=>{let r=!1;for(const i of ri(t)){const t=hi(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function hi(t,e,n){const r=t.field.isKeyField()?an.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?hr(r,i):Ae(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ae(19790,{direction:t.dir})}}class di{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Pn(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Ln(this.inner)}size(){return this.innerSize}}const fi=new Dn(an.comparator);function pi(){return fi}const mi=new Dn(an.comparator);function gi(...t){let e=mi;for(const n of t)e=e.insert(n.key,n);return e}function yi(t){let e=mi;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function vi(){return _i()}function wi(){return _i()}function _i(){return new di((t=>t.toString()),((t,e)=>t.isEqual(e)))}const bi=new Dn(an.comparator),Ei=new Un(an.comparator);function Ii(...t){let e=Ei;for(const n of t)e=e.add(n);return e}const Ti=new Un(Ke);function Si(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yn(e)?"-0":e}}function Ci(t){return{integerValue:""+t}}function ki(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!yn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Ci(e):Si(t,e)}class Ai{constructor(){this._=void 0}}function xi(t,e,n){return t instanceof Ri?function(t,e){const n={fields:{[Wn]:{stringValue:Gn},[Qn]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Yn(e)&&(e=Xn(e)),e&&(n.fields[Jn]=e),{mapValue:n}}(n,e):t instanceof Pi?Li(t,e):t instanceof Di?Mi(t,e):function(t,e){const n=Ni(t,e),r=Ui(n)+Ui(t.Re);return yr(n)&&yr(t.Re)?Ci(r):Si(t.serializer,r)}(t,e)}function Oi(t,e,n){return t instanceof Pi?Li(t,e):t instanceof Di?Mi(t,e):n}function Ni(t,e){return t instanceof Fi?function(t){return yr(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ri extends Ai{}class Pi extends Ai{constructor(t){super(),this.elements=t}}function Li(t,e){const n=Vi(e);for(const e of t.elements)n.some((t=>ur(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Di extends Ai{constructor(t){super(),this.elements=t}}function Mi(t,e){let n=Vi(e);for(const e of t.elements)n=n.filter((t=>!ur(t,e)));return{arrayValue:{values:n}}}class Fi extends Ai{constructor(t,e){super(),this.serializer=t,this.Re=e}}function Ui(t){return $n(t.integerValue||t.doubleValue)}function Vi(t){return vr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class ji{constructor(t,e){this.version=t,this.transformResults=e}}class Bi{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Bi}static exists(t){return new Bi(void 0,t)}static updateTime(t){return new Bi(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Hi(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class qi{}function zi(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ts(t.key,Bi.none()):new Ji(t.key,t.data,Bi.none());{const n=t.data,r=Sr.empty();let i=new Un(on.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Qi(t.key,r,new jn(i.toArray()),Bi.none())}}function $i(t,e,n){t instanceof Ji?function(t,e,n){const r=t.value.clone(),i=Xi(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Qi?function(t,e,n){if(!Hi(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Xi(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Yi(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ki(t,e,n,r){return t instanceof Ji?function(t,e,n,r){if(!Hi(t.precondition,e))return n;const i=t.value.clone(),s=Zi(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Qi?function(t,e,n,r){if(!Hi(t.precondition,e))return n;const i=Zi(t.fieldTransforms,r,e),s=e.data;return s.setAll(Yi(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Hi(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Gi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=Ni(r.transform,t||null);null!=i&&(null===n&&(n=Sr.empty()),n.set(r.field,i))}return n||null}function Wi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qe(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Pi&&e instanceof Pi||t instanceof Di&&e instanceof Di?Qe(t.elements,e.elements,ur):t instanceof Fi&&e instanceof Fi?ur(t.Re,e.Re):t instanceof Ri&&e instanceof Ri}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ji extends qi{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Qi extends qi{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Yi(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Xi(t,e,n){const r=new Map;Oe(t.length===n.length,32656,{Ve:n.length,me:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Oi(o,a,n[i]))}return r}function Zi(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,xi(t,s,e))}return r}class ts extends qi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class es extends qi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ns{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&$i(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ki(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ki(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=wi();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=zi(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(tn.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Ii())}isEqual(t){return this.batchId===t.batchId&&Qe(this.mutations,t.mutations,((t,e)=>Wi(t,e)))&&Qe(this.baseMutations,t.baseMutations,((t,e)=>Wi(t,e)))}}class rs{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Oe(t.mutations.length===n.length,58842,{fe:t.mutations.length,ge:n.length});let r=bi;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new rs(t,e,n,r)}}class is{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ss{constructor(t,e){this.count=t,this.unchangedNames=e}}var os,as;function cs(t){if(void 0===t)return Se("GRPC error has no .code"),Re.UNKNOWN;switch(t){case os.OK:return Re.OK;case os.CANCELLED:return Re.CANCELLED;case os.UNKNOWN:return Re.UNKNOWN;case os.DEADLINE_EXCEEDED:return Re.DEADLINE_EXCEEDED;case os.RESOURCE_EXHAUSTED:return Re.RESOURCE_EXHAUSTED;case os.INTERNAL:return Re.INTERNAL;case os.UNAVAILABLE:return Re.UNAVAILABLE;case os.UNAUTHENTICATED:return Re.UNAUTHENTICATED;case os.INVALID_ARGUMENT:return Re.INVALID_ARGUMENT;case os.NOT_FOUND:return Re.NOT_FOUND;case os.ALREADY_EXISTS:return Re.ALREADY_EXISTS;case os.PERMISSION_DENIED:return Re.PERMISSION_DENIED;case os.FAILED_PRECONDITION:return Re.FAILED_PRECONDITION;case os.ABORTED:return Re.ABORTED;case os.OUT_OF_RANGE:return Re.OUT_OF_RANGE;case os.UNIMPLEMENTED:return Re.UNIMPLEMENTED;case os.DATA_LOSS:return Re.DATA_LOSS;default:return Ae(39323,{code:t})}}(as=os||(os={}))[as.OK=0]="OK",as[as.CANCELLED=1]="CANCELLED",as[as.UNKNOWN=2]="UNKNOWN",as[as.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",as[as.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",as[as.NOT_FOUND=5]="NOT_FOUND",as[as.ALREADY_EXISTS=6]="ALREADY_EXISTS",as[as.PERMISSION_DENIED=7]="PERMISSION_DENIED",as[as.UNAUTHENTICATED=16]="UNAUTHENTICATED",as[as.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",as[as.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",as[as.ABORTED=10]="ABORTED",as[as.OUT_OF_RANGE=11]="OUT_OF_RANGE",as[as.UNIMPLEMENTED=12]="UNIMPLEMENTED",as[as.INTERNAL=13]="INTERNAL",as[as.UNAVAILABLE=14]="UNAVAILABLE",as[as.DATA_LOSS=15]="DATA_LOSS";const us=new ie([4294967295,4294967295],0);function ls(t){const e=ze().encode(t),n=new se;return n.update(e),new Uint8Array(n.digest())}function hs(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ie([n,r],0),new ie([i,s],0)]}class ds{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new fs(`Invalid padding: ${e}`);if(n<0)throw new fs(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new fs(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new fs(`Invalid padding when bitmap length is 0: ${e}`);this.pe=8*t.length-e,this.ye=ie.fromNumber(this.pe)}we(t,e,n){let r=t.add(e.multiply(ie.fromNumber(n)));return 1===r.compare(us)&&(r=new ie([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}Se(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.pe)return!1;const e=ls(t),[n,r]=hs(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);if(!this.Se(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new ds(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.pe)return;const e=ls(t),[n,r]=hs(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);this.be(e)}}be(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class fs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ps{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ms.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ps(tn.min(),r,new Dn(Ke),pi(),Ii())}}class ms{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ms(n,e,Ii(),Ii(),Ii())}}class gs{constructor(t,e,n,r){this.De=t,this.removedTargetIds=e,this.key=n,this.ve=r}}class ys{constructor(t,e){this.targetId=t,this.Ce=e}}class vs{constructor(t,e,n=Hn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ws{constructor(){this.Fe=0,this.Me=Es(),this.xe=Hn.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(t){t.approximateByteSize()>0&&(this.Ne=!0,this.xe=t)}qe(){let t=Ii(),e=Ii(),n=Ii();return this.Me.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ae(38017,{changeType:i})}})),new ms(this.xe,this.Oe,t,e,n)}Qe(){this.Ne=!1,this.Me=Es()}$e(t,e){this.Ne=!0,this.Me=this.Me.insert(t,e)}Ue(t){this.Ne=!0,this.Me=this.Me.remove(t)}Ke(){this.Fe+=1}We(){this.Fe-=1,Oe(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class _s{constructor(t){this.ze=t,this.je=new Map,this.He=pi(),this.Je=bs(),this.Ye=bs(),this.Ze=new Dn(Ke)}Xe(t){for(const e of t.De)t.ve&&t.ve.isFoundDocument()?this.et(e,t.ve):this.tt(e,t.key,t.ve);for(const e of t.removedTargetIds)this.tt(e,t.key,t.ve)}nt(t){this.forEachTarget(t,(e=>{const n=this.rt(e);switch(t.state){case 0:this.it(e)&&n.ke(t.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(t.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(e);break;case 3:this.it(e)&&(n.Ge(),n.ke(t.resumeToken));break;case 4:this.it(e)&&(this.st(e),n.ke(t.resumeToken));break;default:Ae(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.je.forEach(((t,n)=>{this.it(n)&&e(n)}))}ot(t){const e=t.targetId,n=t.Ce.count,r=this._t(e);if(r){const i=r.target;if(Zr(i))if(0===n){const t=new an(i.path);this.tt(e,t,kr.newNoDocument(t,tn.min()))}else Oe(1===n,20013,{expectedCount:n});else{const r=this.ut(e);if(r!==n){const n=this.ct(t),i=n?this.lt(n,t,r):1;if(0!==i){this.st(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,t)}}}}}ct(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Kn(n).toUint8Array()}catch(t){if(t instanceof Bn)return Ce("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ds(s,r,i)}catch(t){return Ce(t instanceof fs?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.pe?null:o}lt(t,e,n){return e.Ce.count===n-this.Tt(t,e.targetId)?0:2}Tt(t,e){const n=this.ze.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.tt(e,n,null),r++)})),r}It(t){const e=new Map;this.je.forEach(((n,r)=>{const i=this._t(r);if(i){if(n.current&&Zr(i.target)){const e=new an(i.target.path);this.Et(e).has(r)||this.dt(r,e)||this.tt(r,e,kr.newNoDocument(e,t))}n.Le&&(e.set(r,n.qe()),n.Qe())}}));let n=Ii();this.Ye.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this._t(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.He.forEach(((e,n)=>n.setReadTime(t)));const r=new ps(t,e,this.Ze,this.He,n);return this.He=pi(),this.Je=bs(),this.Ye=bs(),this.Ze=new Dn(Ke),r}et(t,e){if(!this.it(t))return;const n=this.dt(t,e.key)?2:0;this.rt(t).$e(e.key,n),this.He=this.He.insert(e.key,e),this.Je=this.Je.insert(e.key,this.Et(e.key).add(t)),this.Ye=this.Ye.insert(e.key,this.At(e.key).add(t))}tt(t,e,n){if(!this.it(t))return;const r=this.rt(t);this.dt(t,e)?r.$e(e,1):r.Ue(e),this.Ye=this.Ye.insert(e,this.At(e).delete(t)),this.Ye=this.Ye.insert(e,this.At(e).add(t)),n&&(this.He=this.He.insert(e,n))}removeTarget(t){this.je.delete(t)}ut(t){const e=this.rt(t).qe();return this.ze.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ke(t){this.rt(t).Ke()}rt(t){let e=this.je.get(t);return e||(e=new ws,this.je.set(t,e)),e}At(t){let e=this.Ye.get(t);return e||(e=new Un(Ke),this.Ye=this.Ye.insert(t,e)),e}Et(t){let e=this.Je.get(t);return e||(e=new Un(Ke),this.Je=this.Je.insert(t,e)),e}it(t){const e=null!==this._t(t);return e||Te("WatchChangeAggregator","Detected inactive target",t),e}_t(t){const e=this.je.get(t);return e&&e.Be?null:this.ze.Rt(t)}st(t){this.je.set(t,new ws),this.ze.getRemoteKeysForTarget(t).forEach((e=>{this.tt(t,e,null)}))}dt(t,e){return this.ze.getRemoteKeysForTarget(t).has(e)}}function bs(){return new Dn(an.comparator)}function Es(){return new Dn(an.comparator)}const Is={asc:"ASCENDING",desc:"DESCENDING"},Ts={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ss={and:"AND",or:"OR"};class Cs{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ks(t,e){return t.useProto3Json||gn(e)?e:{value:e}}function As(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xs(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Os(t,e){return As(t,e.toTimestamp())}function Ns(t){return Oe(!!t,49232),tn.fromTimestamp(function(t){const e=zn(t);return new Ze(e.seconds,e.nanos)}(t))}function Rs(t,e){return Ps(t,e).canonicalString()}function Ps(t,e){const n=function(t){return new rn(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ls(t){const e=rn.fromString(t);return Oe(Xs(e),10190,{key:e.toString()}),e}function Ds(t,e){return Rs(t.databaseId,e.path)}function Ms(t,e){const n=Ls(e);if(n.get(1)!==t.databaseId.projectId)throw new Pe(Re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Pe(Re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new an(Vs(n))}function Fs(t,e){return Rs(t.databaseId,e)}function Us(t){return new rn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Vs(t){return Oe(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function js(t,e,n){return{name:Ds(t,e),fields:n.value.mapValue.fields}}function Bs(t,e){return{documents:[Fs(t,e.path)]}}function Hs(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Fs(t,i);const s=function(t){if(0!==t.length)return Qs(Dr.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ws(t.field),direction:$s(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ks(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{gt:n,parent:i}}function qs(t){let e=function(t){const e=Ls(t);return 4===e.length?rn.emptyPath():Vs(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Oe(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=zs(t);return e instanceof Dr&&Fr(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Nr(Js(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,gn(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Ar(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Ar(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new ti(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function zs(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Js(t.unaryFilter.field);return Lr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Js(t.unaryFilter.field);return Lr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Js(t.unaryFilter.field);return Lr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Js(t.unaryFilter.field);return Lr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ae(61313);default:return Ae(60726)}}(t):void 0!==t.fieldFilter?function(t){return Lr.create(Js(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ae(58110);default:return Ae(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Dr.create(t.compositeFilter.filters.map((t=>zs(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ae(1026)}}(t.compositeFilter.op))}(t):Ae(30097,{filter:t})}function $s(t){return Is[t]}function Ks(t){return Ts[t]}function Gs(t){return Ss[t]}function Ws(t){return{fieldPath:t.canonicalString()}}function Js(t){return on.fromServerFormat(t.fieldPath)}function Qs(t){return t instanceof Lr?function(t){if("=="===t.op){if(_r(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NAN"}};if(wr(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(_r(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NAN"}};if(wr(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ws(t.field),op:Ks(t.op),value:t.value}}}(t):t instanceof Dr?function(t){const e=t.getFilters().map((t=>Qs(t)));return 1===e.length?e[0]:{compositeFilter:{op:Gs(t.op),filters:e}}}(t):Ae(54877,{filter:t})}function Ys(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Xs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Zs{constructor(t,e,n,r,i=tn.min(),s=tn.min(),o=Hn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Zs(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class to{constructor(t){this.wt=t}}function eo(t){const e=qs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?si(e,e.limit,"L"):e}class no{constructor(){}vt(t,e){this.Ct(t,e),e.Ft()}Ct(t,e){if("nullValue"in t)this.Mt(e,5);else if("booleanValue"in t)this.Mt(e,10),e.xt(t.booleanValue?1:0);else if("integerValue"in t)this.Mt(e,15),e.xt($n(t.integerValue));else if("doubleValue"in t){const n=$n(t.doubleValue);isNaN(n)?this.Mt(e,13):(this.Mt(e,15),yn(n)?e.xt(0):e.xt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Mt(e,20),"string"==typeof n&&(n=zn(n)),e.Ot(`${n.seconds||""}`),e.xt(n.nanos||0)}else if("stringValue"in t)this.Nt(t.stringValue,e),this.Bt(e);else if("bytesValue"in t)this.Mt(e,30),e.Lt(Kn(t.bytesValue)),this.Bt(e);else if("referenceValue"in t)this.kt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Mt(e,45),e.xt(n.latitude||0),e.xt(n.longitude||0)}else"mapValue"in t?Tr(t)?this.Mt(e,Number.MAX_SAFE_INTEGER):Er(t)?this.qt(t.mapValue,e):(this.Qt(t.mapValue,e),this.Bt(e)):"arrayValue"in t?(this.$t(t.arrayValue,e),this.Bt(e)):Ae(19022,{Ut:t})}Nt(t,e){this.Mt(e,25),this.Kt(t,e)}Kt(t,e){e.Ot(t)}Qt(t,e){const n=t.fields||{};this.Mt(e,55);for(const t of Object.keys(n))this.Nt(t,e),this.Ct(n[t],e)}qt(t,e){var n,r;const i=t.fields||{};this.Mt(e,53);const s=ar,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(e,15),e.xt($n(o)),this.Nt(s,e),this.Ct(i[s],e)}$t(t,e){const n=t.values||[];this.Mt(e,50);for(const t of n)this.Ct(t,e)}kt(t,e){this.Mt(e,37),an.fromName(t).path.forEach((t=>{this.Mt(e,60),this.Kt(t,e)}))}Mt(t,e){t.xt(e)}Bt(t){t.xt(2)}}no.Wt=new no;class ro{constructor(){this.Cn=new io}addToCollectionParentIndex(t,e){return this.Cn.add(e),fn.resolve()}getCollectionParents(t,e){return fn.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return fn.resolve()}deleteFieldIndex(t,e){return fn.resolve()}deleteAllFieldIndexes(t){return fn.resolve()}createTargetIndexes(t,e){return fn.resolve()}getDocumentsMatchingTarget(t,e){return fn.resolve(null)}getIndexType(t,e){return fn.resolve(0)}getFieldIndexes(t,e){return fn.resolve([])}getNextCollectionGroupToUpdate(t){return fn.resolve(null)}getMinOffset(t,e){return fn.resolve(un.min())}getMinOffsetFromCollectionGroup(t,e){return fn.resolve(un.min())}updateCollectionGroup(t,e,n){return fn.resolve()}updateIndexEntries(t,e){return fn.resolve()}}class io{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Un(rn.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Un(rn.comparator)).toArray()}}new Uint8Array(0);const so={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oo=41943040;class ao{static withCacheSize(t){return new ao(t,ao.DEFAULT_COLLECTION_PERCENTILE,ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}ao.DEFAULT_COLLECTION_PERCENTILE=10,ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ao.DEFAULT=new ao(oo,ao.DEFAULT_COLLECTION_PERCENTILE,ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ao.DISABLED=new ao(-1,0,0);class co{constructor(t){this.ur=t}next(){return this.ur+=2,this.ur}static cr(){return new co(0)}static lr(){return new co(-1)}}const uo="LruGarbageCollector";function lo([t,e],[n,r]){const i=Ke(t,n);return 0===i?Ke(e,r):i}class ho{constructor(t){this.Er=t,this.buffer=new Un(lo),this.dr=0}Ar(){return++this.dr}Rr(t){const e=[t,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();lo(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class fo{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(t){Te(uo,`Garbage collection scheduled in ${t}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){pn(t)?Te(uo,"Ignoring IndexedDB error during garbage collection: ",t):await dn(t)}await this.mr(3e5)}))}}class po{constructor(t,e){this.gr=t,this.params=e}calculateTargetCount(t,e){return this.gr.pr(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return fn.resolve(mn.le);const n=new ho(e);return this.gr.forEachTarget(t,(t=>n.Rr(t.sequenceNumber))).next((()=>this.gr.yr(t,(t=>n.Rr(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.gr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.gr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Te("LruGarbageCollector","Garbage collection skipped; disabled"),fn.resolve(so)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Te("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),so):this.wr(t,e)))}getCacheSize(t){return this.gr.getCacheSize(t)}wr(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Te("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),Ie()<=M.DEBUG&&Te("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),fn.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}class mo{constructor(){this.changes=new di((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,kr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?fn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class go{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class yo{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ki(n.mutation,t,jn.empty(),Ze.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Ii()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Ii()){const r=vi();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=gi();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=vi();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Ii())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=pi();const s=_i(),o=_i();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Qi)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Ki(o.mutation,e,o.mutation.getFieldMask(),Ze.now())):s.set(e.key,jn.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new go(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=_i();let r=new Dn(((t,e)=>t-e)),i=Ii();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||jn.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||Ii()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=wi();c.forEach((t=>{if(!i.has(t)){const r=zi(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return fn.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return an.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):fn.resolve(vi());let o=-1,a=i;return s.next((e=>fn.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?fn.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,Ii()))).next((t=>({batchId:o,changes:yi(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new an(e)).next((t=>{let e=gi();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=gi();return this.indexManager.getCollectionParents(t,i).next((o=>fn.forEach(o,(o=>{const a=function(t,e){return new ti(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,kr.newInvalidDocument(r)))}));let n=gi();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Ki(s.mutation,r,jn.empty(),Ze.now()),ui(e,r)&&(n=n.insert(t,r))})),n}))}}class vo{constructor(t){this.serializer=t,this.kr=new Map,this.qr=new Map}getBundleMetadata(t,e){return fn.resolve(this.kr.get(e))}saveBundleMetadata(t,e){return this.kr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Ns(t.createTime)}}(e)),fn.resolve()}getNamedQuery(t,e){return fn.resolve(this.qr.get(e))}saveNamedQuery(t,e){return this.qr.set(e.name,function(t){return{name:t.name,query:eo(t.bundledQuery),readTime:Ns(t.readTime)}}(e)),fn.resolve()}}class wo{constructor(){this.overlays=new Dn(an.comparator),this.Qr=new Map}getOverlay(t,e){return fn.resolve(this.overlays.get(e))}getOverlays(t,e){const n=vi();return fn.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.bt(t,e,r)})),fn.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Qr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Qr.delete(n)),fn.resolve()}getOverlaysForCollection(t,e,n){const r=vi(),i=e.length+1,s=new an(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return fn.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Dn(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=vi(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=vi(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return fn.resolve(o)}bt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new is(e,n));let i=this.Qr.get(e);void 0===i&&(i=Ii(),this.Qr.set(e,i)),this.Qr.set(e,i.add(n.key))}}class _o{constructor(){this.sessionToken=Hn.EMPTY_BYTE_STRING}getSessionToken(t){return fn.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,fn.resolve()}}class bo{constructor(){this.$r=new Un(Eo.Ur),this.Kr=new Un(Eo.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(t,e){const n=new Eo(t,e);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.zr(new Eo(t,e))}jr(t,e){t.forEach((t=>this.removeReference(t,e)))}Hr(t){const e=new an(new rn([])),n=new Eo(e,t),r=new Eo(e,t+1),i=[];return this.Kr.forEachInRange([n,r],(t=>{this.zr(t),i.push(t.key)})),i}Jr(){this.$r.forEach((t=>this.zr(t)))}zr(t){this.$r=this.$r.delete(t),this.Kr=this.Kr.delete(t)}Yr(t){const e=new an(new rn([])),n=new Eo(e,t),r=new Eo(e,t+1);let i=Ii();return this.Kr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Eo(t,0),n=this.$r.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Eo{constructor(t,e){this.key=t,this.Zr=e}static Ur(t,e){return an.comparator(t.key,e.key)||Ke(t.Zr,e.Zr)}static Wr(t,e){return Ke(t.Zr,e.Zr)||an.comparator(t.key,e.key)}}class Io{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nr=1,this.Xr=new Un(Eo.Ur)}checkEmpty(t){return fn.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new ns(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.Xr=this.Xr.add(new Eo(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return fn.resolve(s)}lookupMutationBatch(t,e){return fn.resolve(this.ei(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ti(n),i=r<0?0:r;return fn.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return fn.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(t){return fn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Eo(e,0),r=new Eo(e,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],(t=>{const e=this.ei(t.Zr);i.push(e)})),fn.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Un(Ke);return e.forEach((t=>{const e=new Eo(t,0),r=new Eo(t,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([e,r],(t=>{n=n.add(t.Zr)}))})),fn.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;an.isDocumentKey(i)||(i=i.child(""));const s=new Eo(new an(i),0);let o=new Un(Ke);return this.Xr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Zr)),!0)}),s),fn.resolve(this.ni(o))}ni(t){const e=[];return t.forEach((t=>{const n=this.ei(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Oe(0===this.ri(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return fn.forEach(e.mutations,(r=>{const i=new Eo(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Xr=n}))}sr(t){}containsKey(t,e){const n=new Eo(e,0),r=this.Xr.firstAfterOrEqual(n);return fn.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,fn.resolve()}ri(t,e){return this.ti(t)}ti(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ei(t){const e=this.ti(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class To{constructor(t){this.ii=t,this.docs=new Dn(an.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return fn.resolve(n?n.document.mutableCopy():kr.newInvalidDocument(e))}getEntries(t,e){let n=pi();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():kr.newInvalidDocument(t))})),fn.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=pi();const s=e.path,o=new an(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||ln(cn(o),n)<=0||(r.has(o.key)||ui(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return fn.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Ae(9500)}si(t,e){return fn.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new So(this)}getSize(t){return fn.resolve(this.size)}}class So extends mo{constructor(t){super(),this.Br=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Br.addEntry(t,r)):this.Br.removeEntry(n)})),fn.waitFor(e)}getFromCache(t,e){return this.Br.getEntry(t,e)}getAllFromCache(t,e){return this.Br.getEntries(t,e)}}class Co{constructor(t){this.persistence=t,this.oi=new di((t=>Yr(t)),Xr),this.lastRemoteSnapshotVersion=tn.min(),this.highestTargetId=0,this._i=0,this.ai=new bo,this.targetCount=0,this.ui=co.cr()}forEachTarget(t,e){return this.oi.forEach(((t,n)=>e(n))),fn.resolve()}getLastRemoteSnapshotVersion(t){return fn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return fn.resolve(this._i)}allocateTargetId(t){return this.highestTargetId=this.ui.next(),fn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this._i&&(this._i=e),fn.resolve()}Tr(t){this.oi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ui=new co(e),this.highestTargetId=e),t.sequenceNumber>this._i&&(this._i=t.sequenceNumber)}addTargetData(t,e){return this.Tr(e),this.targetCount+=1,fn.resolve()}updateTargetData(t,e){return this.Tr(e),fn.resolve()}removeTargetData(t,e){return this.oi.delete(e.target),this.ai.Hr(e.targetId),this.targetCount-=1,fn.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.oi.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),fn.waitFor(i).next((()=>r))}getTargetCount(t){return fn.resolve(this.targetCount)}getTargetData(t,e){const n=this.oi.get(e)||null;return fn.resolve(n)}addMatchingKeys(t,e,n){return this.ai.Gr(e,n),fn.resolve()}removeMatchingKeys(t,e,n){this.ai.jr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),fn.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ai.Hr(e),fn.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ai.Yr(e);return fn.resolve(n)}containsKey(t,e){return fn.resolve(this.ai.containsKey(e))}}class ko{constructor(t,e){this.ci={},this.overlays={},this.li=new mn(0),this.hi=!1,this.hi=!0,this.Pi=new _o,this.referenceDelegate=t(this),this.Ti=new Co(this),this.indexManager=new ro,this.remoteDocumentCache=function(t){return new To(t)}((t=>this.referenceDelegate.Ii(t))),this.serializer=new to(e),this.Ei=new vo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new wo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ci[t.toKey()];return n||(n=new Io(e,this.referenceDelegate),this.ci[t.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(t,e,n){Te("MemoryPersistence","Starting transaction:",t);const r=new Ao(this.li.next());return this.referenceDelegate.di(),n(r).next((t=>this.referenceDelegate.Ai(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ri(t,e){return fn.or(Object.values(this.ci).map((n=>()=>n.containsKey(t,e))))}}class Ao extends hn{constructor(t){super(),this.currentSequenceNumber=t}}class xo{constructor(t){this.persistence=t,this.Vi=new bo,this.mi=null}static fi(t){return new xo(t)}get gi(){if(this.mi)return this.mi;throw Ae(60996)}addReference(t,e,n){return this.Vi.addReference(n,e),this.gi.delete(n.toString()),fn.resolve()}removeReference(t,e,n){return this.Vi.removeReference(n,e),this.gi.add(n.toString()),fn.resolve()}markPotentiallyOrphaned(t,e){return this.gi.add(e.toString()),fn.resolve()}removeTarget(t,e){this.Vi.Hr(e.targetId).forEach((t=>this.gi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.gi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}di(){this.mi=new Set}Ai(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return fn.forEach(this.gi,(n=>{const r=an.fromPath(n);return this.pi(t,r).next((t=>{t||e.removeEntry(r,tn.min())}))})).next((()=>(this.mi=null,e.apply(t))))}updateLimboDocument(t,e){return this.pi(t,e).next((t=>{t?this.gi.delete(e.toString()):this.gi.add(e.toString())}))}Ii(t){return 0}pi(t,e){return fn.or([()=>fn.resolve(this.Vi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ri(t,e)])}}class Oo{constructor(t,e){this.persistence=t,this.yi=new di((t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=wn(e)),e=vn(t.get(n),e);return wn(e)}(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=function(t,e){return new po(t,e)}(this,e)}static fi(t,e){return new Oo(t,e)}di(){}Ai(t){return fn.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}pr(t){const e=this.Sr(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Sr(t){let e=0;return this.yr(t,(t=>{e++})).next((()=>e))}yr(t,e){return fn.forEach(this.yi,((n,r)=>this.Dr(t,n,r).next((t=>t?fn.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(t,(r=>this.Dr(t,r,e).next((t=>{t||(n++,i.removeEntry(r,tn.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.yi.set(e,t.currentSequenceNumber),fn.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),fn.resolve()}removeReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),fn.resolve()}updateLimboDocument(t,e){return this.yi.set(e,t.currentSequenceNumber),fn.resolve()}Ii(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=gr(t.data.value)),e}Dr(t,e,n){return fn.or([()=>this.persistence.Ri(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.yi.get(e);return fn.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class No{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ds=n,this.As=r}static Rs(t,e){let n=Ii(),r=Ii();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new No(t,e.fromCache,n,r)}}class Ro{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Po{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=w()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(v())>0?6:4}initialize(t,e){this.ys=t,this.indexManager=e,this.Vs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ws(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Ss(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Ro;return this.bs(t,e,n).next((r=>{if(i.result=r,this.fs)return this.Ds(t,e,n,r.size)}))})).next((()=>i.result))}Ds(t,e,n,r){return n.documentReadCount<this.gs?(Ie()<=M.DEBUG&&Te("QueryEngine","SDK will not create cache indexes for query:",ci(e),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),fn.resolve()):(Ie()<=M.DEBUG&&Te("QueryEngine","Query:",ci(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(Ie()<=M.DEBUG&&Te("QueryEngine","The SDK decides to create cache indexes for query:",ci(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ii(e))):fn.resolve())}ws(t,e){if(ni(e))return fn.resolve(null);let n=ii(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=si(e,null,"F"),n=ii(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=Ii(...r);return this.ys.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.vs(e,r);return this.Cs(e,s,i,n.readTime)?this.ws(t,si(e,null,"F")):this.Fs(t,s,e,n)}))))})))))}Ss(t,e,n,r){return ni(e)||r.isEqual(tn.min())?fn.resolve(null):this.ys.getDocuments(t,n).next((i=>{const s=this.vs(e,i);return this.Cs(e,s,n,r)?fn.resolve(null):(Ie()<=M.DEBUG&&Te("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ci(e)),this.Fs(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=tn.fromTimestamp(1e9===r?new Ze(n+1,0):new Ze(n,r));return new un(i,an.empty(),e)}(r,-1)).next((t=>t)))}))}vs(t,e){let n=new Un(li(t));return e.forEach(((e,r)=>{ui(t,r)&&(n=n.add(r))})),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}bs(t,e,n){return Ie()<=M.DEBUG&&Te("QueryEngine","Using full collection scan to execute query:",ci(e)),this.ys.getDocumentsMatchingQuery(t,e,un.min(),n)}Fs(t,e,n,r){return this.ys.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}const Lo="LocalStore";class Do{constructor(t,e,n,r){this.persistence=t,this.Ms=e,this.serializer=r,this.xs=new Dn(Ke),this.Os=new di((t=>Yr(t)),Xr),this.Ns=new Map,this.Bs=t.getRemoteDocumentCache(),this.Ti=t.getTargetCache(),this.Ei=t.getBundleCache(),this.Ls(n)}Ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yo(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.xs)))}}async function Mo(t,e){const n=Ne(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.Ls(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=Ii();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ks:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Fo(t){const e=Ne(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ti.getLastRemoteSnapshotVersion(t)))}function Uo(t,e){const n=Ne(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Vo(t,e,n){const r=Ne(t),i=r.xs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!pn(t))throw t;Te(Lo,`Failed to update sequence numbers for target ${e}: ${t}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)}function jo(t,e,n){const r=Ne(t);let i=tn.min(),s=Ii();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Ne(t),i=r.Os.get(n);return void 0!==i?fn.resolve(r.xs.get(i)):r.Ti.getTargetData(e,n)}(r,t,ii(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Ms.getDocumentsMatchingQuery(t,e,n?i:tn.min(),n?s:Ii()))).next((t=>(function(t,e,n){let r=t.Ns.get(e)||tn.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Ns.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,$s:s})))))}class Bo{constructor(){this.activeTargetIds=Ti}js(t){this.activeTargetIds=this.activeTargetIds.add(t)}Hs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}zs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ho{constructor(){this.xo=new Bo,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.xo.js(t),this.Oo[t]||"not-current"}updateQueryState(t,e,n){this.Oo[t]=e}removeLocalQueryTarget(t){this.xo.Hs(t)}isLocalQueryTarget(t){return this.xo.activeTargetIds.has(t)}clearQueryState(t){delete this.Oo[t]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(t){return this.xo.activeTargetIds.has(t)}start(){return this.xo=new Bo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class qo{No(t){}shutdown(){}}const zo="ConnectivityMonitor";class $o{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(t){this.Qo.push(t)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){Te(zo,"Network connectivity changed: AVAILABLE");for(const t of this.Qo)t(0)}qo(){Te(zo,"Network connectivity changed: UNAVAILABLE");for(const t of this.Qo)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ko=null;function Go(){return null===Ko?Ko=268435456+Math.round(2147483648*Math.random()):Ko++,"0x"+Ko.toString(16)}const Wo="RestConnection",Jo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Qo{get Uo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=e+"://"+t.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===er?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(t,e,n,r,i){const s=Go(),o=this.jo(t,e.toUriEncodedString());Te(Wo,`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,i);const{host:c}=new URL(o),u=f(c);return this.Jo(t,o,a,n,u).then((e=>(Te(Wo,`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Ce(Wo,`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Yo(t,e,n,r,i,s){return this.zo(t,e,n,r,i)}Ho(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+be,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}jo(t,e){const n=Jo[t];return`${this.Ko}/v1/${e}:${n}`}terminate(){}}class Yo{constructor(t){this.Zo=t.Zo,this.Xo=t.Xo}e_(t){this.t_=t}n_(t){this.r_=t}i_(t){this.s_=t}onMessage(t){this.o_=t}close(){this.Xo()}send(t){this.Zo(t)}__(){this.t_()}a_(){this.r_()}u_(t){this.s_(t)}c_(t){this.o_(t)}}const Xo="WebChannelConnection";class Zo extends Qo{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=Go();return new Promise(((i,o)=>{const a=new ce;a.setWithCredentials(!0),a.listenOnce(le.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case he.NO_ERROR:const e=a.getResponseJson();Te(Xo,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case he.TIMEOUT:Te(Xo,`RPC '${t}' ${s} timed out`),o(new Pe(Re.DEADLINE_EXCEEDED,"Request time out"));break;case he.HTTP_ERROR:const n=a.getStatus();if(Te(Xo,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Re).indexOf(e)>=0?e:Re.UNKNOWN}(e.status);o(new Pe(t,e.message))}else o(new Pe(Re.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Pe(Re.UNAVAILABLE,"Connection failed."));break;default:Ae(9055,{l_:t,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{Te(Xo,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);Te(Xo,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}T_(t,e,n){const r=Go(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=me(),o=pe(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Te(Xo,`Creating RPC '${t}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new Yo({Zo:e=>{d?Te(Xo,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(Te(Xo,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),Te(Xo,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},Xo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,ue.EventType.OPEN,(()=>{d||(Te(Xo,`RPC '${t}' stream ${r} transport opened.`),f.__())})),p(l,ue.EventType.CLOSE,(()=>{d||(d=!0,Te(Xo,`RPC '${t}' stream ${r} transport closed`),f.u_())})),p(l,ue.EventType.ERROR,(e=>{d||(d=!0,Ce(Xo,`RPC '${t}' stream ${r} transport errored. Name:`,e.name,"Message:",e.message),f.u_(new Pe(Re.UNAVAILABLE,"The operation could not be completed")))})),p(l,ue.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Oe(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Te(Xo,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=os[t];if(void 0!==e)return cs(e)}(e),i=o.message;void 0===n&&(n=Re.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.u_(new Pe(n,i)),l.close()}else Te(Xo,`RPC '${t}' stream ${r} received:`,i),f.c_(i)}})),p(o,fe.STAT_EVENT,(e=>{e.stat===de.PROXY?Te(Xo,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===de.NOPROXY&&Te(Xo,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.a_()}),0),f}}function ta(){return"undefined"!=typeof document?document:null}function ea(t){return new Cs(t,!0)}class na{constructor(t,e,n=1e3,r=1.5,i=6e4){this.xi=t,this.timerId=e,this.I_=n,this.E_=r,this.d_=i,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(t){this.cancel();const e=Math.floor(this.A_+this.g_()),n=Math.max(0,Date.now()-this.V_),r=Math.max(0,e-n);r>0&&Te("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.A_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,r,(()=>(this.V_=Date.now(),t()))),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){null!==this.R_&&(this.R_.skipDelay(),this.R_=null)}cancel(){null!==this.R_&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}const ra="PersistentStream";class ia{constructor(t,e,n,r,i,s,o,a){this.xi=t,this.y_=n,this.w_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new na(t,e)}F_(){return 1===this.state||5===this.state||this.M_()}M_(){return 2===this.state||3===this.state}start(){this.v_=0,4!==this.state?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&null===this.b_&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,(()=>this.B_())))}L_(t){this.k_(),this.stream.send(t)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(t,e){this.k_(),this.q_(),this.C_.cancel(),this.S_++,4!==t?this.C_.reset():e&&e.code===Re.RESOURCE_EXHAUSTED?(Se(e.toString()),Se("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):e&&e.code===Re.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Q_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.i_(e)}Q_(){}auth(){this.state=1;const t=this.U_(this.S_),e=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.S_===e&&this.K_(t,n)}),(e=>{t((()=>{const t=new Pe(Re.UNKNOWN,"Fetching auth token failed: "+e.message);return this.W_(t)}))}))}K_(t,e){const n=this.U_(this.S_);this.stream=this.G_(t,e),this.stream.e_((()=>{n((()=>this.listener.e_()))})),this.stream.n_((()=>{n((()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,(()=>(this.M_()&&(this.state=3),Promise.resolve()))),this.listener.n_())))})),this.stream.i_((t=>{n((()=>this.W_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.v_?this.z_(t):this.onNext(t)))}))}x_(){this.state=5,this.C_.f_((async()=>{this.state=0,this.start()}))}W_(t){return Te(ra,`close with error: ${t}`),this.stream=null,this.close(4,t)}U_(t){return e=>{this.xi.enqueueAndForget((()=>this.S_===t?e():(Te(ra,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class sa extends ia{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}G_(t,e){return this.connection.T_("Listen",t,e)}z_(t){return this.onNext(t)}onNext(t){this.C_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ae(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Oe(void 0===e||"string"==typeof e,58123),Hn.fromBase64String(e||"")):(Oe(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),Hn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Re.UNKNOWN:cs(t.code);return new Pe(e,t.message||"")}(o);n=new vs(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ms(t,r.document.name),s=Ns(r.document.updateTime),o=r.document.createTime?Ns(r.document.createTime):tn.min(),a=new Sr({mapValue:{fields:r.document.fields}}),c=kr.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new gs(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Ms(t,r.document),s=r.readTime?Ns(r.readTime):tn.min(),o=kr.newNoDocument(i,s),a=r.removedTargetIds||[];n=new gs([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Ms(t,r.document),s=r.removedTargetIds||[];n=new gs([],s,i,null)}else{if(!("filter"in e))return Ae(11601,{Vt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new ss(r,i),o=t.targetId;n=new ys(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return tn.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?tn.min():e.readTime?Ns(e.readTime):tn.min()}(t);return this.listener.j_(e,n)}H_(t){const e={};e.database=Us(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Zr(r)?{documents:Bs(t,r)}:{query:Hs(t,r).gt},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=xs(t,e.resumeToken);const r=ks(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(tn.min())>0){n.readTime=As(t,e.snapshotVersion.toTimestamp());const r=ks(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ae(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.L_(e)}J_(t){const e={};e.database=Us(this.serializer),e.removeTarget=t,this.L_(e)}}class oa extends ia{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(t,e){return this.connection.T_("Write",t,e)}z_(t){return Oe(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Oe(!t.writeResults||0===t.writeResults.length,55816),this.listener.X_()}onNext(t){Oe(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.C_.reset();const e=function(t,e){return t&&t.length>0?(Oe(void 0!==e,14353),t.map((t=>function(t,e){let n=t.updateTime?Ns(t.updateTime):Ns(e);return n.isEqual(tn.min())&&(n=Ns(e)),new ji(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ns(t.commitTime);return this.listener.ea(n,e)}ta(){const t={};t.database=Us(this.serializer),this.L_(t)}Z_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Ji)n={update:js(t,e.key,e.value)};else if(e instanceof ts)n={delete:Ds(t,e.key)};else if(e instanceof Qi)n={update:js(t,e.key,e.data),updateMask:Ys(e.fieldMask)};else{if(!(e instanceof es))return Ae(16599,{ft:e.type});n={verify:Ds(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ri)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Pi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Di)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Fi)return{fieldPath:e.field.canonicalString(),increment:n.Re};throw Ae(20930,{transform:e.transform})}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Os(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ae(27497)}(t,e.precondition)),n}(this.serializer,t)))};this.L_(e)}}class aa{}class ca extends aa{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.na=!1}ra(){if(this.na)throw new Pe(Re.FAILED_PRECONDITION,"The client has already been terminated.")}zo(t,e,n,r){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.zo(t,Ps(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Pe(Re.UNKNOWN,t.toString())}))}Yo(t,e,n,r,i){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Yo(t,Ps(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Pe(Re.UNKNOWN,t.toString())}))}terminate(){this.na=!0,this.connection.terminate()}}class ua{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){0===this.ia&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve()))))}ca(t){"Online"===this.state?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.aa("Offline")))}set(t){this.la(),this.ia=0,"Online"===t&&(this.oa=!1),this.aa(t)}aa(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ua(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(Se(e),this.oa=!1):Te("OnlineStateTracker",e)}la(){null!==this.sa&&(this.sa.cancel(),this.sa=null)}}const la="RemoteStore";class ha{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=i,this.Ea.No((t=>{n.enqueueAndForget((async()=>{_a(this)&&(Te(la,"Restarting streams for network reachability change."),await async function(t){const e=Ne(t);e.Ta.add(4),await fa(e),e.da.set("Unknown"),e.Ta.delete(4),await da(e)}(this))}))})),this.da=new ua(n,r)}}async function da(t){if(_a(t))for(const e of t.Ia)await e(!0)}async function fa(t){for(const e of t.Ia)await e(!1)}function pa(t,e){const n=Ne(t);n.Pa.has(e.targetId)||(n.Pa.set(e.targetId,e),wa(n)?va(n):Ua(n).M_()&&ga(n,e))}function ma(t,e){const n=Ne(t),r=Ua(n);n.Pa.delete(e),r.M_()&&ya(n,e),0===n.Pa.size&&(r.M_()?r.N_():_a(n)&&n.da.set("Unknown"))}function ga(t,e){if(t.Aa.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tn.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ua(t).H_(e)}function ya(t,e){t.Aa.Ke(e),Ua(t).J_(e)}function va(t){t.Aa=new _s({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t.Pa.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),Ua(t).start(),t.da._a()}function wa(t){return _a(t)&&!Ua(t).F_()&&t.Pa.size>0}function _a(t){return 0===Ne(t).Ta.size}function ba(t){t.Aa=void 0}async function Ea(t){t.da.set("Online")}async function Ia(t){t.Pa.forEach(((e,n)=>{ga(t,e)}))}async function Ta(t,e){ba(t),wa(t)?(t.da.ca(e),va(t)):t.da.set("Unknown")}async function Sa(t,e,n){if(t.da.set("Online"),e instanceof vs&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Pa.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Pa.delete(r),t.Aa.removeTarget(r))}(t,e)}catch(n){Te(la,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ca(t,n)}else if(e instanceof gs?t.Aa.Xe(e):e instanceof ys?t.Aa.ot(e):t.Aa.nt(e),!n.isEqual(tn.min()))try{const e=await Fo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Aa.It(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Pa.get(r);i&&t.Pa.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Pa.get(e);if(!r)return;t.Pa.set(e,r.withResumeToken(Hn.EMPTY_BYTE_STRING,r.snapshotVersion)),ya(t,e);const i=new Zs(r.target,e,n,r.sequenceNumber);ga(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Te(la,"Failed to raise snapshot:",e),await Ca(t,e)}}async function Ca(t,e,n){if(!pn(e))throw e;t.Ta.add(1),await fa(t),t.da.set("Offline"),n||(n=()=>Fo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Te(la,"Retrying IndexedDB access"),await n(),t.Ta.delete(1),await da(t)}))}function ka(t,e){return e().catch((n=>Ca(t,n,e)))}async function Aa(t){const e=Ne(t),n=Va(e);let r=e.ha.length>0?e.ha[e.ha.length-1].batchId:-1;for(;xa(e);)try{const t=await Uo(e.localStore,r);if(null===t){0===e.ha.length&&n.N_();break}r=t.batchId,Oa(e,t)}catch(t){await Ca(e,t)}Na(e)&&Ra(e)}function xa(t){return _a(t)&&t.ha.length<10}function Oa(t,e){t.ha.push(e);const n=Va(t);n.M_()&&n.Y_&&n.Z_(e.mutations)}function Na(t){return _a(t)&&!Va(t).F_()&&t.ha.length>0}function Ra(t){Va(t).start()}async function Pa(t){Va(t).ta()}async function La(t){const e=Va(t);for(const n of t.ha)e.Z_(n.mutations)}async function Da(t,e,n){const r=t.ha.shift(),i=rs.from(r,e,n);await ka(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Aa(t)}async function Ma(t,e){e&&Va(t).Y_&&await async function(t,e){if(function(t){return function(t){switch(t){case Re.OK:return Ae(64938);case Re.CANCELLED:case Re.UNKNOWN:case Re.DEADLINE_EXCEEDED:case Re.RESOURCE_EXHAUSTED:case Re.INTERNAL:case Re.UNAVAILABLE:case Re.UNAUTHENTICATED:return!1;case Re.INVALID_ARGUMENT:case Re.NOT_FOUND:case Re.ALREADY_EXISTS:case Re.PERMISSION_DENIED:case Re.FAILED_PRECONDITION:case Re.ABORTED:case Re.OUT_OF_RANGE:case Re.UNIMPLEMENTED:case Re.DATA_LOSS:return!0;default:return Ae(15467,{code:t})}}(t)&&t!==Re.ABORTED}(e.code)){const n=t.ha.shift();Va(t).O_(),await ka(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Aa(t)}}(t,e),Na(t)&&Ra(t)}async function Fa(t,e){const n=Ne(t);n.asyncQueue.verifyOperationInProgress(),Te(la,"RemoteStore received new credentials");const r=_a(n);n.Ta.add(3),await fa(n),r&&n.da.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ta.delete(3),await da(n)}function Ua(t){return t.Ra||(t.Ra=function(t,e,n){const r=Ne(t);return r.ra(),new sa(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:Ea.bind(null,t),n_:Ia.bind(null,t),i_:Ta.bind(null,t),j_:Sa.bind(null,t)}),t.Ia.push((async e=>{e?(t.Ra.O_(),wa(t)?va(t):t.da.set("Unknown")):(await t.Ra.stop(),ba(t))}))),t.Ra}function Va(t){return t.Va||(t.Va=function(t,e,n){const r=Ne(t);return r.ra(),new oa(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:()=>Promise.resolve(),n_:Pa.bind(null,t),i_:Ma.bind(null,t),X_:La.bind(null,t),ea:Da.bind(null,t)}),t.Ia.push((async e=>{e?(t.Va.O_(),await Aa(t)):(await t.Va.stop(),t.ha.length>0&&(Te(la,`Stopping write stream with ${t.ha.length} pending writes`),t.ha=[]))}))),t.Va}class ja{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Le,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new ja(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Pe(Re.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ba(t,e){if(Se("AsyncQueue",`${e}: ${t}`),pn(t))return new Pe(Re.UNAVAILABLE,`${e}: ${t}`);throw t}class Ha{static emptySet(t){return new Ha(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||an.comparator(e.key,n.key):(t,e)=>an.comparator(t.key,e.key),this.keyedMap=gi(),this.sortedSet=new Dn(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Ha))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Ha;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class qa{constructor(){this.ma=new Dn(an.comparator)}track(t){const e=t.doc.key,n=this.ma.get(e);n?0!==t.type&&3===n.type?this.ma=this.ma.insert(e,t):3===t.type&&1!==n.type?this.ma=this.ma.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ma=this.ma.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ma=this.ma.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ma=this.ma.remove(e):1===t.type&&2===n.type?this.ma=this.ma.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ma=this.ma.insert(e,{type:2,doc:t.doc}):Ae(63341,{Vt:t,fa:n}):this.ma=this.ma.insert(e,t)}ga(){const t=[];return this.ma.inorderTraversal(((e,n)=>{t.push(n)})),t}}class za{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new za(t,e,Ha.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&oi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class $a{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some((t=>t.Sa()))}}class Ka{constructor(){this.queries=Ga(),this.onlineState="Unknown",this.ba=new Set}terminate(){!function(t,e){const n=Ne(t),r=n.queries;n.queries=Ga(),r.forEach(((t,n)=>{for(const t of n.ya)t.onError(e)}))}(this,new Pe(Re.ABORTED,"Firestore shutting down"))}}function Ga(){return new di((t=>ai(t)),oi)}function Wa(t,e){const n=Ne(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.ya)e.va(t)&&(r=!0);i.pa=t}}r&&Qa(n)}function Ja(t,e,n){const r=Ne(t),i=r.queries.get(e);if(i)for(const t of i.ya)t.onError(n);r.queries.delete(e)}function Qa(t){t.ba.forEach((t=>{t.next()}))}var Ya,Xa;(Xa=Ya||(Ya={})).Ca="default",Xa.Cache="cache";class Za{constructor(t,e,n){this.query=t,this.Fa=e,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=n||{}}va(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new za(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Ma?this.Oa(t)&&(this.Fa.next(t),e=!0):this.Na(t,this.onlineState)&&(this.Ba(t),e=!0),this.xa=t,e}onError(t){this.Fa.error(t)}Da(t){this.onlineState=t;let e=!1;return this.xa&&!this.Ma&&this.Na(this.xa,t)&&(this.Ba(this.xa),e=!0),e}Na(t,e){if(!t.fromCache)return!0;if(!this.Sa())return!0;const n="Offline"!==e;return(!this.options.La||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Oa(t){if(t.docChanges.length>0)return!0;const e=this.xa&&this.xa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Ba(t){t=za.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Ma=!0,this.Fa.next(t)}Sa(){return this.options.source!==Ya.Cache}}class tc{constructor(t){this.key=t}}class ec{constructor(t){this.key=t}}class nc{constructor(t,e){this.query=t,this.Ga=e,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=Ii(),this.mutatedKeys=Ii(),this.Ha=li(t),this.Ja=new Ha(this.Ha)}get Ya(){return this.Ga}Za(t,e){const n=e?e.Xa:new qa,r=e?e.Ja:this.Ja;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),l=ui(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.eu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Ha(l,a)>0||c&&this.Ha(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ja:s,Xa:n,Cs:o,mutatedKeys:i}}eu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Ja;this.Ja=t.Ja,this.mutatedKeys=t.mutatedKeys;const s=t.Xa.ga();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ae(20277,{Vt:t})}};return n(t)-n(e)}(t.type,e.type)||this.Ha(t.doc,e.doc))),this.tu(n),r=null!=r&&r;const o=e&&!r?this.nu():[],a=0===this.ja.size&&this.current&&!r?1:0,c=a!==this.za;return this.za=a,0!==s.length||c?{snapshot:new za(this.query,t.Ja,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ru:o}:{ru:o}}Da(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new qa,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(t){return!this.Ga.has(t)&&!!this.Ja.has(t)&&!this.Ja.get(t).hasLocalMutations}tu(t){t&&(t.addedDocuments.forEach((t=>this.Ga=this.Ga.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ga=this.Ga.delete(t))),this.current=t.current)}nu(){if(!this.current)return[];const t=this.ja;this.ja=Ii(),this.Ja.forEach((t=>{this.iu(t.key)&&(this.ja=this.ja.add(t.key))}));const e=[];return t.forEach((t=>{this.ja.has(t)||e.push(new ec(t))})),this.ja.forEach((n=>{t.has(n)||e.push(new tc(n))})),e}su(t){this.Ga=t.$s,this.ja=Ii();const e=this.Za(t.documents);return this.applyChanges(e,!0)}ou(){return za.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,0===this.za,this.hasCachedResults)}}const rc="SyncEngine";class ic{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class sc{constructor(t){this.key=t,this._u=!1}}class oc{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.au={},this.uu=new di((t=>ai(t)),oi),this.cu=new Map,this.lu=new Set,this.hu=new Dn(an.comparator),this.Pu=new Map,this.Tu=new bo,this.Iu={},this.Eu=new Map,this.du=co.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return!0===this.Au}}async function ac(t,e,n=!0){const r=kc(t);let i;const s=r.uu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ou()):i=await uc(r,e,n,!0),i}async function cc(t,e){const n=kc(t);await uc(n,e,!0,!1)}async function uc(t,e,n,r){const i=await function(t,e){const n=Ne(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Ti.getTargetData(t,e).next((i=>i?(r=i,fn.resolve(r)):n.Ti.allocateTargetId(t).next((i=>(r=new Zs(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Ti.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.xs.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.xs=n.xs.insert(t.targetId,t),n.Os.set(e,t.targetId)),t}))}(t.localStore,ii(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(t,e,n,r,i){t.Ru=(e,n,r)=>async function(t,e,n,r){let i=e.view.Za(n);i.Cs&&(i=await jo(t.localStore,e.query,!1).then((({documents:t})=>e.view.Za(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return bc(t,e.targetId,a.ru),a.snapshot}(t,e,n,r);const s=await jo(t.localStore,e,!0),o=new nc(e,s.$s),a=o.Za(s.documents),c=ms.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);bc(t,n,u.ru);const l=new ic(e,n,o);return t.uu.set(e,l),t.cu.has(n)?t.cu.get(n).push(e):t.cu.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&pa(t.remoteStore,i),a}async function lc(t,e,n){const r=Ne(t),i=r.uu.get(e),s=r.cu.get(i.targetId);if(s.length>1)return r.cu.set(i.targetId,s.filter((t=>!oi(t,e)))),void r.uu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Vo(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ma(r.remoteStore,i.targetId),wc(r,i.targetId)})).catch(dn)):(wc(r,i.targetId),await Vo(r.localStore,i.targetId,!0))}async function hc(t,e){const n=Ne(t),r=n.uu.get(e),i=n.cu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ma(n.remoteStore,r.targetId))}async function dc(t,e){const n=Ne(t);try{const t=await function(t,e){const n=Ne(t),r=e.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Ti.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Hn.EMPTY_BYTE_STRING,tn.min()).withLastLimboFreeSnapshotVersion(tn.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ti.updateTargetData(t,u))}));let a=pi(),c=Ii();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=Ii(),i=Ii();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=pi();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(tn.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Te(Lo,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{qs:r,Qs:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.qs,c=t.Qs}))),!r.isEqual(tn.min())){const e=n.Ti.getLastRemoteSnapshotVersion(t).next((e=>n.Ti.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return fn.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.xs=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Pu.get(e);r&&(Oe(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r._u=!0:t.modifiedDocuments.size>0?Oe(r._u,14607):t.removedDocuments.size>0&&(Oe(r._u,42227),r._u=!1))})),await Tc(n,t,e)}catch(t){await dn(t)}}function fc(t,e,n){const r=Ne(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.uu.forEach(((n,r)=>{const i=r.view.Da(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Ne(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.ya)t.Da(e)&&(r=!0)})),r&&Qa(n)}(r.eventManager,e),t.length&&r.au.j_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function pc(t,e,n){const r=Ne(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Pu.get(e),s=i&&i.key;if(s){let t=new Dn(an.comparator);t=t.insert(s,kr.newNoDocument(s,tn.min()));const n=Ii().add(s),i=new ps(tn.min(),new Map,new Dn(Ke),t,n);await dc(r,i),r.hu=r.hu.remove(s),r.Pu.delete(e),Ic(r)}else await Vo(r.localStore,e,!1).then((()=>wc(r,e,n))).catch(dn)}async function mc(t,e){const n=Ne(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Ne(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=fn.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Oe(null!==s,48541),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Ii();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);vc(n,r,null),yc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Tc(n,t)}catch(t){await dn(t)}}async function gc(t,e,n){const r=Ne(t);try{const t=await function(t,e){const n=Ne(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Oe(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);vc(r,e,n),yc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Tc(r,t)}catch(n){await dn(n)}}function yc(t,e){(t.Eu.get(e)||[]).forEach((t=>{t.resolve()})),t.Eu.delete(e)}function vc(t,e,n){const r=Ne(t);let i=r.Iu[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Iu[r.currentUser.toKey()]=i}}function wc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.cu.get(e))t.uu.delete(r),n&&t.au.Vu(r,n);t.cu.delete(e),t.isPrimaryClient&&t.Tu.Hr(e).forEach((e=>{t.Tu.containsKey(e)||_c(t,e)}))}function _c(t,e){t.lu.delete(e.path.canonicalString());const n=t.hu.get(e);null!==n&&(ma(t.remoteStore,n),t.hu=t.hu.remove(e),t.Pu.delete(n),Ic(t))}function bc(t,e,n){for(const r of n)r instanceof tc?(t.Tu.addReference(r.key,e),Ec(t,r)):r instanceof ec?(Te(rc,"Document no longer in limbo: "+r.key),t.Tu.removeReference(r.key,e),t.Tu.containsKey(r.key)||_c(t,r.key)):Ae(19791,{mu:r})}function Ec(t,e){const n=e.key,r=n.path.canonicalString();t.hu.get(n)||t.lu.has(r)||(Te(rc,"New document in limbo: "+n),t.lu.add(r),Ic(t))}function Ic(t){for(;t.lu.size>0&&t.hu.size<t.maxConcurrentLimboResolutions;){const e=t.lu.values().next().value;t.lu.delete(e);const n=new an(rn.fromString(e)),r=t.du.next();t.Pu.set(r,new sc(n)),t.hu=t.hu.insert(n,r),pa(t.remoteStore,new Zs(ii(ei(n.path)),r,"TargetPurposeLimboResolution",mn.le))}}async function Tc(t,e,n){const r=Ne(t),i=[],s=[],o=[];r.uu.isEmpty()||(r.uu.forEach(((t,a)=>{o.push(r.Ru(a,e,n).then((t=>{var e;if((t||n)&&r.isPrimaryClient){const i=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=No.Rs(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.au.j_(i),await async function(t,e){const n=Ne(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>fn.forEach(e,(e=>fn.forEach(e.ds,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>fn.forEach(e.As,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!pn(t))throw t;Te(Lo,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.xs.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.xs=n.xs.insert(e,i)}}}(r.localStore,s))}async function Sc(t,e){const n=Ne(t);if(!n.currentUser.isEqual(e)){Te(rc,"User change. New user:",e.toKey());const t=await Mo(n.localStore,e);n.currentUser=e,function(t){t.Eu.forEach((t=>{t.forEach((t=>{t.reject(new Pe(Re.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Eu.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Tc(n,t.ks)}}function Cc(t,e){const n=Ne(t),r=n.Pu.get(e);if(r&&r._u)return Ii().add(r.key);{let t=Ii();const r=n.cu.get(e);if(!r)return t;for(const e of r){const r=n.uu.get(e);t=t.unionWith(r.view.Ya)}return t}}function kc(t){const e=Ne(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=dc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=pc.bind(null,e),e.au.j_=Wa.bind(null,e.eventManager),e.au.Vu=Ja.bind(null,e.eventManager),e}function Ac(t){const e=Ne(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gc.bind(null,e),e}class xc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ea(t.databaseInfo.databaseId),this.sharedClientState=this.pu(t),this.persistence=this.yu(t),await this.persistence.start(),this.localStore=this.wu(t),this.gcScheduler=this.Su(t,this.localStore),this.indexBackfillerScheduler=this.bu(t,this.localStore)}Su(t,e){return null}bu(t,e){return null}wu(t){return function(t,e,n,r){return new Do(t,e,n,r)}(this.persistence,new Po,t.initialUser,this.serializer)}yu(t){return new ko(xo.fi,this.serializer)}pu(t){return new Ho}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xc.provider={build:()=>new xc};class Oc extends xc{constructor(t){super(),this.cacheSizeBytes=t}Su(t,e){Oe(this.persistence.referenceDelegate instanceof Oo,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new fo(n,t.asyncQueue,e)}yu(t){const e=void 0!==this.cacheSizeBytes?ao.withCacheSize(this.cacheSizeBytes):ao.DEFAULT;return new ko((t=>Oo.fi(t,e)),this.serializer)}}class Nc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>fc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Sc.bind(null,this.syncEngine),await async function(t,e){const n=Ne(t);e?(n.Ta.delete(2),await da(n)):e||(n.Ta.add(2),await fa(n),n.da.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ka}createDatastore(t){const e=ea(t.databaseInfo.databaseId),n=function(t){return new Zo(t)}(t.databaseInfo);return function(t,e,n,r){return new ca(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new ha(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>fc(this.syncEngine,t,0)),$o.C()?new $o:new qo)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new oc(t,e,n,r,i,s);return o&&(a.Au=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=Ne(t);Te(la,"RemoteStore shutting down."),e.Ta.add(5),await fa(e),e.Ea.shutdown(),e.da.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}Nc.provider={build:()=>new Nc};class Rc{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.vu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.vu(this.observer.error,t):Se("Uncaught Error in snapshot listener:",t.toString()))}Cu(){this.muted=!0}vu(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const Pc="FirestoreClient";class Lc{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=_e.UNAUTHENTICATED,this.clientId=$e.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async t=>{Te(Pc,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Te(Pc,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Le;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Ba(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Dc(t,e){t.asyncQueue.verifyOperationInProgress(),Te(Pc,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Mo(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Mc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Te(Pc,"Using user provided OfflineComponentProvider");try{await Dc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Re.FAILED_PRECONDITION||t.code===Re.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Ce("Error using user provided cache. Falling back to memory cache: "+n),await Dc(t,new xc)}}else Te(Pc,"Using default OfflineComponentProvider"),await Dc(t,new Oc(void 0));return t._offlineComponents}(t);Te(Pc,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Fa(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Fa(e.remoteStore,n))),t._onlineComponents=e}async function Fc(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Te(Pc,"Using user provided OnlineComponentProvider"),await Mc(t,t._uninitializedComponentsProvider._online)):(Te(Pc,"Using default OnlineComponentProvider"),await Mc(t,new Nc))),t._onlineComponents}async function Uc(t){const e=await Fc(t),n=e.eventManager;return n.onListen=ac.bind(null,e.syncEngine),n.onUnlisten=lc.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=cc.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=hc.bind(null,e.syncEngine),n}function Vc(t,e,n={}){const r=new Le;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new Rc({next:a=>{s.Cu(),e.enqueueAndForget((()=>async function(t,e){const n=Ne(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.ya.indexOf(e);t>=0&&(s.ya.splice(t,1),0===s.ya.length?i=e.Sa()?0:1:!s.wa()&&e.Sa()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new Pe(Re.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new Pe(Re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:t=>i.reject(t)}),o=new Za(ei(n.path),s,{includeMetadataChanges:!0,La:!0});return async function(t,e){const n=Ne(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.wa()&&e.Sa()&&(r=2):(s=new $a,r=e.Sa()?0:1);try{switch(r){case 0:s.pa=await n.onListen(i,!0);break;case 1:s.pa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Ba(t,`Initialization of query '${ci(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.ya.push(e),e.Da(n.onlineState),s.pa&&e.va(s.pa)&&Qa(n)}(t,o)}(await Uc(t),t.asyncQueue,e,n,r))),r.promise}function jc(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Bc=new Map;function Hc(t,e,n){if(!n)throw new Pe(Re.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function qc(t){if(!an.isDocumentKey(t))throw new Pe(Re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function zc(t){if(an.isDocumentKey(t))throw new Pe(Re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $c(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ae(12329,{type:typeof t})}function Kc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Pe(Re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=$c(t);throw new Pe(Re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}const Gc="firestore.googleapis.com",Wc=!0;class Jc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Pe(Re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Gc,this.ssl=Wc}else this.host=t.host,this.ssl=null!==(e=t.ssl)&&void 0!==e?e:Wc;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=oo;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Pe(Re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Pe(Re.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jc(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Pe(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Pe(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Pe(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Qc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Pe(Re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Pe(Re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jc(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Me;switch(t.type){case"firstParty":return new je(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Pe(Re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Bc.get(t);e&&(Te("ComponentProvider","Removing Datastore"),Bc.delete(t),e.terminate())}(this),Promise.resolve()}}class Yc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Yc(this.firestore,t,this._query)}}class Xc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Xc(this.firestore,t,this._key)}}class Zc extends Yc{constructor(t,e,n){super(t,e,ei(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Xc(this.firestore,null,new an(t))}withConverter(t){return new Zc(this.firestore,t,this._path)}}function tu(t,e,...n){if(t=O(t),Hc("collection","path",e),t instanceof Qc){const r=rn.fromString(e,...n);return zc(r),new Zc(t,null,r)}{if(!(t instanceof Xc||t instanceof Zc))throw new Pe(Re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(rn.fromString(e,...n));return zc(r),new Zc(t.firestore,null,r)}}function eu(t,e,...n){if(t=O(t),1===arguments.length&&(e=$e.newId()),Hc("doc","path",e),t instanceof Qc){const r=rn.fromString(e,...n);return qc(r),new Xc(t,null,new an(r))}{if(!(t instanceof Xc||t instanceof Zc))throw new Pe(Re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(rn.fromString(e,...n));return qc(r),new Xc(t.firestore,t instanceof Zc?t.converter:null,new an(r))}}const nu="AsyncQueue";class ru{constructor(t=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new na(this,"async_queue_retry"),this.ec=()=>{const t=ta();t&&Te(nu,"Visibility state changed to "+t.visibilityState),this.C_.p_()},this.tc=t;const e=ta();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.nc(),this.rc(t)}enterRestrictedMode(t){if(!this.ju){this.ju=!0,this.Zu=t||!1;const e=ta();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.ec)}}enqueue(t){if(this.nc(),this.ju)return new Promise((()=>{}));const e=new Le;return this.rc((()=>this.ju&&this.Zu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.zu.push(t),this.sc())))}async sc(){if(0!==this.zu.length){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(t){if(!pn(t))throw t;Te(nu,"Operation failed with retryable error: "+t)}this.zu.length>0&&this.C_.f_((()=>this.sc()))}}rc(t){const e=this.tc.then((()=>(this.Yu=!0,t().catch((t=>{throw this.Ju=t,this.Yu=!1,Se("INTERNAL UNHANDLED ERROR: ",iu(t)),t})).then((t=>(this.Yu=!1,t))))));return this.tc=e,e}enqueueAfterDelay(t,e,n){this.nc(),this.Xu.indexOf(t)>-1&&(e=0);const r=ja.createAndSchedule(this,t,e,n,(t=>this.oc(t)));return this.Hu.push(r),r}nc(){this.Ju&&Ae(47125,{_c:iu(this.Ju)})}verifyOperationInProgress(){}async ac(){let t;do{t=this.tc,await t}while(t!==this.tc)}uc(t){for(const e of this.Hu)if(e.timerId===t)return!0;return!1}cc(t){return this.ac().then((()=>{this.Hu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Hu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ac()}))}lc(t){this.Xu.push(t)}oc(t){const e=this.Hu.indexOf(t);this.Hu.splice(e,1)}}function iu(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class su extends Qc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new ru,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new ru(t),this._firestoreClient=void 0,await t}}}function ou(t){if(t._terminated)throw new Pe(Re.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new tr(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,jc(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new Lc(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class au{constructor(t){this._byteString=t}static fromBase64String(t){try{return new au(Hn.fromBase64String(t))}catch(t){throw new Pe(Re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new au(Hn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class cu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Pe(Re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new on(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class uu{constructor(t){this._methodName=t}}class lu{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Pe(Re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Pe(Re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ke(this._lat,t._lat)||Ke(this._long,t._long)}}class hu{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const du=/^__.*__$/;class fu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Qi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ji(t,this.data,e,this.fieldTransforms)}}class pu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Qi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function mu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ae(40011,{hc:t})}}class gu{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(t){return new gu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tc({path:n,Ec:!1});return r.dc(t),r}Ac(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tc({path:n,Ec:!1});return r.Pc(),r}Rc(t){return this.Tc({path:void 0,Ec:!0})}Vc(t){return Au(t,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Pc(){if(this.path)for(let t=0;t<this.path.length;t++)this.dc(this.path.get(t))}dc(t){if(0===t.length)throw this.Vc("Document fields must not be empty");if(mu(this.hc)&&du.test(t))throw this.Vc('Document fields cannot begin and end with "__"')}}class yu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||ea(t)}gc(t,e,n,r=!1){return new gu({hc:t,methodName:e,fc:n,path:on.emptyPath(),Ec:!1,mc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vu(t){const e=t._freezeSettings(),n=ea(t._databaseId);return new yu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function wu(t,e,n,r,i,s={}){const o=t.gc(s.merge||s.mergeFields?2:0,e,n,i);Tu("Data must be an object, but it was:",o,r);const a=Eu(r,o);let c,u;if(s.merge)c=new jn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Su(e,r,n);if(!o.contains(i))throw new Pe(Re.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);xu(t,i)||t.push(i)}c=new jn(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new fu(new Sr(a),c,u)}class _u extends uu{_toFieldTransform(t){if(2!==t.hc)throw 1===t.hc?t.Vc(`${this._methodName}() can only appear at the top level of your update data`):t.Vc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof _u}}function bu(t,e){if(Iu(t=O(t)))return Tu("Unsupported field value:",e,t),Eu(t,e);if(t instanceof uu)return function(t,e){if(!mu(e.hc))throw e.Vc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Vc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Ec&&4!==e.hc)throw e.Vc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=bu(i,e.Rc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=O(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ki(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ze.fromDate(t);return{timestampValue:As(e.serializer,n)}}if(t instanceof Ze){const n=new Ze(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:As(e.serializer,n)}}if(t instanceof lu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof au)return{bytesValue:xs(e.serializer,t._byteString)};if(t instanceof Xc){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Vc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Rs(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof hu)return function(t,e){return{mapValue:{fields:{[rr]:{stringValue:or},[ar]:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Vc("VectorValues must only contain numeric values.");return Si(e.serializer,t)}))}}}}}}(t,e);throw e.Vc(`Unsupported field value: ${$c(t)}`)}(t,e)}function Eu(t,e){const n={};return Ln(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pn(t,((t,r)=>{const i=bu(r,e.Ic(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Iu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ze||t instanceof lu||t instanceof au||t instanceof Xc||t instanceof uu||t instanceof hu)}function Tu(t,e,n){if(!Iu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=$c(n);throw"an object"===r?e.Vc(t+" a custom object"):e.Vc(t+" "+r)}}function Su(t,e,n){if((e=O(e))instanceof cu)return e._internalPath;if("string"==typeof e)return ku(t,e);throw Au("Field path arguments must be of type string or ",t,!1,void 0,n)}const Cu=new RegExp("[~\\*/\\[\\]]");function ku(t,e,n){if(e.search(Cu)>=0)throw Au(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new cu(...e.split("."))._internalPath}catch(r){throw Au(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Au(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Pe(Re.INVALID_ARGUMENT,a+t+c)}function xu(t,e){return t.some((t=>t.isEqual(e)))}class Ou{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Nu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ru("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Nu extends Ou{data(){return super.data()}}function Ru(t,e){return"string"==typeof e?ku(t,e):e instanceof cu?e._internalPath:e._delegate._internalPath}class Pu{convertValue(t,e="none"){switch(cr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $n(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Kn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Ae(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Pn(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){var e,n,r;const i=null===(r=null===(n=null===(e=t.fields)||void 0===e?void 0:e[ar].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((t=>$n(t.doubleValue)));return new hu(i)}convertGeoPoint(t){return new lu($n(t.latitude),$n(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Xn(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Zn(t));default:return null}}convertTimestamp(t){const e=zn(t);return new Ze(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=rn.fromString(t);Oe(Xs(n),9688,{name:t});const r=new nr(n.get(1),n.get(3)),i=new an(n.popFirst(5));return r.isEqual(e)||Se(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Lu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Du extends Ou{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Mu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Ru("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Mu extends Du{data(t={}){return super.data(t)}}function Fu(t){t=Kc(t,Xc);const e=Kc(t.firestore,su);return Vc(ou(e),t._key).then((n=>function(t,e,n){const r=n.docs.get(e._key),i=new Uu(t);return new Du(t,i,e._key,r,new Lu(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class Uu extends Pu{constructor(t){super(),this.firestore=t}convertBytes(t){return new au(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xc(this.firestore,null,e)}}function Vu(t,e,n){t=Kc(t,Xc);const r=Kc(t.firestore,su),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e,n);return Bu(r,[wu(vu(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Bi.none())])}function ju(t,e,n,...r){t=Kc(t,Xc);const i=Kc(t.firestore,su),s=vu(i);let o;return o="string"==typeof(e=O(e))||e instanceof cu?function(t,e,n,r,i,s){const o=t.gc(1,e,n),a=[Su(e,r,n)],c=[i];if(s.length%2!=0)throw new Pe(Re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(Su(e,s[t])),c.push(s[t+1]);const u=[],l=Sr.empty();for(let t=a.length-1;t>=0;--t)if(!xu(u,a[t])){const e=a[t];let n=c[t];n=O(n);const r=o.Ac(e);if(n instanceof _u)u.push(e);else{const t=bu(n,r);null!=t&&(u.push(e),l.set(e,t))}}const h=new jn(u);return new pu(l,h,o.fieldTransforms)}(s,"updateDoc",t._key,e,n,r):function(t,e,n,r){const i=t.gc(1,e,n);Tu("Data must be an object, but it was:",i,r);const s=[],o=Sr.empty();Pn(r,((t,r)=>{const a=ku(e,t,n);r=O(r);const c=i.Ac(a);if(r instanceof _u)s.push(a);else{const t=bu(r,c);null!=t&&(s.push(a),o.set(a,t))}}));const a=new jn(s);return new pu(o,a,i.fieldTransforms)}(s,"updateDoc",t._key,e),Bu(i,[o.toMutation(t._key,Bi.exists(!0))])}function Bu(t,e){return function(t,e){const n=new Le;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Ac(t);try{const t=await function(t,e){const n=Ne(t),r=Ze.now(),i=e.reduce(((t,e)=>t.add(e.key)),Ii());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=pi(),c=Ii();return n.Bs.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=Gi(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Qi(t.key,e,Cr(e.value.mapValue),Bi.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:yi(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Iu[t.currentUser.toKey()];r||(r=new Dn(Ke)),r=r.insert(e,n),t.Iu[t.currentUser.toKey()]=r}(r,t.batchId,n),await Tc(r,t.changes),await Aa(r.remoteStore)}catch(t){const e=Ba(t,"Failed to persist write");n.reject(e)}}(await function(t){return Fc(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(ou(t),e)}function Hu(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}new WeakMap,function(t,e=!0){!function(t){be=t}($t),jt(new N("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new su(new Ue(t.getProvider("auth-internal")),new He(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Pe(Re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nr(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Wt(ve,we,t),Wt(ve,we,"esm2017")}(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const qu=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},zu=new b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),$u=new B("@firebase/auth");function Ku(t,...e){$u.logLevel<=M.ERROR&&$u.error(`Auth (${$t}): ${t}`,...e)}function Gu(t,...e){throw Yu(t,...e)}function Wu(t,...e){return Yu(t,...e)}function Ju(t,e,n){const r=Object.assign(Object.assign({},qu()),{[e]:n});return new b("auth","Firebase",r).create(e,{appName:t.name})}function Qu(t){return Ju(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Yu(t,...e){if("string"!=typeof t){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return zu.create(t,...e)}function Xu(t,e,...n){if(!t)throw Yu(e,...n)}function Zu(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Ku(e),new Error(e)}function tl(t,e){t||Zu(e)}function el(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function nl(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}function rl(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===nl()||"https:"===nl()||function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||"connection"in navigator))||navigator.onLine}class il{constructor(t,e){this.shortDelay=t,this.longDelay=e,tl(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return rl()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sl(t,e){tl(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class ol{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Zu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Zu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Zu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const al={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},cl=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ul=new il(3e4,6e4);function ll(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function hl(t,e,n,r,i={}){return dl(t,i,(async()=>{let i={},s={};r&&("GET"===e?s=r:i={body:JSON.stringify(r)});const o=S(Object.assign({key:t.config.apiKey},s)).slice(1),a=await t._getAdditionalHeaders();a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode);const c=Object.assign({method:e,headers:a},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&f(t.emulatorConfig.host)&&(c.credentials="include"),ol.fetch()(await pl(t,t.config.apiHost,n,o),c)}))}async function dl(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},al),e);try{const e=new gl(t),i=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw yl(t,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const e=i.ok?s.errorMessage:s.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw yl(t,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw yl(t,"email-already-in-use",s);if("USER_DISABLED"===n)throw yl(t,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Ju(t,a,o);Gu(t,a)}}catch(e){if(e instanceof _)throw e;Gu(t,"network-request-failed",{message:String(e)})}}async function fl(t,e,n,r,i={}){const s=await hl(t,e,n,r,i);return"mfaPendingCredential"in s&&Gu(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function pl(t,e,n,r){const i=`${e}${n}?${r}`,s=t,o=s.config.emulator?sl(t.config,i):`${t.config.apiScheme}://${i}`;return cl.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o}function ml(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class gl{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(Wu(this.auth,"network-request-failed"))),ul.get())}))}}function yl(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Wu(t,e,r);return i.customData._tokenResponse=n,i}function vl(t){return void 0!==t&&void 0!==t.enterprise}class wl{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return ml(e.enforcementState);return null}isProviderEnabled(t){return"ENFORCE"===this.getProviderEnforcementState(t)||"AUDIT"===this.getProviderEnforcementState(t)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function _l(t,e){return hl(t,"GET","/v2/recaptchaConfig",ll(t,e))}async function bl(t,e){return hl(t,"POST","/v1/accounts:lookup",e)}function El(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function Il(t){return 1e3*Number(t)}function Tl(t){const[e,n,r]=t.split(".");if(void 0===e||void 0===n||void 0===r)return Ku("JWT malformed, contained fewer than 3 sections"),null;try{const t=a(n);return t?JSON.parse(t):(Ku("Failed to decode base64 JWT payload"),null)}catch(t){return Ku("Caught error parsing JWT payload as JSON",null==t?void 0:t.toString()),null}}function Sl(t){const e=Tl(t);return Xu(e,"internal-error"),Xu(void 0!==e.exp,"internal-error"),Xu(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}async function Cl(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof _&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class kl{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class Al{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=El(this.lastLoginAt),this.creationTime=El(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xl(t){var e;const n=t.auth,r=await t.getIdToken(),i=await Cl(t,bl(n,{idToken:r}));Xu(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];t._notifyReloadListener(s);const o=(null===(e=s.providerUserInfo)||void 0===e?void 0:e.length)?Ol(s.providerUserInfo):[],a=(c=t.providerData,u=o,[...c.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var c,u;const l=t.isAnonymous,h=!(t.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Al(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}function Ol(t){return t.map((t=>{var{providerId:e}=t,n=Hu(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class Nl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Xu(t.idToken,"internal-error"),Xu(void 0!==t.idToken,"internal-error"),Xu(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):Sl(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Xu(0!==t.length,"internal-error");const e=Sl(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return e||!this.accessToken||this.isExpired?(Xu(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(t,e){const n=await dl(t,{},(async()=>{const n=S({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,s=await pl(t,r,"/v1/token",`key=${i}`),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",ol.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:r,expirationTime:i}=e,s=new Nl;return n&&(Xu("string"==typeof n,"internal-error",{appName:t}),s.refreshToken=n),r&&(Xu("string"==typeof r,"internal-error",{appName:t}),s.accessToken=r),i&&(Xu("number"==typeof i,"internal-error",{appName:t}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Nl,this.toJSON())}_performRefresh(){return Zu("not implemented")}}function Rl(t,e){Xu("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Pl{constructor(t){var{uid:e,auth:n,stsTokenManager:r}=t,i=Hu(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Al(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const e=await Cl(this,this.stsTokenManager.getToken(this.auth,t));return Xu(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=O(t),r=await n.getIdToken(e),i=Tl(r);Xu(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:El(Il(i.auth_time)),issuedAtTime:El(Il(i.iat)),expirationTime:El(Il(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=O(t);await xl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Xu(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Pl(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){Xu(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await xl(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ht(this.auth.app))return Promise.reject(Qu(this.auth));const t=await this.getIdToken();return await Cl(this,async function(t,e){return hl(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,r,i,s,o,a,c,u;const l=null!==(n=e.displayName)&&void 0!==n?n:void 0,h=null!==(r=e.email)&&void 0!==r?r:void 0,d=null!==(i=e.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=e.photoURL)&&void 0!==s?s:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,m=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=e.createdAt)&&void 0!==c?c:void 0,y=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:E}=e;Xu(v&&E,t,"internal-error");const I=Nl.fromJSON(this.name,E);Xu("string"==typeof v,t,"internal-error"),Rl(l,t.name),Rl(h,t.name),Xu("boolean"==typeof w,t,"internal-error"),Xu("boolean"==typeof _,t,"internal-error"),Rl(d,t.name),Rl(f,t.name),Rl(p,t.name),Rl(m,t.name),Rl(g,t.name),Rl(y,t.name);const T=new Pl({uid:v,auth:t,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:I,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(T.providerData=b.map((t=>Object.assign({},t)))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(t,e,n=!1){const r=new Nl;r.updateFromServerResponse(e);const i=new Pl({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:n});return await xl(i),i}static async _fromGetAccountInfoResponse(t,e,n){const r=e.users[0];Xu(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Ol(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new Nl;o.updateFromIdToken(n);const a=new Pl({uid:r.localId,auth:t,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Al(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}const Ll=new Map;function Dl(t){tl(t instanceof Function,"Expected a class definition");let e=Ll.get(t);return e?(tl(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ll.set(t,e),e)}class Ml{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Ml.type="NONE";const Fl=Ml;function Ul(t,e,n){return`firebase:${t}:${e}:${n}`}class Vl{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Ul(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ul("persistence",r.apiKey,i),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if("string"==typeof t){const e=await bl(this.auth,{idToken:t}).catch((()=>{}));return e?Pl._fromGetAccountInfoResponse(this.auth,e,t):null}return Pl._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new Vl(Dl(Fl),t,n);const r=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let i=r[0]||Dl(Fl);const s=Ul(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(s);if(e){let r;if("string"==typeof e){const n=await bl(t,{idToken:e}).catch((()=>{}));if(!n)break;r=await Pl._fromGetAccountInfoResponse(t,n,e)}else r=Pl._fromJSON(t,e);n!==i&&(o=r),i=n;break}}catch(t){}const a=r.filter((t=>t._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==i)try{await t._remove(s)}catch(t){}}))),new Vl(i,t,n)):new Vl(i,t,n)}}function jl(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zl(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Bl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Kl(e))return"Blackberry";if(Gl(e))return"Webos";if(Hl(e))return"Safari";if((e.includes("chrome/")||ql(e))&&!e.includes("edge/"))return"Chrome";if($l(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Bl(t=v()){return/firefox\//i.test(t)}function Hl(t=v()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ql(t=v()){return/crios\//i.test(t)}function zl(t=v()){return/iemobile/i.test(t)}function $l(t=v()){return/android/i.test(t)}function Kl(t=v()){return/blackberry/i.test(t)}function Gl(t=v()){return/webos/i.test(t)}function Wl(t=v()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Jl(t=v()){return Wl(t)||$l(t)||Gl(t)||Kl(t)||/windows phone/i.test(t)||zl(t)}function Ql(t,e=[]){let n;switch(t){case"Browser":n=jl(v());break;case"Worker":n=`${jl(v())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${$t}/${r}`}class Yl{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,r)=>{try{n(t(e))}catch(t){r(t)}}));n.onAbort=e,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==t?void 0:t.message})}}}class Xl{constructor(t){var e,n,r,i;const s=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(e=s.minPasswordLength)&&void 0!==e?e:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=t.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=t.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=null===(e=a.meetsMinPasswordLength)||void 0===e||e),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),r&&(e.meetsMaxPasswordLength=t.length<=r)}validatePasswordCharacterOptions(t,e){let n;this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);for(let r=0;r<t.length;r++)n=t.charAt(r),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=i))}}class Zl{constructor(t,e,n,r){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eh(this),this.idTokenSubscription=new eh(this),this.beforeStateQueue=new Yl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise((t=>this._resolvePersistenceManagerAvailable=t))}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Dl(e)),this._initializationPromise=this.queue((async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await Vl.create(this,t),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUserFromIdToken(t){try{const e=await bl(this,{idToken:t}),n=await Pl._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(Ht(this.app)){const t=this.app.settings.authIdToken;return t?new Promise((e=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(t).then(e,e)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(t){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Xu(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await xl(t)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ht(this.app))return Promise.reject(Qu(this));const e=t?O(t):null;return e&&Xu(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Xu(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return Ht(this.app)?Promise.reject(Qu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ht(this.app)?Promise.reject(Qu(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Dl(t))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await async function(t,e={}){return hl(t,"GET","/v2/passwordPolicy",ll(t,e))}(this),e=new Xl(t);null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new b("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise(((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged((()=>{n(),t()}),e)}}))}async revokeAccessToken(t){if(this.currentUser){const e={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(e.tenantId=this.tenantId),await async function(t,e){return hl(t,"POST","/v2/accounts:revokeToken",ll(t,e))}(this,e)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Dl(t)||this._popupRedirectResolver;Xu(e,this,"argument-error"),this.redirectPersistenceManager=await Vl.create(this,[Dl(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,r){if(this._deleted)return()=>{};const i="function"==typeof e?e:e.next.bind(e);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Xu(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof e){const i=t.addObserver(e,n,r);return()=>{s=!0,i()}}{const n=t.addObserver(e);return()=>{s=!0,n()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Xu(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Ql(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Ht(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){$u.logLevel<=M.WARN&&$u.warn(`Auth (${$t}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function th(t){return O(t)}class eh{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t){const e=new A(t,void 0);return e.subscribe.bind(e)}((t=>this.observer=t))}get next(){return Xu(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rh(t){return nh.loadJS(t)}function ih(t){return`__${t}${Math.floor(1e6*Math.random())}`}class sh{constructor(){this.enterprise=new oh}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class oh{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const ah="NO_RECAPTCHA";class ch{constructor(t){this.type="recaptcha-enterprise",this.auth=th(t)}async verify(t="verify",e=!1){function n(e,n,r){const i=window.grecaptcha;vl(i)?i.enterprise.ready((()=>{i.enterprise.execute(e,{action:t}).then((t=>{n(t)})).catch((()=>{n(ah)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new sh).execute("siteKey",{action:"verify"}):new Promise(((t,r)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise((async(e,n)=>{_l(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new wl(r);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((t=>{n(t)}))}))})(this.auth).then((i=>{if(!e&&vl(window.grecaptcha))n(i,t,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let e=nh.recaptchaEnterpriseScript;0!==e.length&&(e+=i),rh(e).then((()=>{n(i,t,r)})).catch((t=>{r(t)}))}})).catch((t=>{r(t)}))}))}}async function uh(t,e,n,r=!1,i=!1){const s=new ch(t);let o;if(i)o=ah;else try{o=await s.verify(n)}catch(t){o=await s.verify(n,!0)}const a=Object.assign({},e);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const t=a.phoneEnrollmentInfo.phoneNumber,e=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:t,recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const t=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function lh(t,e,n,r,i){var s,o;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=t._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await uh(t,e,n,"getOobCode"===n);return r(t,i)}return r(t,e).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await uh(t,e,n,"getOobCode"===n);return r(t,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(o=t._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const i=await uh(t,e,n);return r(t,i).catch((async i=>{var s;if("AUDIT"===(null===(s=t._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await uh(t,e,n,!1,!0);return r(t,i)}return Promise.reject(i)}))}{const i=await uh(t,e,n,!1,!0);return r(t,i)}}return Promise.reject(i+" provider is not supported.")}function hh(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function dh(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class fh{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Zu("not implemented")}_getIdTokenResponse(t){return Zu("not implemented")}_linkToIdToken(t,e){return Zu("not implemented")}_getReauthenticationResolver(t){return Zu("not implemented")}}async function ph(t,e){return hl(t,"POST","/v1/accounts:signUp",e)}async function mh(t,e){return fl(t,"POST","/v1/accounts:signInWithPassword",ll(t,e))}class gh extends fh{constructor(t,e,n,r=null){super("password",n),this._email=t,this._password=e,this._tenantId=r}static _fromEmailAndPassword(t,e){return new gh(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new gh(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return lh(t,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",mh,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(t,e){return fl(t,"POST","/v1/accounts:signInWithEmailLink",ll(t,e))}(t,{email:this._email,oobCode:this._password});default:Gu(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return lh(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ph,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(t,e){return fl(t,"POST","/v1/accounts:signInWithEmailLink",ll(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:Gu(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function yh(t,e){return fl(t,"POST","/v1/accounts:signInWithIdp",ll(t,e))}class vh extends fh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new vh(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Gu("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:r}=e,i=Hu(e,["providerId","signInMethod"]);if(!n||!r)return null;const s=new vh(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(t){return yh(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,yh(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,yh(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=S(e)}return t}}async function wh(t,e){return hl(t,"POST","/v1/accounts:sendVerificationCode",ll(t,e))}const _h={USER_NOT_FOUND:"user-not-found"};class bh extends fh{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new bh({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new bh({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return fl(t,"POST","/v1/accounts:signInWithPhoneNumber",ll(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await fl(t,"POST","/v1/accounts:signInWithPhoneNumber",ll(t,e));if(n.temporaryProof)throw yl(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return fl(t,"POST","/v1/accounts:signInWithPhoneNumber",ll(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),_h)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:r}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:r}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:i}=t;return n||e||r||i?new bh({verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Eh{constructor(t){var e,n,r,i,s,o;const a=C(k(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Xu(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=C(k(t)).link,n=e?C(k(e)).deep_link_id:null,r=C(k(t)).deep_link_id;return(r?C(k(r)).link:null)||r||n||e||t}(t);try{return new Eh(e)}catch(t){return null}}}class Ih{constructor(){this.providerId=Ih.PROVIDER_ID}static credential(t,e){return gh._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Eh.parseLink(e);return Xu(n,"argument-error"),gh._fromEmailAndCode(t,n.code,n.tenantId)}}Ih.PROVIDER_ID="password",Ih.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ih.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Th{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Sh extends Th{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Ch extends Sh{constructor(){super("facebook.com")}static credential(t){return vh._fromParams({providerId:Ch.PROVIDER_ID,signInMethod:Ch.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ch.credentialFromTaggedObject(t)}static credentialFromError(t){return Ch.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Ch.credential(t.oauthAccessToken)}catch(t){return null}}}Ch.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ch.PROVIDER_ID="facebook.com";class kh extends Sh{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return vh._fromParams({providerId:kh.PROVIDER_ID,signInMethod:kh.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return kh.credentialFromTaggedObject(t)}static credentialFromError(t){return kh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return kh.credential(e,n)}catch(t){return null}}}kh.GOOGLE_SIGN_IN_METHOD="google.com",kh.PROVIDER_ID="google.com";class Ah extends Sh{constructor(){super("github.com")}static credential(t){return vh._fromParams({providerId:Ah.PROVIDER_ID,signInMethod:Ah.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ah.credentialFromTaggedObject(t)}static credentialFromError(t){return Ah.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Ah.credential(t.oauthAccessToken)}catch(t){return null}}}Ah.GITHUB_SIGN_IN_METHOD="github.com",Ah.PROVIDER_ID="github.com";class xh extends Sh{constructor(){super("twitter.com")}static credential(t,e){return vh._fromParams({providerId:xh.PROVIDER_ID,signInMethod:xh.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return xh.credentialFromTaggedObject(t)}static credentialFromError(t){return xh.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return xh.credential(e,n)}catch(t){return null}}}xh.TWITTER_SIGN_IN_METHOD="twitter.com",xh.PROVIDER_ID="twitter.com";class Oh{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,r=!1){const i=await Pl._fromIdTokenResponse(t,n,r),s=Nh(n);return new Oh({user:i,providerId:s,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const r=Nh(n);return new Oh({user:t,providerId:r,_tokenResponse:n,operationType:e})}}function Nh(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Rh extends _{constructor(t,e,n,r){var i;super(e.code,e.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Rh.prototype),this.customData={appName:t.name,tenantId:null!==(i=t.tenantId)&&void 0!==i?i:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,r){return new Rh(t,e,n,r)}}function Ph(t,e,n,r){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Rh._fromErrorAndOperation(t,n,e,r);throw n}))}function Lh(t,e){return hl(t,"POST","/v2/accounts/mfaEnrollment:start",ll(t,e))}new WeakMap;const Dh="__sak";class Mh{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Dh,"1"),this.storage.removeItem(Dh),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Fh extends Mh{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Jl(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),r=this.localCache[e];n!==r&&t(e,r,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;e?this.detachListener():this.stopPolling();const r=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},i=this.storage.getItem(n);!function(){const t=v();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||10!==document.documentMode||i===t.newValue||t.newValue===t.oldValue?r():setTimeout(r,10)}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Fh.type="LOCAL";const Uh=Fh;class Vh extends Mh{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Vh.type="SESSION";const jh=Vh;class Bh{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Bh(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:r,data:i}=e.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async t=>t(e.origin,i))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Hh(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Bh.receivers=[];class qh{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Hh("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function zh(){return window}function $h(){return void 0!==zh().WorkerGlobalScope&&"function"==typeof zh().importScripts}const Kh="firebaseLocalStorageDb",Gh="firebaseLocalStorage",Wh="fbase_key";class Jh{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function Qh(t,e){return t.transaction([Gh],e?"readwrite":"readonly").objectStore(Gh)}function Yh(){const t=indexedDB.open(Kh,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(Gh,{keyPath:Wh})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(Gh)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(Kh);return new Jh(t).toPromise()}(),e(await Yh()))}))}))}async function Xh(t,e,n){const r=Qh(t,!0).put({[Wh]:e,value:n});return new Jh(r).toPromise()}function Zh(t,e){const n=Qh(t,!0).delete(e);return new Jh(n).toPromise()}class td{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Yh()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $h()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Bh._getInstance($h()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new qh(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Yh();return await Xh(t,Dh,"1"),await Zh(t,Dh),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>Xh(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=Qh(t,!1).get(e),r=await new Jh(n).toPromise();return void 0===r?null:r.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>Zh(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=Qh(t,!1).getAll();return new Jh(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;if(0!==t.length)for(const{fbase_key:r,value:i}of t)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),e.push(r));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}td.type="LOCAL";const ed=td;function nd(t,e){return hl(t,"POST","/v2/accounts/mfaSignIn:start",ll(t,e))}ih("rcb"),new il(3e4,6e4);const rd="recaptcha";async function id(t,e,n){var r;if(!t._getRecaptchaConfig())try{await async function(t){const e=th(t),n=await _l(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new wl(n);null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new ch(e).verify()}(t)}catch(t){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof e?{phoneNumber:e}:e,"session"in i){const e=i.session;if("phoneNumber"in i){Xu("enroll"===e.type,t,"internal-error");const r=lh(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(t,e)=>e.phoneEnrollmentInfo.captchaResponse===ah?(Xu((null==n?void 0:n.type)===rd,t,"argument-error"),Lh(t,await sd(t,e,n))):Lh(t,e)),"PHONE_PROVIDER");return(await r.catch((t=>Promise.reject(t)))).phoneSessionInfo.sessionInfo}{Xu("signin"===e.type,t,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Xu(s,t,"missing-multi-factor-info");const o=lh(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(t,e)=>e.phoneSignInInfo.captchaResponse===ah?(Xu((null==n?void 0:n.type)===rd,t,"argument-error"),nd(t,await sd(t,e,n))):nd(t,e)),"PHONE_PROVIDER");return(await o.catch((t=>Promise.reject(t)))).phoneResponseInfo.sessionInfo}}{const e=lh(t,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(t,e)=>e.captchaResponse===ah?(Xu((null==n?void 0:n.type)===rd,t,"argument-error"),wh(t,await sd(t,e,n))):wh(t,e)),"PHONE_PROVIDER");return(await e.catch((t=>Promise.reject(t)))).sessionInfo}}finally{null==n||n._reset()}}async function sd(t,e,n){Xu(n.type===rd,t,"argument-error");const r=await n.verify();Xu("string"==typeof r,t,"argument-error");const i=Object.assign({},e);if("phoneEnrollmentInfo"in i){const t=i.phoneEnrollmentInfo.phoneNumber,e=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:t,recaptchaToken:r,captchaResponse:e,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const t=i.phoneSignInInfo.captchaResponse,e=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:t,clientType:e,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class od{constructor(t){this.providerId=od.PROVIDER_ID,this.auth=th(t)}verifyPhoneNumber(t,e){return id(this.auth,t,O(e))}static credential(t,e){return bh._fromVerification(t,e)}static credentialFromResult(t){const e=t;return od.credentialFromTaggedObject(e)}static credentialFromError(t){return od.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?bh._fromTokenResponse(e,n):null}}od.PROVIDER_ID="phone",od.PHONE_SIGN_IN_METHOD="phone";class ad extends fh{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return yh(t,this._buildIdpRequest())}_linkToIdToken(t,e){return yh(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return yh(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function cd(t){return async function(t,e,n=!1){if(Ht(t.app))return Promise.reject(Qu(t));const r="signIn",i=await Ph(t,r,e),s=await Oh._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}(t.auth,new ad(t),t.bypassAuthState)}function ud(t){const{auth:e,user:n}=t;return Xu(n,e,"internal-error"),async function(t,e,n=!1){const{auth:r}=t;if(Ht(r.app))return Promise.reject(Qu(r));const i="reauthenticate";try{const s=await Cl(t,Ph(r,i,e,t),n);Xu(s.idToken,r,"internal-error");const o=Tl(s.idToken);Xu(o,r,"internal-error");const{sub:a}=o;return Xu(t.uid===a,r,"user-mismatch"),Oh._forOperation(t,i,s)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&Gu(r,"user-mismatch"),t}}(n,new ad(t),t.bypassAuthState)}async function ld(t){const{auth:e,user:n}=t;return Xu(n,e,"internal-error"),async function(t,e,n=!1){const r=await Cl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Oh._forOperation(t,"link",r)}(n,new ad(t),t.bypassAuthState)}class hd{constructor(t,e,n,r,i=!1){this.auth=t,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=t;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return cd;case"linkViaPopup":case"linkViaRedirect":return ld;case"reauthViaPopup":case"reauthViaRedirect":return ud;default:Gu(this.auth,"internal-error")}}resolve(t){tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const dd=new il(2e3,1e4);class fd extends hd{constructor(t,e,n,r,i){super(t,e,r,i),this.provider=n,this.authWindow=null,this.pollId=null,fd.currentPopupAction&&fd.currentPopupAction.cancel(),fd.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Xu(t,this.auth,"internal-error"),t}async onExecution(){tl(1===this.filter.length,"Popup operations only handle one event");const t=Hh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(Wu(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Wu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fd.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Wu(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(t,dd.get())};t()}}fd.currentPopupAction=null;const pd=new Map;class md extends hd{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=pd.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return Ul("pendingRedirect",t.config.apiKey,t.name)}(e),r=function(t){return Dl(t._redirectPersistence)}(t);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}pd.set(this.auth._key(),t)}return this.bypassAuthState||pd.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function gd(t,e){pd.set(t._key(),e)}async function yd(t,e,n=!1){if(Ht(t.app))return Promise.reject(Qu(t));const r=th(t),i=function(t,e){return e?Dl(e):(Xu(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(r,e),s=new md(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}class vd{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _d(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!_d(t)){const r=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(Wu(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(wd(t))}saveEventToCache(t){this.cachedEventUids.add(wd(t)),this.lastProcessedEventTime=Date.now()}}function wd(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function _d({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const bd=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ed=/^https?/;function Id(t){const e=el(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const i=new URL(t);return""===i.hostname&&""===r?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ed.test(n))return!1;if(bd.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Td=new il(3e4,6e4);function Sd(){const t=zh().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}function Cd(t){return new Promise(((e,n)=>{var r,i,s;function o(){Sd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Sd(),n(Wu(t,"network-request-failed"))},timeout:Td.get()})}if(null===(i=null===(r=zh().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)e(gapi.iframes.getContext());else{if(!(null===(s=zh().gapi)||void 0===s?void 0:s.load)){const e=ih("iframefcb");return zh()[e]=()=>{gapi.load?o():n(Wu(t,"network-request-failed"))},rh(`${nh.gapiScript}?onload=${e}`).catch((t=>n(t)))}o()}})).catch((t=>{throw kd=null,t}))}let kd=null;const Ad=new il(5e3,15e3),xd={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Od=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Nd(t){const e=t.config;Xu(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?sl(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,r={apiKey:e.apiKey,appName:t.name,v:$t},i=Od.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${S(r).slice(1)}`}const Rd={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Pd{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const Ld=encodeURIComponent("fac");async function Dd(t,e,n,r,i,s){Xu(t.config.authDomain,t,"auth-domain-config-required"),Xu(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:$t,eventId:i};if(e instanceof Th){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(s||{}))o[t]=e}if(e instanceof Sh){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];const c=await t._getAppCheckToken(),u=c?`#${Ld}=${encodeURIComponent(c)}`:"";return`${function({config:t}){return t.emulator?sl(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${S(a).slice(1)}${u}`}const Md="webStorageSupport",Fd=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jh,this._completeRedirectFn=yd,this._overrideRedirectResult=gd}async _openPopup(t,e,n,r){var i;return tl(null===(i=this.eventManagers[t._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(t,e,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Rd),{width:r.toString(),height:i.toString(),top:s,left:o}),u=v().toLowerCase();n&&(a=ql(u)?"_blank":n),Bl(u)&&(e=e||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=v()){var e;return Wl(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==a)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(e||"",a),new Pd(null);const h=window.open(e||"",a,l);Xu(h,t,"popup-blocked");try{h.focus()}catch(t){}return new Pd(h)}(t,await Dd(t,e,n,el(),r),Hh())}async _openRedirect(t,e,n,r){return await this._originValidation(t),i=await Dd(t,e,n,el(),r),zh().location.href=i,new Promise((()=>{}));var i}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(tl(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await function(t){return kd=kd||Cd(t),kd}(t),n=zh().gapi;return Xu(n,t,"internal-error"),e.open({where:document.body,url:Nd(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xd,dontclear:!0},(e=>new Promise((async(n,r)=>{await e.restyle({setHideOnLeave:!1});const i=Wu(t,"network-request-failed"),s=zh().setTimeout((()=>{r(i)}),Ad.get());function o(){zh().clearTimeout(s),n(e)}e.ping(o).then(o,(()=>{r(i)}))}))))}(t),n=new vd(t);return e.register("authEvent",(e=>(Xu(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Md,{type:Md},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Md];void 0!==i&&e(!!i),Gu(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return hl(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(Id(t))return}catch(t){}Gu(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return Jl()||Hl()||Wl()}};var Ud="@firebase/auth",Vd="1.10.6";class jd{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Xu(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Bd=h("authIdTokenMaxAge")||300;let Hd=null;var qd;nh={loadJS:t=>new Promise(((e,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",t),r.onload=e,r.onerror=t=>{const e=Wu("internal-error");e.customData=t,n(e)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},qd="Browser",jt(new N("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),i=t.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Xu(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:qd,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ql(qd)},c=new Zl(n,r,i,a);return function(t,e){const n=(null==e?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Dl);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,null==e?void 0:e.popupRedirectResolver)}(c,e),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),jt(new N("auth-internal",(t=>(t=>new jd(t))(th(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Wt(Ud,Vd,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(qd)),Wt(Ud,Vd,"esm2017");var zd=n(212),$d=n(347);function Kd(t){return Kd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kd(t)}function Gd(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wd(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Gd(Object(n),!0).forEach((function(e){Jd(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gd(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Jd(t,e,n){return(e=function(t){var e=function(t){if("object"!=Kd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Kd(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kd(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qd(){Qd=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var s=e&&e.prototype instanceof y?e:y,o=Object.create(s.prototype),a=new O(r||[]);return i(o,"_invoke",{value:C(t,n,a)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var _={};u(_,o,(function(){return this}));var b=Object.getPrototypeOf,E=b&&b(b(N([])));E&&E!==n&&r.call(E,o)&&(_=E);var I=w.prototype=y.prototype=Object.create(_);function T(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,s,o,a){var c=h(t[i],t,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Kd(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function C(e,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=k(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(e,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function k(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,k(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(Kd(e)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},T(S.prototype),u(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new S(l(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},T(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function Yd(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Xd(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){Yd(s,r,i,o,a,"next",t)}function a(t){Yd(s,r,i,o,a,"throw",t)}o(void 0)}))}}var Zd=Kt({apiKey:"AIzaSyD-nz4XWkjqVF3aKaTe7MtI7Z50LAccruA",authDomain:"logical-puzzle-85c9b.firebaseapp.com",projectId:"logical-puzzle-85c9b",storageBucket:"logical-puzzle-85c9b.firebasestorage.app",messagingSenderId:"434826676446",appId:"1:434826676446:web:5939d792873c864ad29a4f",measurementId:"G-QBZ149WG20"}),tf=function(t=Gt()){const e=Bt(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=Bt(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(I(n.getOptions(),null!=e?e:{}))return t;Gu(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:Fd,persistence:[ed,Uh,jh]}),r=h("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(r,location.origin);if(location.origin===t.origin){const e=(i=t.toString(),async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>Bd)return;const r=null==e?void 0:e.token;Hd!==r&&(Hd=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(t,e,n){O(t).beforeAuthStateChanged(e,n)}(n,e,(()=>e(n.currentUser))),function(t){O(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}}var i;const s=u("auth");return s&&function(t,e,n){const r=th(t);Xu(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=hh(e),{host:o,port:a}=function(t){const e=hh(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const t=i[1];return{host:t,port:dh(r.substr(t.length+1))}}{const[t,e]=r.split(":");return{host:t,port:dh(e)}}}(e),c=null===a?"":`:${a}`,u={url:`${s}//${o}${c}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return Xu(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Xu(I(u,r.config.emulator)&&I(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=u,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,f(o)?(p(`${s}//${o}${c}`),y("Auth",!0)):i||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(n,`http://${s}`),n}(Zd),ef=function(t){const e="object"==typeof t?t:Gt(),n="string"==typeof t?t:er,r=Bt(e,"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(()=>{const t=u("firestore");if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return"["===t[0]?[t.substring(1,e-1),n]:[t.substring(0,e),n]})();t&&function(t,e,n,r={}){var i;t=Kc(t,Qc);const s=f(e),a=t._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:t._getEmulatorOptions()}),u=`${e}:${n}`;s&&(p(`https://${u}`),y("Firestore",!0)),a.host!==Gc&&a.host!==u&&Ce("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},a),{host:u,ssl:s,emulatorOptions:r});if(!I(l,c)&&(t._setSettings(l),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=_e.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Pe(Re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _e(s)}t._authCredentials=new Fe(new De(e,n))}}(r,...t)}return r}(Zd),nf="not initialized yet";function rf(t,e){return sf.apply(this,arguments)}function sf(){return(sf=Xd(Qd().mark((function t(e,n){var r,i,s;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=(null==n?void 0:n.end_time)||(0,$d.Fv)(),t.next=4,of(r);case 4:if(i=t.sent,e){t.next=8;break}return console.warn("âš ï¸ No experiment found. Skipping experiment update."),t.abrupt("return");case 8:return t.next=10,lf(i,e,r);case 10:if(s=t.sent,n){t.next=14;break}return console.warn("âš ï¸ Trial is null or undefined. Skipped saving trial data."),t.abrupt("return");case 14:return t.next=16,df(s,n);case 16:console.log("âœ… Trial ".concat(n.trial_id," saved for user ").concat(zd.KJ.prolific_pid,".")),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),console.error("âŒ Failed to save trial:",t.t0);case 22:case"end":return t.stop()}}),t,null,[[0,19]])})))).apply(this,arguments)}function of(t){return af.apply(this,arguments)}function af(){return(af=Xd(Qd().mark((function t(e){var n,r;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=eu(ef,"users",zd.KJ.prolific_pid),r={prolific_pid:zd.KJ.prolific_pid,firebase_uid:nf,create_time:zd.KJ.create_time,end_time:e,is_consent:zd.KJ.is_consent,is_passed_comprehension:zd.KJ.is_passed_comprehension,is_passed_attention_check:zd.KJ.is_passed_attention_check,is_passed_all_experiments:zd.KJ.is_passed_all_experiments,num_objects:zd.KJ.num_objects,exp_group:zd.KJ.exp_group},t.next=5,Vu(n,r,{merge:!0});case 5:return console.log("âœ… User prolific_pid: ".concat(zd.KJ.prolific_pid," updated.")),t.abrupt("return",n);case 9:t.prev=9,t.t0=t.catch(0),console.error("âŒ Failed to save user data:",t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}function cf(t){return uf.apply(this,arguments)}function uf(){return(uf=Xd(Qd().mark((function t(e){var n,r;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=eu(ef,"users",e),t.next=3,Fu(n);case 3:return r=t.sent,t.abrupt("return",r.exists());case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function lf(t,e,n){return hf.apply(this,arguments)}function hf(){return(hf=Xd(Qd().mark((function t(e,n,r){var i;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=eu(tu(e,"experiments"),"".concat(n.experiment_id)),t.next=4,Fu(i);case 4:if(t.sent.exists()){t.next=10;break}return t.next=8,Vu(i,{experiment_id:n.experiment_id,create_time:n.create_time,end_time:r,num_trials:n.num_trials,is_passed_attention_check:n.is_passed_attention_check,is_finished:n.is_finished,total_correct_trials:n.total_correct_trials,total_ask_ai_count:n.total_ask_ai_count});case 8:t.next=12;break;case 10:return t.next=12,ju(i,{end_time:r,is_passed_attention_check:n.is_passed_attention_check,is_finished:n.is_finished,num_trials:n.num_trials,total_correct_trials:n.total_correct_trials,total_ask_ai_count:n.total_ask_ai_count});case 12:return console.log("âœ… Experiment ".concat(n.experiment_id," for User ").concat(zd.KJ.prolific_pid," updated.")),t.abrupt("return",i);case 16:t.prev=16,t.t0=t.catch(0),console.error("âŒ Failed to save experiment data:",t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function df(t,e){return ff.apply(this,arguments)}function ff(){return(ff=Xd(Qd().mark((function t(e,n){var r;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=n.is_comprehension_check?eu(tu(e,"comprehension_trials"),"".concat(n.trial_id)):eu(tu(e,"trials"),"".concat(n.trial_id)),t.next=4,Vu(r,{trial_id:n.trial_id,question_id:n.question_id,create_time:n.create_time,end_time:n.end_time,is_attention_check:n.is_attention_check,is_comprehension_check:n.is_comprehension_check,score:n.score,correct_num:n.correct_num,ai_choice:n.ai_choice,best_choice:n.best_choice,user_choice:n.user_choice,total_submissions:n.total_submissions,total_steps:n.total_steps,ask_ai_count:n.ask_ai_count,cur_total_correct_trials:n.cur_total_correct_trials,cur_total_ask_ai_count:n.cur_total_ask_ai_count,total_time:n.total_time});case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("âŒ Failed to save trial data:",t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}function pf(t){return mf.apply(this,arguments)}function mf(){return(mf=Xd(Qd().mark((function t(e){var n,r;return Qd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=eu(ef,"users",zd.KJ.prolific_pid),r=eu(tu(n,"feedback"),"feedback_main"),t.next=5,Promise.all([Vu(r,Wd({},e)),ju(n,{end_time:zd.KJ.end_time})]);case 5:console.log("âœ… Feedback saved and end_time updated in Firestore."),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("âŒ Failed to save feedback:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}(async function(t){var e;if(Ht(t.app))return Promise.reject(Qu(t));const n=th(t);if(await n._initializationPromise,null===(e=n.currentUser)||void 0===e?void 0:e.isAnonymous)return new Oh({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await async function(t,e){return fl(t,"POST","/v1/accounts:signUp",ll(t,e))}(n,{returnSecureToken:!0}),i=await Oh._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i})(tf).then((function(){console.log("Signed in anonymously")})).catch((function(t){console.error("Authentication error",t)})),function(t){O(t).onAuthStateChanged((function(t){t?nf=t.uid:console.log("User is signed out")}),void 0,void 0)}(tf)},730:(t,e,n)=>{"use strict";n.d(e,{DM:()=>i,Jg:()=>o,NV:()=>u,UT:()=>h,Y_:()=>s,_A:()=>l,_H:()=>c,eb:()=>d,gV:()=>r,jT:()=>a});var r=document.getElementById("consentContainer"),i=document.getElementById("instructionsContainer"),s=document.getElementById("gameContainer"),o=document.getElementById("time-box"),a=document.getElementById("modalContainer"),c=(document.getElementById("feedbackContainer"),document.getElementById("left-panel")),u=(document.getElementById("center-panel"),document.getElementById("right-panel"),document.getElementById("option-container")),l=document.getElementById("label-container"),h=(document.getElementById("solution-container"),document.getElementById("solution-label"));function d(){["consentContainer","instructionContainer","gameContainer","feedbackContainer"].forEach((function(t){var e=document.getElementById(t);e&&(e.style.display="none")}))}},809:function(t,e){var n,r;n=function t(){var e,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},r=!n.document&&!!n.postMessage,i=n.IS_PAPA_WORKER||!1,s={},o=0,a={};function c(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var e=w(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new f(e),(this._handle.streamer=this)._config=e}.call(this,t),this.parseChunk=function(t,e){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let e=this._config.newline;e||(s=this._config.quoteChar||'"',e=this._handle.guessLineEndings(t,s)),t=[...t.split(e).slice(r)].join(e)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&void 0!==(s=this._config.beforeFirstChunk(t))&&(t=s),this.isFirstChunk=!1,this._halted=!1,r=this._partialLine+t;var s=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=s.meta.cursor,this._finished||(this._partialLine=r.substring(t-this._baseIndex),this._baseIndex=t),s&&s.data&&(this._rowCount+=s.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,i)n.postMessage({results:s,workerId:a.WORKER_ID,finished:r});else if(b(this._config.chunk)&&!e){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!r||!b(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(t){b(this._config.error)?this._config.error(t):i&&this._config.error&&n.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function u(t){var e;(t=t||{}).chunkSize||(t.chunkSize=a.RemoteChunkSize),c.call(this,t),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),r||(e.onload=_(this._chunkLoaded,this),e.onerror=_(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var t,n=this._config.downloadRequestHeaders;for(t in n)e.setRequestHeader(t,n[t])}var i;this._config.chunkSize&&(i=this._start+this._config.chunkSize-1,e.setRequestHeader("Range","bytes="+this._start+"-"+i));try{e.send(this._config.downloadRequestBody)}catch(t){this._chunkError(t.message)}r&&0===e.status&&this._chunkError()}},this._chunkLoaded=function(){4===e.readyState&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize||e.responseText.length,this._finished=!this._config.chunkSize||this._start>=(t=>null!==(t=t.getResponseHeader("Content-Range"))?parseInt(t.substring(t.lastIndexOf("/")+1)):-1)(e),this.parseChunk(e.responseText)))},this._chunkError=function(t){t=e.statusText||t,this._sendError(new Error(t))}}function l(t){(t=t||{}).chunkSize||(t.chunkSize=a.LocalChunkSize),c.call(this,t);var e,n,r="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,n=t.slice||t.webkitSlice||t.mozSlice,r?((e=new FileReader).onload=_(this._chunkLoaded,this),e.onerror=_(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input,i=(this._config.chunkSize&&(i=Math.min(this._start+this._config.chunkSize,this._input.size),t=n.call(t,this._start,i)),e.readAsText(t,this._config.encoding));r||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function h(t){var e;c.call(this,t=t||{}),this.stream=function(t){return e=t,this._nextChunk()},this._nextChunk=function(){var t,n;if(!this._finished)return t=this._config.chunkSize,e=t?(n=e.substring(0,t),e.substring(t)):(n=e,""),this._finished=!e,this.parseChunk(n)}}function d(t){c.call(this,t=t||{});var e=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===e.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):n=!0},this._streamData=_((function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(t){this._streamError(t)}}),this),this._streamError=_((function(t){this._streamCleanUp(),this._sendError(t)}),this),this._streamEnd=_((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=_((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function f(t){var e,n,r,i,s=Math.pow(2,53),o=-s,c=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,u=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,h=0,d=0,f=!1,g=!1,y=[],v={data:[],errors:[],meta:{}};function _(e){return"greedy"===t.skipEmptyLines?""===e.join("").trim():1===e.length&&0===e[0].length}function E(){if(v&&r&&(T("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),r=!1),t.skipEmptyLines&&(v.data=v.data.filter((function(t){return!_(t)}))),I()){if(v)if(Array.isArray(v.data[0])){for(var e=0;I()&&e<v.data.length;e++)v.data[e].forEach(n);v.data.splice(0,1)}else v.data.forEach(n);function n(e,n){b(t.transformHeader)&&(e=t.transformHeader(e,n)),y.push(e)}}function i(e,n){for(var r=t.header?{}:[],i=0;i<e.length;i++){var a=i,l=e[i];l=((e,n)=>(e=>(t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping)))(e)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((t=>{if(c.test(t)&&(t=parseFloat(t),o<t&&t<s))return 1})(n)?parseFloat(n):u.test(n)?new Date(n):""===n?null:n):n)(a=t.header?i>=y.length?"__parsed_extra":y[i]:a,l=t.transform?t.transform(l,a):l),"__parsed_extra"===a?(r[a]=r[a]||[],r[a].push(l)):r[a]=l}return t.header&&(i>y.length?T("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+i,d+n):i<y.length&&T("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+i,d+n)),r}var l;v&&(t.header||t.dynamicTyping||t.transform)&&(l=1,!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(i),l=v.data.length):v.data=i(v.data,0),t.header&&v.meta&&(v.meta.fields=y),d+=l)}function I(){return t.header&&0===y.length}function T(t,e,n,r){t={type:t,code:e,message:n},void 0!==r&&(t.row=r),v.errors.push(t)}b(t.step)&&(i=t.step,t.step=function(e){v=e,I()?E():(E(),0!==v.data.length&&(h+=e.data.length,t.preview&&h>t.preview?n.abort():(v.data=v.data[0],i(v,l))))}),this.parse=function(i,s,o){var c=t.quoteChar||'"';return t.newline||(t.newline=this.guessLineEndings(i,c)),r=!1,t.delimiter?b(t.delimiter)&&(t.delimiter=t.delimiter(i),v.meta.delimiter=t.delimiter):((c=((e,n,r,i,s)=>{var o,c,u,l;s=s||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var h=0;h<s.length;h++){for(var d,f=s[h],p=0,g=0,y=0,v=(u=void 0,new m({comments:i,delimiter:f,newline:n,preview:10}).parse(e)),w=0;w<v.data.length;w++)r&&_(v.data[w])?y++:(g+=d=v.data[w].length,void 0===u?u=d:0<d&&(p+=Math.abs(d-u),u=d));0<v.data.length&&(g/=v.data.length-y),(void 0===c||p<=c)&&(void 0===l||l<g)&&1.99<g&&(c=p,o=f,l=g)}return{successful:!!(t.delimiter=o),bestDelimiter:o}})(i,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=c.bestDelimiter:(r=!0,t.delimiter=a.DefaultDelimiter),v.meta.delimiter=t.delimiter),c=w(t),t.preview&&t.header&&c.preview++,e=i,n=new m(c),v=n.parse(e,s,o),E(),f?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,n.abort(),e=b(t.chunk)?"":e.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(f=!1,l.streamer.parseChunk(e,!0)):setTimeout(l.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,n.abort(),v.meta.aborted=!0,b(t.complete)&&t.complete(v),e=""},this.guessLineEndings=function(t,e){t=t.substring(0,1048576),e=new RegExp(p(e)+"([^]*?)"+p(e),"gm");var n=(t=t.replace(e,"")).split("\r");if(t=1<(e=t.split("\n")).length&&e[0].length<n[0].length,1===n.length||t)return"\n";for(var r=0,i=0;i<n.length;i++)"\n"===n[i][0]&&r++;return r>=n.length/2?"\r\n":"\r"}}function p(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(t){var e=(t=t||{}).delimiter,n=t.newline,r=t.comments,i=t.step,s=t.preview,o=t.fastMode,c=null,u=!1,l=null==t.quoteChar?'"':t.quoteChar,h=l;if(void 0!==t.escapeChar&&(h=t.escapeChar),("string"!=typeof e||-1<a.BAD_DELIMITERS.indexOf(e))&&(e=","),r===e)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var d=0,f=!1;this.parse=function(a,m,g){if("string"!=typeof a)throw new Error("Input must be a string");var y=a.length,v=e.length,w=n.length,_=r.length,E=b(i),I=[],T=[],S=[],C=d=0;if(!a)return U();if(o||!1!==o&&-1===a.indexOf(l)){for(var k=a.split(n),A=0;A<k.length;A++){if(S=k[A],d+=S.length,A!==k.length-1)d+=n.length;else if(g)return U();if(!r||S.substring(0,_)!==r){if(E){if(I=[],L(S.split(e)),V(),f)return U()}else L(S.split(e));if(s&&s<=A)return I=I.slice(0,s),U(!0)}}return U()}for(var x=a.indexOf(e,d),O=a.indexOf(n,d),N=new RegExp(p(h)+p(l),"g"),R=a.indexOf(l,d);;)if(a[d]===l)for(R=d,d++;;){if(-1===(R=a.indexOf(l,R+1)))return g||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:I.length,index:d}),M();if(R===y-1)return M(a.substring(d,R).replace(N,l));if(l===h&&a[R+1]===h)R++;else if(l===h||0===R||a[R-1]!==h){-1!==x&&x<R+1&&(x=a.indexOf(e,R+1));var P=D(-1===(O=-1!==O&&O<R+1?a.indexOf(n,R+1):O)?x:Math.min(x,O));if(a.substr(R+1+P,v)===e){S.push(a.substring(d,R).replace(N,l)),a[d=R+1+P+v]!==l&&(R=a.indexOf(l,d)),x=a.indexOf(e,d),O=a.indexOf(n,d);break}if(P=D(O),a.substring(R+1+P,R+1+P+w)===n){if(S.push(a.substring(d,R).replace(N,l)),F(R+1+P+w),x=a.indexOf(e,d),R=a.indexOf(l,d),E&&(V(),f))return U();if(s&&I.length>=s)return U(!0);break}T.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:I.length,index:d}),R++}}else if(r&&0===S.length&&a.substring(d,d+_)===r){if(-1===O)return U();d=O+w,O=a.indexOf(n,d),x=a.indexOf(e,d)}else if(-1!==x&&(x<O||-1===O))S.push(a.substring(d,x)),d=x+v,x=a.indexOf(e,d);else{if(-1===O)break;if(S.push(a.substring(d,O)),F(O+w),E&&(V(),f))return U();if(s&&I.length>=s)return U(!0)}return M();function L(t){I.push(t),C=d}function D(t){return-1!==t&&(t=a.substring(R+1,t))&&""===t.trim()?t.length:0}function M(t){return g||(void 0===t&&(t=a.substring(d)),S.push(t),d=y,L(S),E&&V()),U()}function F(t){d=t,L(S),S=[],O=a.indexOf(n,d)}function U(r){if(t.header&&!m&&I.length&&!u){var i=I[0],s={},o=new Set(i);let e=!1;for(let n=0;n<i.length;n++){let r=i[n];if(s[r=b(t.transformHeader)?t.transformHeader(r,n):r]){let t,a=s[r];for(;t=r+"_"+a,a++,o.has(t););o.add(t),i[n]=t,s[r]++,e=!0,(c=null===c?{}:c)[t]=r}else s[r]=1,i[n]=r;o.add(r)}e&&console.warn("Duplicate headers found and renamed."),u=!0}return{data:I,errors:T,meta:{delimiter:e,linebreak:n,aborted:f,truncated:!!r,cursor:C+(m||0),renamedHeaders:c}}}function V(){i(U()),I=[],T=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return d}}function g(t){var e=t.data,n=s[e.workerId],r=!1;if(e.error)n.userError(e.error,e.file);else if(e.results&&e.results.data){var i={abort:function(){r=!0,y(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(b(n.userStep)){for(var o=0;o<e.results.data.length&&(n.userStep({data:e.results.data[o],errors:e.results.errors,meta:e.results.meta},i),!r);o++);delete e.results}else b(n.userChunk)&&(n.userChunk(e.results,i,e.file),delete e.results)}e.finished&&!r&&y(e.workerId,e.results)}function y(t,e){var n=s[t];b(n.userComplete)&&n.userComplete(e),n.terminate(),delete s[t]}function v(){throw new Error("Not implemented.")}function w(t){if("object"!=typeof t||null===t)return t;var e,n=Array.isArray(t)?[]:{};for(e in t)n[e]=w(t[e]);return n}function _(t,e){return function(){t.apply(e,arguments)}}function b(t){return"function"==typeof t}return a.parse=function(e,r){var i=(r=r||{}).dynamicTyping||!1;if(b(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!b(r.transform)&&r.transform,!r.worker||!a.WORKERS_SUPPORTED)return i=null,a.NODE_STREAM_INPUT,"string"==typeof e?(e=(t=>65279!==t.charCodeAt(0)?t:t.slice(1))(e),i=new(r.download?u:h)(r)):!0===e.readable&&b(e.read)&&b(e.on)?i=new d(r):(n.File&&e instanceof File||e instanceof Object)&&(i=new l(r)),i.stream(e);(i=(()=>{var e;return!!a.WORKERS_SUPPORTED&&(e=(()=>{var e=n.URL||n.webkitURL||null,r=t.toString();return a.BLOB_URL||(a.BLOB_URL=e.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(e=new n.Worker(e)).onmessage=g,e.id=o++,s[e.id]=e)})()).userStep=r.step,i.userChunk=r.chunk,i.userComplete=r.complete,i.userError=r.error,r.step=b(r.step),r.chunk=b(r.chunk),r.complete=b(r.complete),r.error=b(r.error),delete r.worker,i.postMessage({input:e,config:r,workerId:i.id})},a.unparse=function(t,e){var n=!1,r=!0,i=",",s="\r\n",o='"',c=o+o,u=!1,l=null,h=!1,d=((()=>{if("object"==typeof e){if("string"!=typeof e.delimiter||a.BAD_DELIMITERS.filter((function(t){return-1!==e.delimiter.indexOf(t)})).length||(i=e.delimiter),"boolean"!=typeof e.quotes&&"function"!=typeof e.quotes&&!Array.isArray(e.quotes)||(n=e.quotes),"boolean"!=typeof e.skipEmptyLines&&"string"!=typeof e.skipEmptyLines||(u=e.skipEmptyLines),"string"==typeof e.newline&&(s=e.newline),"string"==typeof e.quoteChar&&(o=e.quoteChar),"boolean"==typeof e.header&&(r=e.header),Array.isArray(e.columns)){if(0===e.columns.length)throw new Error("Option columns is empty");l=e.columns}void 0!==e.escapeChar&&(c=e.escapeChar+o),e.escapeFormulae instanceof RegExp?h=e.escapeFormulae:"boolean"==typeof e.escapeFormulae&&e.escapeFormulae&&(h=/^[=+\-@\t\r].*$/)}})(),new RegExp(p(o),"g"));if("string"==typeof t&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return f(null,t,u);if("object"==typeof t[0])return f(l||Object.keys(t[0]),t,u)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||l),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:"object"==typeof t.data[0]?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||"object"==typeof t.data[0]||(t.data=[t.data])),f(t.fields||[],t.data||[],u);throw new Error("Unable to serialize unrecognized input");function f(t,e,n){var o="",a=("string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(t)&&0<t.length),c=!Array.isArray(e[0]);if(a&&r){for(var u=0;u<t.length;u++)0<u&&(o+=i),o+=m(t[u],u);0<e.length&&(o+=s)}for(var l=0;l<e.length;l++){var h=(a?t:e[l]).length,d=!1,f=a?0===Object.keys(e[l]).length:0===e[l].length;if(n&&!a&&(d="greedy"===n?""===e[l].join("").trim():1===e[l].length&&0===e[l][0].length),"greedy"===n&&a){for(var p=[],g=0;g<h;g++){var y=c?t[g]:g;p.push(e[l][y])}d=""===p.join("").trim()}if(!d){for(var v=0;v<h;v++){0<v&&!f&&(o+=i);var w=a&&c?t[v]:v;o+=m(e[l][w],v)}l<e.length-1&&(!n||0<h&&!f)&&(o+=s)}}return o}function m(t,e){var r,s;return null==t?"":t.constructor===Date?JSON.stringify(t).slice(1,25):(s=!1,h&&"string"==typeof t&&h.test(t)&&(t="'"+t,s=!0),r=t.toString().replace(d,c),(s=s||!0===n||"function"==typeof n&&n(t,e)||Array.isArray(n)&&n[e]||((t,e)=>{for(var n=0;n<e.length;n++)if(-1<t.indexOf(e[n]))return!0;return!1})(r,a.BAD_DELIMITERS)||-1<r.indexOf(i)||" "===r.charAt(0)||" "===r.charAt(r.length-1))?o+r+o:r)}},a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!n.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=m,a.ParserHandle=f,a.NetworkStreamer=u,a.FileStreamer=l,a.StringStreamer=h,a.ReadableStreamStreamer=d,n.jQuery&&((e=n.jQuery).fn.parse=function(t){var r=t.config||{},i=[];return this.each((function(t){if("INPUT"!==e(this).prop("tagName").toUpperCase()||"file"!==e(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var s=0;s<this.files.length;s++)i.push({file:this.files[s],inputElem:this,instanceConfig:e.extend({},r)})})),s(),this;function s(){if(0===i.length)b(t.complete)&&t.complete();else{var n,r,s,c=i[0];if(b(t.before)){var u=t.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return n=c.file,r=c.inputElem,s=u.reason,void(b(t.error)&&t.error({name:"AbortError"},n,r,s));if("skip"===u.action)return void o();"object"==typeof u.config&&(c.instanceConfig=e.extend(c.instanceConfig,u.config))}else if("skip"===u)return void o()}var l=c.instanceConfig.complete;c.instanceConfig.complete=function(t){b(l)&&l(t,c.file,c.inputElem),o()},a.parse(c.file,c.instanceConfig)}}function o(){i.splice(0,1),s()}}),i&&(n.onmessage=function(t){t=t.data,void 0===a.WORKER_ID&&t&&(a.WORKER_ID=t.workerId),"string"==typeof t.input?n.postMessage({workerId:a.WORKER_ID,results:a.parse(t.input,t.config),finished:!0}):(n.File&&t.input instanceof File||t.input instanceof Object)&&(t=a.parse(t.input,t.config))&&n.postMessage({workerId:a.WORKER_ID,results:t,finished:!0})}),(u.prototype=Object.create(c.prototype)).constructor=u,(l.prototype=Object.create(c.prototype)).constructor=l,(h.prototype=Object.create(h.prototype)).constructor=h,(d.prototype=Object.create(c.prototype)).constructor=d,a},void 0===(r=n.apply(e,[]))||(t.exports=r)},913:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{D:()=>g});var i=n(730),s=n(356),o=n(347),a=n(954),c=n(371),u=t([a]);function g(){fetch("instructions.html").then((function(t){return t.text()})).then((function(t){var e,r;y(t),l=1,d.clear(),e=document.getElementById("prevInstructionBtn"),r=document.getElementById("nextInstructionBtn"),e.addEventListener("click",(function(){l>1&&v(--l)})),r.addEventListener("click",(function(){var t,e,u=document.getElementById("instructionPage-".concat(l)),d=null==u?void 0:u.querySelector("video");"true"!==r.dataset.locked?l<h?v(++l):(i.DM.style.display="none",i.Y_.style.display="flex",(0,s.B5)(),(0,c.Bl)(),(0,a.z)(),Promise.resolve().then(n.bind(n,412)).then((function(t){t.saveOrUpdateUser((0,o.Fv)())}))):d&&(t="Please watch full video to continue",(e=document.getElementById("nextTooltip")).textContent=t,e.style.display="block",e.style.opacity="1",setTimeout((function(){e.style.opacity="0",setTimeout((function(){e.style.display="none"}),300)}),3e3))})),v(l)}))}a=(u.then?(await u)():u)[0];var l=1,h=9,d=new Set,f=null,p=null,m="Next";function y(t){i.DM.innerHTML=t,i.DM.style.display="block";for(var e=(0,s.L2)(),n=l;n<h;n++)if(3===n){var r=document.getElementById("instruction".concat(n)),o=document.getElementById("videoSource");r&&o&&(o.src="instructions".concat(e,"-").concat(n,".mp4"),r.load())}else{var a=document.getElementById("instruction".concat(n));a&&(a.src="instructions".concat(e,"-").concat(n,".png"))}}function v(t){var e;f&&clearTimeout(f),p&&clearInterval(p);for(var n=1;n<=h;n++){var r;null===(r=document.getElementById("instructionPage-".concat(n)))||void 0===r||r.classList.remove("active")}null===(e=document.getElementById("instructionPage-".concat(t)))||void 0===e||e.classList.add("active");var i=document.getElementById("prevInstructionBtn"),s=document.getElementById("nextInstructionBtn");i.hidden=1===t,s.textContent=t===h?"Start":m,w(t)}function w(t){var e=document.getElementById("nextInstructionBtn");if(d.has(t))return e.classList.remove("disabled-visual"),e.dataset.locked="false",void(e.textContent=l===h?"Start":m);var n=document.getElementById("instructionPage-".concat(t)),r=null==n?void 0:n.querySelector("video");if(e.classList.add("disabled-visual"),e.dataset.locked="true",r){var i=function(){e.classList.remove("disabled-visual"),e.dataset.locked="false",e.textContent=l===h?"Start":m,d.add(t),r.removeEventListener("ended",i)};r.addEventListener("ended",i)}else{f&&clearTimeout(f),p&&clearInterval(p);var s=3;e.textContent="".concat(m," (").concat(s,")"),p=setInterval((function(){s--,e.textContent="".concat(m," (").concat(s,")"),s<=0&&(clearInterval(p),e.classList.remove("disabled-visual"),e.dataset.locked="false",e.textContent=l===h?"Start":m,d.add(t))}),1e3)}}r()}catch(_){r(_)}}))},954:(t,e,n)=>{"use strict";n.a(t,(async(t,r)=>{try{n.d(e,{z:()=>N});var i=n(730),s=n(356),o=n(212),a=n(371),c=n(13),u=n(809),l=n.n(u),h=n(347),d=(n(412),n(120)),f=n(987),p=(n(39),t([d]));function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function g(){g=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var s=e&&e.prototype instanceof w?e:w,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",y="completed",v={};function w(){}function _(){}function b(){}var E={};u(E,o,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,o)&&(E=T);var S=b.prototype=w.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,o,a){var c=h(t[i],t,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==m(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(e,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=h(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(m(e)+" is not iterable")}return _.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:_,configurable:!0}),_.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(l(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),u(S,c,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function y(t){return b(t)||_(t)||w(t)||v()}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(t,e){if(t){if("string"==typeof t)return E(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}function _(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function b(t){if(Array.isArray(t))return E(t)}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function I(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function T(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){I(s,r,i,o,a,"next",t)}function a(t){I(s,r,i,o,a,"throw",t)}o(void 0)}))}}function S(){return C.apply(this,arguments)}function C(){return C=T(g().mark((function t(){var e,n,r,i=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=i.length>0&&void 0!==i[0]&&i[0];try{n=(0,h.Uv)(),(0,s.jI)(6),o.KJ.num_objects=(0,s.L2)(),(0,s.aE)(1),(0,s.ut)(s.Q$.HIGH_COST_AI),o.KJ.exp_group=s.y2[(0,s.qB)()],o.KJ.prolific_pid=n.PROLIFIC_PID||(0,h.cv)(),r=6===(0,s.L2)()?"six_objects_instructions.csv":"five_objects_simple.csv",l().parse(r,{download:!0,header:!0,complete:function(){var t=T(g().mark((function t(n){var r,i,o,u,l,d;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.data,(0,s.ej)()&&e&&(i=(0,s.xp)(),o=r.filter((function(t){return Number(t.id)>=0&&Number(t.id)<=i})),u=r.filter((function(t){return Number(t.id)>i})),l=(0,h.R3)(o),r=[].concat(y(l),y(u))),d=r.map((function(t){for(var e=Number(t.id),n=t["Correct Order"].split(",").map((function(t){return t.trim()})),r=y(n).sort(),i=parseInt(t["Num Statements"],10),s=[],o=1;o<=i;o++){var a,c=null===(a=t["Statement ".concat(o)])||void 0===a?void 0:a.trim();c&&s.push(c)}var u=["front","end"];t.front_end&&(u=t.front_end.replace(/^\s*["']?|["']?\s*$/g,"").split(",").map((function(t){return t.trim()})));var l=t.instruction,h=[];if(t.style)try{h=JSON.parse(t.style.replace(/'/g,'"'))}catch(e){console.warn("Failed to parse style:",t.style),h=Array(n.length).fill("blank")}var d={};n.forEach((function(t,e){d[t]=h[e]||"blank"}));var f=r.map((function(t){return d[t]}));return{question_id:e,answer:n,options:r,instruction:l,style:f,sortedStyle:h,statements:s,front_end:u}})),(0,s.cp)(d),s.RI.PHASE_QUESTIONS.phase1=(0,h.R3)(d.filter((function(t){return t.question_id>=0&&t.question_id<=9}))),s.RI.PHASE_QUESTIONS.phase2=(0,h.R3)(d.filter((function(t){return t.question_id>=10&&t.question_id<=39}))),s.RI.PHASE_QUESTIONS.phase3=(0,h.R3)(d.filter((function(t){return t.question_id>=40&&t.question_id<=49}))),s.RI.PHASE_QUESTIONS.extra=d.filter((function(t){return t.question_id>=50})).sort((function(t,e){return t.id-e.id})),(0,c.Zb)(),t.next=11,(0,a.aT)();case 11:return t.next=13,k(!0,!0);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})}catch(t){console.error("âŒ Failed to initialize environment:",t)}case 2:case"end":return t.stop()}}),t)}))),C.apply(this,arguments)}function k(){return A.apply(this,arguments)}function A(){return A=T(g().mark((function t(){var e,n,r=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],e=r.length>0&&void 0!==r[0]&&r[0]){t.next=6;break}return(0,f.z)(),(0,d.q)(),t.abrupt("return");case 6:return t.next=8,x(e,n);case 8:case"end":return t.stop()}}),t)}))),A.apply(this,arguments)}function x(t,e){return O.apply(this,arguments)}function O(){return(O=T(g().mark((function t(e,n){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,f.z)();case 2:if(!t.sent){t.next=5;break}return t.abrupt("return");case 5:n||((0,s.B5)(),(0,a.Bl)()),i.Y_.style.display="flex",N();case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(){(0,c.io)()}d=(p.then?(await p)():p)[0],await S(),r()}catch(R){r(R)}}),1)},987:(t,e,n)=>{"use strict";n.d(e,{z:()=>l});var r=n(212),i=n(412),s=n(371);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var s=e&&e.prototype instanceof w?e:w,o=Object.create(s.prototype),a=new R(r||[]);return i(o,"_invoke",{value:A(t,n,a)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function w(){}function _(){}function b(){}var E={};h(E,c,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(P([])));T&&T!==n&&r.call(T,c)&&(E=T);var S=b.prototype=w.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,s,a,c){var u=f(t[i],t,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==o(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function A(e,n,r){var i=p;return function(s,o){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=x(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?y:m,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=f(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(o(e)+" is not iterable")}return _.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:_,configurable:!0}),_.displayName=h(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},C(k.prototype),h(k.prototype,u,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new k(d(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(S),h(S,l,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=P,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function c(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}var u=null;function l(){return h.apply(this,arguments)}function h(){var t;return t=a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==u){t.next=3;break}return(0,s.KE)(),t.abrupt("return",!0);case 3:return t.next=5,(0,i.checkIfUserExists)(r.KJ.prolific_pid);case 5:if(e=t.sent,u=e,!e){t.next=10;break}return(0,s.KE)(),t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t)})),h=function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){c(s,r,i,o,a,"next",t)}function a(t){c(s,r,i,o,a,"throw",t)}o(void 0)}))},h.apply(this,arguments)}}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t].call(n.exports,n,n.exports,o),n.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(i,s,o)=>{var a;o&&((a=[]).d=-1);var c,u,l,h=new Set,d=i.exports,f=new Promise(((t,e)=>{l=e,u=t}));f[e]=d,f[t]=t=>(a&&t(a),h.forEach(t),f.catch((t=>{}))),i.exports=f,s((i=>{var s;c=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[t])return i;if(i.then){var s=[];s.d=0,i.then((t=>{o[e]=t,r(s)}),(t=>{o[n]=t,r(s)}));var o={};return o[t]=t=>t(s),o}}var a={};return a[t]=t=>{},a[e]=i,a})))(i);var o=()=>c.map((t=>{if(t[n])throw t[n];return t[e]})),u=new Promise((e=>{(s=()=>e(o)).r=0;var n=t=>t!==a&&!h.has(t)&&(h.add(t),t&&!t.d&&(s.r++,t.push(s)));c.map((e=>e[t](n)))}));return s.r?u:o()}),(t=>(t?l(f[n]=t):u(d),r(a)))),a&&a.d<0&&(a.d=0)},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o(954)})();